var path = require("path");

/**
 * GET /assets/js/mvc/vendor/lib/handlebars-v2.0.0.js
 *
 * host: rain.okta1.com:1802
 * connection: keep-alive
 * user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:48.0) Gecko/20100101 Firefox/48.0
 * accept: * / *
 * accept-encoding: gzip
 * accept-language: en-US
 * cookie: DT=DI0jRgRLD_uQBqSzCUCxXy5OA; t=default; JSESSIONID=C8CAB112A54DECAB36F64A605FA44B2A
 * cache-control: no-cache, no-store
 * pragma: no-cache
 */

module.exports = function (req, res) {
  res.statusCode = 200;

  res.setHeader("server", "Apache-Coyote/1.1");
  res.setHeader("accept-ranges", "bytes");
  res.setHeader("etag", "W/\"100756-1477769062000\"");
  res.setHeader("last-modified", "Sat, 29 Oct 2016 19:24:22 GMT");
  res.setHeader("content-type", "text/javascript");
  res.setHeader("content-length", "100756");
  res.setHeader("date", "Sat, 05 Nov 2016 23:23:48 GMT");

  res.setHeader("x-yakbak-tape", path.basename(__filename, ".js"));

  res.write(new Buffer("LyohCgogaGFuZGxlYmFycyB2Mi4wLjAKCkNvcHlyaWdodCAoQykgMjAxMS0yMDE0IGJ5IFllaHVkYSBLYXR6CgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoKQGxpY2Vuc2UKKi8KLyogZXhwb3J0ZWQgSGFuZGxlYmFycyAqLwooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoW10sIGZhY3RvcnkpOwogIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsKICB9IGVsc2UgewogICAgcm9vdC5IYW5kbGViYXJzID0gcm9vdC5IYW5kbGViYXJzIHx8IGZhY3RvcnkoKTsKICB9Cn0odGhpcywgZnVuY3Rpb24gKCkgewovLyBoYW5kbGViYXJzL3NhZmUtc3RyaW5nLmpzCnZhciBfX21vZHVsZTRfXyA9IChmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhwb3J0c19fOwogIC8vIEJ1aWxkIG91dCBvdXIgYmFzaWMgU2FmZVN0cmluZyB0eXBlCiAgZnVuY3Rpb24gU2FmZVN0cmluZyhzdHJpbmcpIHsKICAgIHRoaXMuc3RyaW5nID0gc3RyaW5nOwogIH0KCiAgU2FmZVN0cmluZy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAiIiArIHRoaXMuc3RyaW5nOwogIH07CgogIF9fZXhwb3J0c19fID0gU2FmZVN0cmluZzsKICByZXR1cm4gX19leHBvcnRzX187Cn0pKCk7CgovLyBoYW5kbGViYXJzL3V0aWxzLmpzCnZhciBfX21vZHVsZTNfXyA9IChmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18pIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhwb3J0c19fID0ge307CiAgLypqc2hpbnQgLVcwMDQgKi8KICB2YXIgU2FmZVN0cmluZyA9IF9fZGVwZW5kZW5jeTFfXzsKCiAgdmFyIGVzY2FwZSA9IHsKICAgICImIjogIiZhbXA7IiwKICAgICI8IjogIiZsdDsiLAogICAgIj4iOiAiJmd0OyIsCiAgICAnIic6ICImcXVvdDsiLAogICAgIiciOiAiJiN4Mjc7IiwKICAgICJgIjogIiYjeDYwOyIKICB9OwoKICB2YXIgYmFkQ2hhcnMgPSAvWyY8PiInYF0vZzsKICB2YXIgcG9zc2libGUgPSAvWyY8PiInYF0vOwoKICBmdW5jdGlvbiBlc2NhcGVDaGFyKGNocikgewogICAgcmV0dXJuIGVzY2FwZVtjaHJdOwogIH0KCiAgZnVuY3Rpb24gZXh0ZW5kKG9iaiAvKiAsIC4uLnNvdXJjZSAqLykgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3VtZW50c1tpXSkgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYXJndW1lbnRzW2ldLCBrZXkpKSB7CiAgICAgICAgICBvYmpba2V5XSA9IGFyZ3VtZW50c1tpXVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfQoKICBfX2V4cG9ydHNfXy5leHRlbmQgPSBleHRlbmQ7dmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICBfX2V4cG9ydHNfXy50b1N0cmluZyA9IHRvU3RyaW5nOwogIC8vIFNvdXJjZWQgZnJvbSBsb2Rhc2gKICAvLyBodHRwczovL2dpdGh1Yi5jb20vYmVzdGllanMvbG9kYXNoL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAgdmFyIGlzRnVuY3Rpb24gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJzsKICB9OwogIC8vIGZhbGxiYWNrIGZvciBvbGRlciB2ZXJzaW9ucyBvZiBDaHJvbWUgYW5kIFNhZmFyaQogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgaWYgKGlzRnVuY3Rpb24oL3gvKSkgewogICAgaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgJiYgdG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSc7CiAgICB9OwogIH0KICB2YXIgaXNGdW5jdGlvbjsKICBfX2V4cG9ydHNfXy5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbjsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogIHZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSA/IHRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nIDogZmFsc2U7CiAgfTsKICBfX2V4cG9ydHNfXy5pc0FycmF5ID0gaXNBcnJheTsKCiAgZnVuY3Rpb24gZXNjYXBlRXhwcmVzc2lvbihzdHJpbmcpIHsKICAgIC8vIGRvbid0IGVzY2FwZSBTYWZlU3RyaW5ncywgc2luY2UgdGhleSdyZSBhbHJlYWR5IHNhZmUKICAgIGlmIChzdHJpbmcgaW5zdGFuY2VvZiBTYWZlU3RyaW5nKSB7CiAgICAgIHJldHVybiBzdHJpbmcudG9TdHJpbmcoKTsKICAgIH0gZWxzZSBpZiAoc3RyaW5nID09IG51bGwpIHsKICAgICAgcmV0dXJuICIiOwogICAgfSBlbHNlIGlmICghc3RyaW5nKSB7CiAgICAgIHJldHVybiBzdHJpbmcgKyAnJzsKICAgIH0KCiAgICAvLyBGb3JjZSBhIHN0cmluZyBjb252ZXJzaW9uIGFzIHRoaXMgd2lsbCBiZSBkb25lIGJ5IHRoZSBhcHBlbmQgcmVnYXJkbGVzcyBhbmQKICAgIC8vIHRoZSByZWdleCB0ZXN0IHdpbGwgZG8gdGhpcyB0cmFuc3BhcmVudGx5IGJlaGluZCB0aGUgc2NlbmVzLCBjYXVzaW5nIGlzc3VlcyBpZgogICAgLy8gYW4gb2JqZWN0J3MgdG8gc3RyaW5nIGhhcyBlc2NhcGVkIGNoYXJhY3RlcnMgaW4gaXQuCiAgICBzdHJpbmcgPSAiIiArIHN0cmluZzsKCiAgICBpZighcG9zc2libGUudGVzdChzdHJpbmcpKSB7IHJldHVybiBzdHJpbmc7IH0KICAgIHJldHVybiBzdHJpbmcucmVwbGFjZShiYWRDaGFycywgZXNjYXBlQ2hhcik7CiAgfQoKICBfX2V4cG9ydHNfXy5lc2NhcGVFeHByZXNzaW9uID0gZXNjYXBlRXhwcmVzc2lvbjtmdW5jdGlvbiBpc0VtcHR5KHZhbHVlKSB7CiAgICBpZiAoIXZhbHVlICYmIHZhbHVlICE9PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBfX2V4cG9ydHNfXy5pc0VtcHR5ID0gaXNFbXB0eTtmdW5jdGlvbiBhcHBlbmRDb250ZXh0UGF0aChjb250ZXh0UGF0aCwgaWQpIHsKICAgIHJldHVybiAoY29udGV4dFBhdGggPyBjb250ZXh0UGF0aCArICcuJyA6ICcnKSArIGlkOwogIH0KCiAgX19leHBvcnRzX18uYXBwZW5kQ29udGV4dFBhdGggPSBhcHBlbmRDb250ZXh0UGF0aDsKICByZXR1cm4gX19leHBvcnRzX187Cn0pKF9fbW9kdWxlNF9fKTsKCi8vIGhhbmRsZWJhcnMvZXhjZXB0aW9uLmpzCnZhciBfX21vZHVsZTVfXyA9IChmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhwb3J0c19fOwoKICB2YXIgZXJyb3JQcm9wcyA9IFsnZGVzY3JpcHRpb24nLCAnZmlsZU5hbWUnLCAnbGluZU51bWJlcicsICdtZXNzYWdlJywgJ25hbWUnLCAnbnVtYmVyJywgJ3N0YWNrJ107CgogIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlLCBub2RlKSB7CiAgICB2YXIgbGluZTsKICAgIGlmIChub2RlICYmIG5vZGUuZmlyc3RMaW5lKSB7CiAgICAgIGxpbmUgPSBub2RlLmZpcnN0TGluZTsKCiAgICAgIG1lc3NhZ2UgKz0gJyAtICcgKyBsaW5lICsgJzonICsgbm9kZS5maXJzdENvbHVtbjsKICAgIH0KCiAgICB2YXIgdG1wID0gRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgbWVzc2FnZSk7CgogICAgLy8gVW5mb3J0dW5hdGVseSBlcnJvcnMgYXJlIG5vdCBlbnVtZXJhYmxlIGluIENocm9tZSAoYXQgbGVhc3QpLCBzbyBgZm9yIHByb3AgaW4gdG1wYCBkb2Vzbid0IHdvcmsuCiAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBlcnJvclByb3BzLmxlbmd0aDsgaWR4KyspIHsKICAgICAgdGhpc1tlcnJvclByb3BzW2lkeF1dID0gdG1wW2Vycm9yUHJvcHNbaWR4XV07CiAgICB9CgogICAgaWYgKGxpbmUpIHsKICAgICAgdGhpcy5saW5lTnVtYmVyID0gbGluZTsKICAgICAgdGhpcy5jb2x1bW4gPSBub2RlLmZpcnN0Q29sdW1uOwogICAgfQogIH0KCiAgRXhjZXB0aW9uLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpOwoKICBfX2V4cG9ydHNfXyA9IEV4Y2VwdGlvbjsKICByZXR1cm4gX19leHBvcnRzX187Cn0pKCk7CgovLyBoYW5kbGViYXJzL2Jhc2UuanMKdmFyIF9fbW9kdWxlMl9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX2V4cG9ydHNfXyA9IHt9OwogIHZhciBVdGlscyA9IF9fZGVwZW5kZW5jeTFfXzsKICB2YXIgRXhjZXB0aW9uID0gX19kZXBlbmRlbmN5Ml9fOwoKICB2YXIgVkVSU0lPTiA9ICIyLjAuMCI7CiAgX19leHBvcnRzX18uVkVSU0lPTiA9IFZFUlNJT047dmFyIENPTVBJTEVSX1JFVklTSU9OID0gNjsKICBfX2V4cG9ydHNfXy5DT01QSUxFUl9SRVZJU0lPTiA9IENPTVBJTEVSX1JFVklTSU9OOwogIHZhciBSRVZJU0lPTl9DSEFOR0VTID0gewogICAgMTogJzw9IDEuMC5yYy4yJywgLy8gMS4wLnJjLjIgaXMgYWN0dWFsbHkgcmV2MiBidXQgZG9lc24ndCByZXBvcnQgaXQKICAgIDI6ICc9PSAxLjAuMC1yYy4zJywKICAgIDM6ICc9PSAxLjAuMC1yYy40JywKICAgIDQ6ICc9PSAxLngueCcsCiAgICA1OiAnPT0gMi4wLjAtYWxwaGEueCcsCiAgICA2OiAnPj0gMi4wLjAtYmV0YS4xJwogIH07CiAgX19leHBvcnRzX18uUkVWSVNJT05fQ0hBTkdFUyA9IFJFVklTSU9OX0NIQU5HRVM7CiAgdmFyIGlzQXJyYXkgPSBVdGlscy5pc0FycmF5LAogICAgICBpc0Z1bmN0aW9uID0gVXRpbHMuaXNGdW5jdGlvbiwKICAgICAgdG9TdHJpbmcgPSBVdGlscy50b1N0cmluZywKICAgICAgb2JqZWN0VHlwZSA9ICdbb2JqZWN0IE9iamVjdF0nOwoKICBmdW5jdGlvbiBIYW5kbGViYXJzRW52aXJvbm1lbnQoaGVscGVycywgcGFydGlhbHMpIHsKICAgIHRoaXMuaGVscGVycyA9IGhlbHBlcnMgfHwge307CiAgICB0aGlzLnBhcnRpYWxzID0gcGFydGlhbHMgfHwge307CgogICAgcmVnaXN0ZXJEZWZhdWx0SGVscGVycyh0aGlzKTsKICB9CgogIF9fZXhwb3J0c19fLkhhbmRsZWJhcnNFbnZpcm9ubWVudCA9IEhhbmRsZWJhcnNFbnZpcm9ubWVudDtIYW5kbGViYXJzRW52aXJvbm1lbnQucHJvdG90eXBlID0gewogICAgY29uc3RydWN0b3I6IEhhbmRsZWJhcnNFbnZpcm9ubWVudCwKCiAgICBsb2dnZXI6IGxvZ2dlciwKICAgIGxvZzogbG9nLAoKICAgIHJlZ2lzdGVySGVscGVyOiBmdW5jdGlvbihuYW1lLCBmbikgewogICAgICBpZiAodG9TdHJpbmcuY2FsbChuYW1lKSA9PT0gb2JqZWN0VHlwZSkgewogICAgICAgIGlmIChmbikgeyB0aHJvdyBuZXcgRXhjZXB0aW9uKCdBcmcgbm90IHN1cHBvcnRlZCB3aXRoIG11bHRpcGxlIGhlbHBlcnMnKTsgfQogICAgICAgIFV0aWxzLmV4dGVuZCh0aGlzLmhlbHBlcnMsIG5hbWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaGVscGVyc1tuYW1lXSA9IGZuOwogICAgICB9CiAgICB9LAogICAgdW5yZWdpc3RlckhlbHBlcjogZnVuY3Rpb24obmFtZSkgewogICAgICBkZWxldGUgdGhpcy5oZWxwZXJzW25hbWVdOwogICAgfSwKCiAgICByZWdpc3RlclBhcnRpYWw6IGZ1bmN0aW9uKG5hbWUsIHBhcnRpYWwpIHsKICAgICAgaWYgKHRvU3RyaW5nLmNhbGwobmFtZSkgPT09IG9iamVjdFR5cGUpIHsKICAgICAgICBVdGlscy5leHRlbmQodGhpcy5wYXJ0aWFscywgIG5hbWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFydGlhbHNbbmFtZV0gPSBwYXJ0aWFsOwogICAgICB9CiAgICB9LAogICAgdW5yZWdpc3RlclBhcnRpYWw6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgZGVsZXRlIHRoaXMucGFydGlhbHNbbmFtZV07CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gcmVnaXN0ZXJEZWZhdWx0SGVscGVycyhpbnN0YW5jZSkgewogICAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2hlbHBlck1pc3NpbmcnLCBmdW5jdGlvbigvKiBbYXJncywgXW9wdGlvbnMgKi8pIHsKICAgICAgaWYoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIC8vIEEgbWlzc2luZyBmaWVsZCBpbiBhIHt7Zm9vfX0gY29uc3R1Y3QuCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBTb21lb25lIGlzIGFjdHVhbGx5IHRyeWluZyB0byBjYWxsIHNvbWV0aGluZywgYmxvdyB1cC4KICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJNaXNzaW5nIGhlbHBlcjogJyIgKyBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aC0xXS5uYW1lICsgIiciKTsKICAgICAgfQogICAgfSk7CgogICAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2Jsb2NrSGVscGVyTWlzc2luZycsIGZ1bmN0aW9uKGNvbnRleHQsIG9wdGlvbnMpIHsKICAgICAgdmFyIGludmVyc2UgPSBvcHRpb25zLmludmVyc2UsCiAgICAgICAgICBmbiA9IG9wdGlvbnMuZm47CgogICAgICBpZihjb250ZXh0ID09PSB0cnVlKSB7CiAgICAgICAgcmV0dXJuIGZuKHRoaXMpOwogICAgICB9IGVsc2UgaWYoY29udGV4dCA9PT0gZmFsc2UgfHwgY29udGV4dCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7CiAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShjb250ZXh0KSkgewogICAgICAgIGlmKGNvbnRleHQubGVuZ3RoID4gMCkgewogICAgICAgICAgaWYgKG9wdGlvbnMuaWRzKSB7CiAgICAgICAgICAgIG9wdGlvbnMuaWRzID0gW29wdGlvbnMubmFtZV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmhlbHBlcnMuZWFjaChjb250ZXh0LCBvcHRpb25zKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGludmVyc2UodGhpcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5pZHMpIHsKICAgICAgICAgIHZhciBkYXRhID0gY3JlYXRlRnJhbWUob3B0aW9ucy5kYXRhKTsKICAgICAgICAgIGRhdGEuY29udGV4dFBhdGggPSBVdGlscy5hcHBlbmRDb250ZXh0UGF0aChvcHRpb25zLmRhdGEuY29udGV4dFBhdGgsIG9wdGlvbnMubmFtZSk7CiAgICAgICAgICBvcHRpb25zID0ge2RhdGE6IGRhdGF9OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZuKGNvbnRleHQsIG9wdGlvbnMpOwogICAgICB9CiAgICB9KTsKCiAgICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignZWFjaCcsIGZ1bmN0aW9uKGNvbnRleHQsIG9wdGlvbnMpIHsKICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignTXVzdCBwYXNzIGl0ZXJhdG9yIHRvICNlYWNoJyk7CiAgICAgIH0KCiAgICAgIHZhciBmbiA9IG9wdGlvbnMuZm4sIGludmVyc2UgPSBvcHRpb25zLmludmVyc2U7CiAgICAgIHZhciBpID0gMCwgcmV0ID0gIiIsIGRhdGE7CgogICAgICB2YXIgY29udGV4dFBhdGg7CiAgICAgIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5pZHMpIHsKICAgICAgICBjb250ZXh0UGF0aCA9IFV0aWxzLmFwcGVuZENvbnRleHRQYXRoKG9wdGlvbnMuZGF0YS5jb250ZXh0UGF0aCwgb3B0aW9ucy5pZHNbMF0pICsgJy4nOwogICAgICB9CgogICAgICBpZiAoaXNGdW5jdGlvbihjb250ZXh0KSkgeyBjb250ZXh0ID0gY29udGV4dC5jYWxsKHRoaXMpOyB9CgogICAgICBpZiAob3B0aW9ucy5kYXRhKSB7CiAgICAgICAgZGF0YSA9IGNyZWF0ZUZyYW1lKG9wdGlvbnMuZGF0YSk7CiAgICAgIH0KCiAgICAgIGlmKGNvbnRleHQgJiYgdHlwZW9mIGNvbnRleHQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgaWYgKGlzQXJyYXkoY29udGV4dCkpIHsKICAgICAgICAgIGZvcih2YXIgaiA9IGNvbnRleHQubGVuZ3RoOyBpPGo7IGkrKykgewogICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgIGRhdGEuaW5kZXggPSBpOwogICAgICAgICAgICAgIGRhdGEuZmlyc3QgPSAoaSA9PT0gMCk7CiAgICAgICAgICAgICAgZGF0YS5sYXN0ICA9IChpID09PSAoY29udGV4dC5sZW5ndGgtMSkpOwoKICAgICAgICAgICAgICBpZiAoY29udGV4dFBhdGgpIHsKICAgICAgICAgICAgICAgIGRhdGEuY29udGV4dFBhdGggPSBjb250ZXh0UGF0aCArIGk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldCA9IHJldCArIGZuKGNvbnRleHRbaV0sIHsgZGF0YTogZGF0YSB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yKHZhciBrZXkgaW4gY29udGV4dCkgewogICAgICAgICAgICBpZihjb250ZXh0Lmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICBpZihkYXRhKSB7CiAgICAgICAgICAgICAgICBkYXRhLmtleSA9IGtleTsKICAgICAgICAgICAgICAgIGRhdGEuaW5kZXggPSBpOwogICAgICAgICAgICAgICAgZGF0YS5maXJzdCA9IChpID09PSAwKTsKCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dFBhdGgpIHsKICAgICAgICAgICAgICAgICAgZGF0YS5jb250ZXh0UGF0aCA9IGNvbnRleHRQYXRoICsga2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXQgPSByZXQgKyBmbihjb250ZXh0W2tleV0sIHtkYXRhOiBkYXRhfSk7CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZihpID09PSAwKXsKICAgICAgICByZXQgPSBpbnZlcnNlKHRoaXMpOwogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfSk7CgogICAgaW5zdGFuY2UucmVnaXN0ZXJIZWxwZXIoJ2lmJywgZnVuY3Rpb24oY29uZGl0aW9uYWwsIG9wdGlvbnMpIHsKICAgICAgaWYgKGlzRnVuY3Rpb24oY29uZGl0aW9uYWwpKSB7IGNvbmRpdGlvbmFsID0gY29uZGl0aW9uYWwuY2FsbCh0aGlzKTsgfQoKICAgICAgLy8gRGVmYXVsdCBiZWhhdmlvciBpcyB0byByZW5kZXIgdGhlIHBvc2l0aXZlIHBhdGggaWYgdGhlIHZhbHVlIGlzIHRydXRoeSBhbmQgbm90IGVtcHR5LgogICAgICAvLyBUaGUgYGluY2x1ZGVaZXJvYCBvcHRpb24gbWF5IGJlIHNldCB0byB0cmVhdCB0aGUgY29uZHRpb25hbCBhcyBwdXJlbHkgbm90IGVtcHR5IGJhc2VkIG9uIHRoZQogICAgICAvLyBiZWhhdmlvciBvZiBpc0VtcHR5LiBFZmZlY3RpdmVseSB0aGlzIGRldGVybWluZXMgaWYgMCBpcyBoYW5kbGVkIGJ5IHRoZSBwb3NpdGl2ZSBwYXRoIG9yIG5lZ2F0aXZlLgogICAgICBpZiAoKCFvcHRpb25zLmhhc2guaW5jbHVkZVplcm8gJiYgIWNvbmRpdGlvbmFsKSB8fCBVdGlscy5pc0VtcHR5KGNvbmRpdGlvbmFsKSkgewogICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7CiAgICAgIH0KICAgIH0pOwoKICAgIGluc3RhbmNlLnJlZ2lzdGVySGVscGVyKCd1bmxlc3MnLCBmdW5jdGlvbihjb25kaXRpb25hbCwgb3B0aW9ucykgewogICAgICByZXR1cm4gaW5zdGFuY2UuaGVscGVyc1snaWYnXS5jYWxsKHRoaXMsIGNvbmRpdGlvbmFsLCB7Zm46IG9wdGlvbnMuaW52ZXJzZSwgaW52ZXJzZTogb3B0aW9ucy5mbiwgaGFzaDogb3B0aW9ucy5oYXNofSk7CiAgICB9KTsKCiAgICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignd2l0aCcsIGZ1bmN0aW9uKGNvbnRleHQsIG9wdGlvbnMpIHsKICAgICAgaWYgKGlzRnVuY3Rpb24oY29udGV4dCkpIHsgY29udGV4dCA9IGNvbnRleHQuY2FsbCh0aGlzKTsgfQoKICAgICAgdmFyIGZuID0gb3B0aW9ucy5mbjsKCiAgICAgIGlmICghVXRpbHMuaXNFbXB0eShjb250ZXh0KSkgewogICAgICAgIGlmIChvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5pZHMpIHsKICAgICAgICAgIHZhciBkYXRhID0gY3JlYXRlRnJhbWUob3B0aW9ucy5kYXRhKTsKICAgICAgICAgIGRhdGEuY29udGV4dFBhdGggPSBVdGlscy5hcHBlbmRDb250ZXh0UGF0aChvcHRpb25zLmRhdGEuY29udGV4dFBhdGgsIG9wdGlvbnMuaWRzWzBdKTsKICAgICAgICAgIG9wdGlvbnMgPSB7ZGF0YTpkYXRhfTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmbihjb250ZXh0LCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpOwogICAgICB9CiAgICB9KTsKCiAgICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignbG9nJywgZnVuY3Rpb24obWVzc2FnZSwgb3B0aW9ucykgewogICAgICB2YXIgbGV2ZWwgPSBvcHRpb25zLmRhdGEgJiYgb3B0aW9ucy5kYXRhLmxldmVsICE9IG51bGwgPyBwYXJzZUludChvcHRpb25zLmRhdGEubGV2ZWwsIDEwKSA6IDE7CiAgICAgIGluc3RhbmNlLmxvZyhsZXZlbCwgbWVzc2FnZSk7CiAgICB9KTsKCiAgICBpbnN0YW5jZS5yZWdpc3RlckhlbHBlcignbG9va3VwJywgZnVuY3Rpb24ob2JqLCBmaWVsZCkgewogICAgICByZXR1cm4gb2JqICYmIG9ialtmaWVsZF07CiAgICB9KTsKICB9CgogIHZhciBsb2dnZXIgPSB7CiAgICBtZXRob2RNYXA6IHsgMDogJ2RlYnVnJywgMTogJ2luZm8nLCAyOiAnd2FybicsIDM6ICdlcnJvcicgfSwKCiAgICAvLyBTdGF0ZSBlbnVtCiAgICBERUJVRzogMCwKICAgIElORk86IDEsCiAgICBXQVJOOiAyLAogICAgRVJST1I6IDMsCiAgICBsZXZlbDogMywKCiAgICAvLyBjYW4gYmUgb3ZlcnJpZGRlbiBpbiB0aGUgaG9zdCBlbnZpcm9ubWVudAogICAgbG9nOiBmdW5jdGlvbihsZXZlbCwgbWVzc2FnZSkgewogICAgICBpZiAobG9nZ2VyLmxldmVsIDw9IGxldmVsKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IGxvZ2dlci5tZXRob2RNYXBbbGV2ZWxdOwogICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZVttZXRob2RdKSB7CiAgICAgICAgICBjb25zb2xlW21ldGhvZF0uY2FsbChjb25zb2xlLCBtZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwogIF9fZXhwb3J0c19fLmxvZ2dlciA9IGxvZ2dlcjsKICB2YXIgbG9nID0gbG9nZ2VyLmxvZzsKICBfX2V4cG9ydHNfXy5sb2cgPSBsb2c7CiAgdmFyIGNyZWF0ZUZyYW1lID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICB2YXIgZnJhbWUgPSBVdGlscy5leHRlbmQoe30sIG9iamVjdCk7CiAgICBmcmFtZS5fcGFyZW50ID0gb2JqZWN0OwogICAgcmV0dXJuIGZyYW1lOwogIH07CiAgX19leHBvcnRzX18uY3JlYXRlRnJhbWUgPSBjcmVhdGVGcmFtZTsKICByZXR1cm4gX19leHBvcnRzX187Cn0pKF9fbW9kdWxlM19fLCBfX21vZHVsZTVfXyk7CgovLyBoYW5kbGViYXJzL3J1bnRpbWUuanMKdmFyIF9fbW9kdWxlNl9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18pIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhwb3J0c19fID0ge307CiAgdmFyIFV0aWxzID0gX19kZXBlbmRlbmN5MV9fOwogIHZhciBFeGNlcHRpb24gPSBfX2RlcGVuZGVuY3kyX187CiAgdmFyIENPTVBJTEVSX1JFVklTSU9OID0gX19kZXBlbmRlbmN5M19fLkNPTVBJTEVSX1JFVklTSU9OOwogIHZhciBSRVZJU0lPTl9DSEFOR0VTID0gX19kZXBlbmRlbmN5M19fLlJFVklTSU9OX0NIQU5HRVM7CiAgdmFyIGNyZWF0ZUZyYW1lID0gX19kZXBlbmRlbmN5M19fLmNyZWF0ZUZyYW1lOwoKICBmdW5jdGlvbiBjaGVja1JldmlzaW9uKGNvbXBpbGVySW5mbykgewogICAgdmFyIGNvbXBpbGVyUmV2aXNpb24gPSBjb21waWxlckluZm8gJiYgY29tcGlsZXJJbmZvWzBdIHx8IDEsCiAgICAgICAgY3VycmVudFJldmlzaW9uID0gQ09NUElMRVJfUkVWSVNJT047CgogICAgaWYgKGNvbXBpbGVyUmV2aXNpb24gIT09IGN1cnJlbnRSZXZpc2lvbikgewogICAgICBpZiAoY29tcGlsZXJSZXZpc2lvbiA8IGN1cnJlbnRSZXZpc2lvbikgewogICAgICAgIHZhciBydW50aW1lVmVyc2lvbnMgPSBSRVZJU0lPTl9DSEFOR0VTW2N1cnJlbnRSZXZpc2lvbl0sCiAgICAgICAgICAgIGNvbXBpbGVyVmVyc2lvbnMgPSBSRVZJU0lPTl9DSEFOR0VTW2NvbXBpbGVyUmV2aXNpb25dOwogICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIlRlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGFuIG9sZGVyIHZlcnNpb24gb2YgSGFuZGxlYmFycyB0aGFuIHRoZSBjdXJyZW50IHJ1bnRpbWUuICIrCiAgICAgICAgICAgICAgIlBsZWFzZSB1cGRhdGUgeW91ciBwcmVjb21waWxlciB0byBhIG5ld2VyIHZlcnNpb24gKCIrcnVudGltZVZlcnNpb25zKyIpIG9yIGRvd25ncmFkZSB5b3VyIHJ1bnRpbWUgdG8gYW4gb2xkZXIgdmVyc2lvbiAoIitjb21waWxlclZlcnNpb25zKyIpLiIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFVzZSB0aGUgZW1iZWRkZWQgdmVyc2lvbiBpbmZvIHNpbmNlIHRoZSBydW50aW1lIGRvZXNuJ3Qga25vdyBhYm91dCB0aGlzIHJldmlzaW9uIHlldAogICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIlRlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGEgbmV3ZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gIisKICAgICAgICAgICAgICAiUGxlYXNlIHVwZGF0ZSB5b3VyIHJ1bnRpbWUgdG8gYSBuZXdlciB2ZXJzaW9uICgiK2NvbXBpbGVySW5mb1sxXSsiKS4iKTsKICAgICAgfQogICAgfQogIH0KCiAgX19leHBvcnRzX18uY2hlY2tSZXZpc2lvbiA9IGNoZWNrUmV2aXNpb247Ly8gVE9ETzogUmVtb3ZlIHRoaXMgbGluZSBhbmQgYnJlYWsgdXAgY29tcGlsZVBhcnRpYWwKCiAgZnVuY3Rpb24gdGVtcGxhdGUodGVtcGxhdGVTcGVjLCBlbnYpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICBpZiAoIWVudikgewogICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJObyBlbnZpcm9ubWVudCBwYXNzZWQgdG8gdGVtcGxhdGUiKTsKICAgIH0KICAgIGlmICghdGVtcGxhdGVTcGVjIHx8ICF0ZW1wbGF0ZVNwZWMubWFpbikgewogICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdVbmtub3duIHRlbXBsYXRlIG9iamVjdDogJyArIHR5cGVvZiB0ZW1wbGF0ZVNwZWMpOwogICAgfQoKICAgIC8vIE5vdGU6IFVzaW5nIGVudi5WTSByZWZlcmVuY2VzIHJhdGhlciB0aGFuIGxvY2FsIHZhciByZWZlcmVuY2VzIHRocm91Z2hvdXQgdGhpcyBzZWN0aW9uIHRvIGFsbG93CiAgICAvLyBmb3IgZXh0ZXJuYWwgdXNlcnMgdG8gb3ZlcnJpZGUgdGhlc2UgYXMgcHN1ZWRvLXN1cHBvcnRlZCBBUElzLgogICAgZW52LlZNLmNoZWNrUmV2aXNpb24odGVtcGxhdGVTcGVjLmNvbXBpbGVyKTsKCiAgICB2YXIgaW52b2tlUGFydGlhbFdyYXBwZXIgPSBmdW5jdGlvbihwYXJ0aWFsLCBpbmRlbnQsIG5hbWUsIGNvbnRleHQsIGhhc2gsIGhlbHBlcnMsIHBhcnRpYWxzLCBkYXRhLCBkZXB0aHMpIHsKICAgICAgaWYgKGhhc2gpIHsKICAgICAgICBjb250ZXh0ID0gVXRpbHMuZXh0ZW5kKHt9LCBjb250ZXh0LCBoYXNoKTsKICAgICAgfQoKICAgICAgdmFyIHJlc3VsdCA9IGVudi5WTS5pbnZva2VQYXJ0aWFsLmNhbGwodGhpcywgcGFydGlhbCwgbmFtZSwgY29udGV4dCwgaGVscGVycywgcGFydGlhbHMsIGRhdGEsIGRlcHRocyk7CgogICAgICBpZiAocmVzdWx0ID09IG51bGwgJiYgZW52LmNvbXBpbGUpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IHsgaGVscGVyczogaGVscGVycywgcGFydGlhbHM6IHBhcnRpYWxzLCBkYXRhOiBkYXRhLCBkZXB0aHM6IGRlcHRocyB9OwogICAgICAgIHBhcnRpYWxzW25hbWVdID0gZW52LmNvbXBpbGUocGFydGlhbCwgeyBkYXRhOiBkYXRhICE9PSB1bmRlZmluZWQsIGNvbXBhdDogdGVtcGxhdGVTcGVjLmNvbXBhdCB9LCBlbnYpOwogICAgICAgIHJlc3VsdCA9IHBhcnRpYWxzW25hbWVdKGNvbnRleHQsIG9wdGlvbnMpOwogICAgICB9CiAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCkgewogICAgICAgIGlmIChpbmRlbnQpIHsKICAgICAgICAgIHZhciBsaW5lcyA9IHJlc3VsdC5zcGxpdCgnXG4nKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGluZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghbGluZXNbaV0gJiYgaSArIDEgPT09IGwpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGluZXNbaV0gPSBpbmRlbnQgKyBsaW5lc1tpXTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdCA9IGxpbmVzLmpvaW4oJ1xuJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiVGhlIHBhcnRpYWwgIiArIG5hbWUgKyAiIGNvdWxkIG5vdCBiZSBjb21waWxlZCB3aGVuIHJ1bm5pbmcgaW4gcnVudGltZS1vbmx5IG1vZGUiKTsKICAgICAgfQogICAgfTsKCiAgICAvLyBKdXN0IGFkZCB3YXRlcgogICAgdmFyIGNvbnRhaW5lciA9IHsKICAgICAgbG9va3VwOiBmdW5jdGlvbihkZXB0aHMsIG5hbWUpIHsKICAgICAgICB2YXIgbGVuID0gZGVwdGhzLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBpZiAoZGVwdGhzW2ldICYmIGRlcHRoc1tpXVtuYW1lXSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBkZXB0aHNbaV1bbmFtZV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBsYW1iZGE6IGZ1bmN0aW9uKGN1cnJlbnQsIGNvbnRleHQpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicgPyBjdXJyZW50LmNhbGwoY29udGV4dCkgOiBjdXJyZW50OwogICAgICB9LAoKICAgICAgZXNjYXBlRXhwcmVzc2lvbjogVXRpbHMuZXNjYXBlRXhwcmVzc2lvbiwKICAgICAgaW52b2tlUGFydGlhbDogaW52b2tlUGFydGlhbFdyYXBwZXIsCgogICAgICBmbjogZnVuY3Rpb24oaSkgewogICAgICAgIHJldHVybiB0ZW1wbGF0ZVNwZWNbaV07CiAgICAgIH0sCgogICAgICBwcm9ncmFtczogW10sCiAgICAgIHByb2dyYW06IGZ1bmN0aW9uKGksIGRhdGEsIGRlcHRocykgewogICAgICAgIHZhciBwcm9ncmFtV3JhcHBlciA9IHRoaXMucHJvZ3JhbXNbaV0sCiAgICAgICAgICAgIGZuID0gdGhpcy5mbihpKTsKICAgICAgICBpZiAoZGF0YSB8fCBkZXB0aHMpIHsKICAgICAgICAgIHByb2dyYW1XcmFwcGVyID0gcHJvZ3JhbSh0aGlzLCBpLCBmbiwgZGF0YSwgZGVwdGhzKTsKICAgICAgICB9IGVsc2UgaWYgKCFwcm9ncmFtV3JhcHBlcikgewogICAgICAgICAgcHJvZ3JhbVdyYXBwZXIgPSB0aGlzLnByb2dyYW1zW2ldID0gcHJvZ3JhbSh0aGlzLCBpLCBmbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm9ncmFtV3JhcHBlcjsKICAgICAgfSwKCiAgICAgIGRhdGE6IGZ1bmN0aW9uKGRhdGEsIGRlcHRoKSB7CiAgICAgICAgd2hpbGUgKGRhdGEgJiYgZGVwdGgtLSkgewogICAgICAgICAgZGF0YSA9IGRhdGEuX3BhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0sCiAgICAgIG1lcmdlOiBmdW5jdGlvbihwYXJhbSwgY29tbW9uKSB7CiAgICAgICAgdmFyIHJldCA9IHBhcmFtIHx8IGNvbW1vbjsKCiAgICAgICAgaWYgKHBhcmFtICYmIGNvbW1vbiAmJiAocGFyYW0gIT09IGNvbW1vbikpIHsKICAgICAgICAgIHJldCA9IFV0aWxzLmV4dGVuZCh7fSwgY29tbW9uLCBwYXJhbSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgICB9LAoKICAgICAgbm9vcDogZW52LlZNLm5vb3AsCiAgICAgIGNvbXBpbGVySW5mbzogdGVtcGxhdGVTcGVjLmNvbXBpbGVyCiAgICB9OwoKICAgIHZhciByZXQgPSBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB2YXIgZGF0YSA9IG9wdGlvbnMuZGF0YTsKCiAgICAgIHJldC5fc2V0dXAob3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy5wYXJ0aWFsICYmIHRlbXBsYXRlU3BlYy51c2VEYXRhKSB7CiAgICAgICAgZGF0YSA9IGluaXREYXRhKGNvbnRleHQsIGRhdGEpOwogICAgICB9CiAgICAgIHZhciBkZXB0aHM7CiAgICAgIGlmICh0ZW1wbGF0ZVNwZWMudXNlRGVwdGhzKSB7CiAgICAgICAgZGVwdGhzID0gb3B0aW9ucy5kZXB0aHMgPyBbY29udGV4dF0uY29uY2F0KG9wdGlvbnMuZGVwdGhzKSA6IFtjb250ZXh0XTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRlbXBsYXRlU3BlYy5tYWluLmNhbGwoY29udGFpbmVyLCBjb250ZXh0LCBjb250YWluZXIuaGVscGVycywgY29udGFpbmVyLnBhcnRpYWxzLCBkYXRhLCBkZXB0aHMpOwogICAgfTsKICAgIHJldC5pc1RvcCA9IHRydWU7CgogICAgcmV0Ll9zZXR1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKCFvcHRpb25zLnBhcnRpYWwpIHsKICAgICAgICBjb250YWluZXIuaGVscGVycyA9IGNvbnRhaW5lci5tZXJnZShvcHRpb25zLmhlbHBlcnMsIGVudi5oZWxwZXJzKTsKCiAgICAgICAgaWYgKHRlbXBsYXRlU3BlYy51c2VQYXJ0aWFsKSB7CiAgICAgICAgICBjb250YWluZXIucGFydGlhbHMgPSBjb250YWluZXIubWVyZ2Uob3B0aW9ucy5wYXJ0aWFscywgZW52LnBhcnRpYWxzKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29udGFpbmVyLmhlbHBlcnMgPSBvcHRpb25zLmhlbHBlcnM7CiAgICAgICAgY29udGFpbmVyLnBhcnRpYWxzID0gb3B0aW9ucy5wYXJ0aWFsczsKICAgICAgfQogICAgfTsKCiAgICByZXQuX2NoaWxkID0gZnVuY3Rpb24oaSwgZGF0YSwgZGVwdGhzKSB7CiAgICAgIGlmICh0ZW1wbGF0ZVNwZWMudXNlRGVwdGhzICYmICFkZXB0aHMpIHsKICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdtdXN0IHBhc3MgcGFyZW50IGRlcHRocycpOwogICAgICB9CgogICAgICByZXR1cm4gcHJvZ3JhbShjb250YWluZXIsIGksIHRlbXBsYXRlU3BlY1tpXSwgZGF0YSwgZGVwdGhzKTsKICAgIH07CiAgICByZXR1cm4gcmV0OwogIH0KCiAgX19leHBvcnRzX18udGVtcGxhdGUgPSB0ZW1wbGF0ZTtmdW5jdGlvbiBwcm9ncmFtKGNvbnRhaW5lciwgaSwgZm4sIGRhdGEsIGRlcHRocykgewogICAgdmFyIHByb2cgPSBmdW5jdGlvbihjb250ZXh0LCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgcmV0dXJuIGZuLmNhbGwoY29udGFpbmVyLCBjb250ZXh0LCBjb250YWluZXIuaGVscGVycywgY29udGFpbmVyLnBhcnRpYWxzLCBvcHRpb25zLmRhdGEgfHwgZGF0YSwgZGVwdGhzICYmIFtjb250ZXh0XS5jb25jYXQoZGVwdGhzKSk7CiAgICB9OwogICAgcHJvZy5wcm9ncmFtID0gaTsKICAgIHByb2cuZGVwdGggPSBkZXB0aHMgPyBkZXB0aHMubGVuZ3RoIDogMDsKICAgIHJldHVybiBwcm9nOwogIH0KCiAgX19leHBvcnRzX18ucHJvZ3JhbSA9IHByb2dyYW07ZnVuY3Rpb24gaW52b2tlUGFydGlhbChwYXJ0aWFsLCBuYW1lLCBjb250ZXh0LCBoZWxwZXJzLCBwYXJ0aWFscywgZGF0YSwgZGVwdGhzKSB7CiAgICB2YXIgb3B0aW9ucyA9IHsgcGFydGlhbDogdHJ1ZSwgaGVscGVyczogaGVscGVycywgcGFydGlhbHM6IHBhcnRpYWxzLCBkYXRhOiBkYXRhLCBkZXB0aHM6IGRlcHRocyB9OwoKICAgIGlmKHBhcnRpYWwgPT09IHVuZGVmaW5lZCkgewogICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCJUaGUgcGFydGlhbCAiICsgbmFtZSArICIgY291bGQgbm90IGJlIGZvdW5kIik7CiAgICB9IGVsc2UgaWYocGFydGlhbCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgIHJldHVybiBwYXJ0aWFsKGNvbnRleHQsIG9wdGlvbnMpOwogICAgfQogIH0KCiAgX19leHBvcnRzX18uaW52b2tlUGFydGlhbCA9IGludm9rZVBhcnRpYWw7ZnVuY3Rpb24gbm9vcCgpIHsgcmV0dXJuICIiOyB9CgogIF9fZXhwb3J0c19fLm5vb3AgPSBub29wO2Z1bmN0aW9uIGluaXREYXRhKGNvbnRleHQsIGRhdGEpIHsKICAgIGlmICghZGF0YSB8fCAhKCdyb290JyBpbiBkYXRhKSkgewogICAgICBkYXRhID0gZGF0YSA/IGNyZWF0ZUZyYW1lKGRhdGEpIDoge307CiAgICAgIGRhdGEucm9vdCA9IGNvbnRleHQ7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgcmV0dXJuIF9fZXhwb3J0c19fOwp9KShfX21vZHVsZTNfXywgX19tb2R1bGU1X18sIF9fbW9kdWxlMl9fKTsKCi8vIGhhbmRsZWJhcnMucnVudGltZS5qcwp2YXIgX19tb2R1bGUxX18gPSAoZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2RlcGVuZGVuY3kyX18sIF9fZGVwZW5kZW5jeTNfXywgX19kZXBlbmRlbmN5NF9fLCBfX2RlcGVuZGVuY3k1X18pIHsKICAidXNlIHN0cmljdCI7CiAgdmFyIF9fZXhwb3J0c19fOwogIC8qZ2xvYmFscyBIYW5kbGViYXJzOiB0cnVlICovCiAgdmFyIGJhc2UgPSBfX2RlcGVuZGVuY3kxX187CgogIC8vIEVhY2ggb2YgdGhlc2UgYXVnbWVudCB0aGUgSGFuZGxlYmFycyBvYmplY3QuIE5vIG5lZWQgdG8gc2V0dXAgaGVyZS4KICAvLyAoVGhpcyBpcyBkb25lIHRvIGVhc2lseSBzaGFyZSBjb2RlIGJldHdlZW4gY29tbW9uanMgYW5kIGJyb3dzZSBlbnZzKQogIHZhciBTYWZlU3RyaW5nID0gX19kZXBlbmRlbmN5Ml9fOwogIHZhciBFeGNlcHRpb24gPSBfX2RlcGVuZGVuY3kzX187CiAgdmFyIFV0aWxzID0gX19kZXBlbmRlbmN5NF9fOwogIHZhciBydW50aW1lID0gX19kZXBlbmRlbmN5NV9fOwoKICAvLyBGb3IgY29tcGF0aWJpbGl0eSBhbmQgdXNhZ2Ugb3V0c2lkZSBvZiBtb2R1bGUgc3lzdGVtcywgbWFrZSB0aGUgSGFuZGxlYmFycyBvYmplY3QgYSBuYW1lc3BhY2UKICB2YXIgY3JlYXRlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaGIgPSBuZXcgYmFzZS5IYW5kbGViYXJzRW52aXJvbm1lbnQoKTsKCiAgICBVdGlscy5leHRlbmQoaGIsIGJhc2UpOwogICAgaGIuU2FmZVN0cmluZyA9IFNhZmVTdHJpbmc7CiAgICBoYi5FeGNlcHRpb24gPSBFeGNlcHRpb247CiAgICBoYi5VdGlscyA9IFV0aWxzOwogICAgaGIuZXNjYXBlRXhwcmVzc2lvbiA9IFV0aWxzLmVzY2FwZUV4cHJlc3Npb247CgogICAgaGIuVk0gPSBydW50aW1lOwogICAgaGIudGVtcGxhdGUgPSBmdW5jdGlvbihzcGVjKSB7CiAgICAgIHJldHVybiBydW50aW1lLnRlbXBsYXRlKHNwZWMsIGhiKTsKICAgIH07CgogICAgcmV0dXJuIGhiOwogIH07CgogIHZhciBIYW5kbGViYXJzID0gY3JlYXRlKCk7CiAgSGFuZGxlYmFycy5jcmVhdGUgPSBjcmVhdGU7CgogIEhhbmRsZWJhcnNbJ2RlZmF1bHQnXSA9IEhhbmRsZWJhcnM7CgogIF9fZXhwb3J0c19fID0gSGFuZGxlYmFyczsKICByZXR1cm4gX19leHBvcnRzX187Cn0pKF9fbW9kdWxlMl9fLCBfX21vZHVsZTRfXywgX19tb2R1bGU1X18sIF9fbW9kdWxlM19fLCBfX21vZHVsZTZfXyk7CgovLyBoYW5kbGViYXJzL2NvbXBpbGVyL2FzdC5qcwp2YXIgX19tb2R1bGU3X18gPSAoZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX2V4cG9ydHNfXzsKICB2YXIgRXhjZXB0aW9uID0gX19kZXBlbmRlbmN5MV9fOwoKICBmdW5jdGlvbiBMb2NhdGlvbkluZm8obG9jSW5mbykgewogICAgbG9jSW5mbyA9IGxvY0luZm8gfHwge307CiAgICB0aGlzLmZpcnN0TGluZSAgID0gbG9jSW5mby5maXJzdF9saW5lOwogICAgdGhpcy5maXJzdENvbHVtbiA9IGxvY0luZm8uZmlyc3RfY29sdW1uOwogICAgdGhpcy5sYXN0Q29sdW1uICA9IGxvY0luZm8ubGFzdF9jb2x1bW47CiAgICB0aGlzLmxhc3RMaW5lICAgID0gbG9jSW5mby5sYXN0X2xpbmU7CiAgfQoKICB2YXIgQVNUID0gewogICAgUHJvZ3JhbU5vZGU6IGZ1bmN0aW9uKHN0YXRlbWVudHMsIHN0cmlwLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwogICAgICB0aGlzLnR5cGUgPSAicHJvZ3JhbSI7CiAgICAgIHRoaXMuc3RhdGVtZW50cyA9IHN0YXRlbWVudHM7CiAgICAgIHRoaXMuc3RyaXAgPSBzdHJpcDsKICAgIH0sCgogICAgTXVzdGFjaGVOb2RlOiBmdW5jdGlvbihyYXdQYXJhbXMsIGhhc2gsIG9wZW4sIHN0cmlwLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwogICAgICB0aGlzLnR5cGUgPSAibXVzdGFjaGUiOwogICAgICB0aGlzLnN0cmlwID0gc3RyaXA7CgogICAgICAvLyBPcGVuIG1heSBiZSBhIHN0cmluZyBwYXJzZWQgZnJvbSB0aGUgcGFyc2VyIG9yIGEgcGFzc2VkIGJvb2xlYW4gZmxhZwogICAgICBpZiAob3BlbiAhPSBudWxsICYmIG9wZW4uY2hhckF0KSB7CiAgICAgICAgLy8gTXVzdCB1c2UgY2hhckF0IHRvIHN1cHBvcnQgSUUgcHJlLTEwCiAgICAgICAgdmFyIGVzY2FwZUZsYWcgPSBvcGVuLmNoYXJBdCgzKSB8fCBvcGVuLmNoYXJBdCgyKTsKICAgICAgICB0aGlzLmVzY2FwZWQgPSBlc2NhcGVGbGFnICE9PSAneycgJiYgZXNjYXBlRmxhZyAhPT0gJyYnOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZXNjYXBlZCA9ICEhb3BlbjsKICAgICAgfQoKICAgICAgaWYgKHJhd1BhcmFtcyBpbnN0YW5jZW9mIEFTVC5TZXhwck5vZGUpIHsKICAgICAgICB0aGlzLnNleHByID0gcmF3UGFyYW1zOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFN1cHBvcnQgb2xkIEFTVCBBUEkKICAgICAgICB0aGlzLnNleHByID0gbmV3IEFTVC5TZXhwck5vZGUocmF3UGFyYW1zLCBoYXNoKTsKICAgICAgfQoKICAgICAgLy8gU3VwcG9ydCBvbGQgQVNUIEFQSSB0aGF0IHN0b3JlZCB0aGlzIGluZm8gaW4gTXVzdGFjaGVOb2RlCiAgICAgIHRoaXMuaWQgPSB0aGlzLnNleHByLmlkOwogICAgICB0aGlzLnBhcmFtcyA9IHRoaXMuc2V4cHIucGFyYW1zOwogICAgICB0aGlzLmhhc2ggPSB0aGlzLnNleHByLmhhc2g7CiAgICAgIHRoaXMuZWxpZ2libGVIZWxwZXIgPSB0aGlzLnNleHByLmVsaWdpYmxlSGVscGVyOwogICAgICB0aGlzLmlzSGVscGVyID0gdGhpcy5zZXhwci5pc0hlbHBlcjsKICAgIH0sCgogICAgU2V4cHJOb2RlOiBmdW5jdGlvbihyYXdQYXJhbXMsIGhhc2gsIGxvY0luZm8pIHsKICAgICAgTG9jYXRpb25JbmZvLmNhbGwodGhpcywgbG9jSW5mbyk7CgogICAgICB0aGlzLnR5cGUgPSAic2V4cHIiOwogICAgICB0aGlzLmhhc2ggPSBoYXNoOwoKICAgICAgdmFyIGlkID0gdGhpcy5pZCA9IHJhd1BhcmFtc1swXTsKICAgICAgdmFyIHBhcmFtcyA9IHRoaXMucGFyYW1zID0gcmF3UGFyYW1zLnNsaWNlKDEpOwoKICAgICAgLy8gYSBtdXN0YWNoZSBpcyBkZWZpbml0ZWx5IGEgaGVscGVyIGlmOgogICAgICAvLyAqIGl0IGlzIGFuIGVsaWdpYmxlIGhlbHBlciwgYW5kCiAgICAgIC8vICogaXQgaGFzIGF0IGxlYXN0IG9uZSBwYXJhbWV0ZXIgb3IgaGFzaCBzZWdtZW50CiAgICAgIHRoaXMuaXNIZWxwZXIgPSAhIShwYXJhbXMubGVuZ3RoIHx8IGhhc2gpOwoKICAgICAgLy8gYSBtdXN0YWNoZSBpcyBhbiBlbGlnaWJsZSBoZWxwZXIgaWY6CiAgICAgIC8vICogaXRzIGlkIGlzIHNpbXBsZSAoYSBzaW5nbGUgcGFydCwgbm90IGB0aGlzYCBvciBgLi5gKQogICAgICB0aGlzLmVsaWdpYmxlSGVscGVyID0gdGhpcy5pc0hlbHBlciB8fCBpZC5pc1NpbXBsZTsKCiAgICAgIC8vIGlmIGEgbXVzdGFjaGUgaXMgYW4gZWxpZ2libGUgaGVscGVyIGJ1dCBub3QgYSBkZWZpbml0ZQogICAgICAvLyBoZWxwZXIsIGl0IGlzIGFtYmlndW91cywgYW5kIHdpbGwgYmUgcmVzb2x2ZWQgaW4gYSBsYXRlcgogICAgICAvLyBwYXNzIG9yIGF0IHJ1bnRpbWUuCiAgICB9LAoKICAgIFBhcnRpYWxOb2RlOiBmdW5jdGlvbihwYXJ0aWFsTmFtZSwgY29udGV4dCwgaGFzaCwgc3RyaXAsIGxvY0luZm8pIHsKICAgICAgTG9jYXRpb25JbmZvLmNhbGwodGhpcywgbG9jSW5mbyk7CiAgICAgIHRoaXMudHlwZSAgICAgICAgID0gInBhcnRpYWwiOwogICAgICB0aGlzLnBhcnRpYWxOYW1lICA9IHBhcnRpYWxOYW1lOwogICAgICB0aGlzLmNvbnRleHQgICAgICA9IGNvbnRleHQ7CiAgICAgIHRoaXMuaGFzaCA9IGhhc2g7CiAgICAgIHRoaXMuc3RyaXAgPSBzdHJpcDsKCiAgICAgIHRoaXMuc3RyaXAuaW5saW5lU3RhbmRhbG9uZSA9IHRydWU7CiAgICB9LAoKICAgIEJsb2NrTm9kZTogZnVuY3Rpb24obXVzdGFjaGUsIHByb2dyYW0sIGludmVyc2UsIHN0cmlwLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwoKICAgICAgdGhpcy50eXBlID0gJ2Jsb2NrJzsKICAgICAgdGhpcy5tdXN0YWNoZSA9IG11c3RhY2hlOwogICAgICB0aGlzLnByb2dyYW0gID0gcHJvZ3JhbTsKICAgICAgdGhpcy5pbnZlcnNlICA9IGludmVyc2U7CiAgICAgIHRoaXMuc3RyaXAgPSBzdHJpcDsKCiAgICAgIGlmIChpbnZlcnNlICYmICFwcm9ncmFtKSB7CiAgICAgICAgdGhpcy5pc0ludmVyc2UgPSB0cnVlOwogICAgICB9CiAgICB9LAoKICAgIFJhd0Jsb2NrTm9kZTogZnVuY3Rpb24obXVzdGFjaGUsIGNvbnRlbnQsIGNsb3NlLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwoKICAgICAgaWYgKG11c3RhY2hlLnNleHByLmlkLm9yaWdpbmFsICE9PSBjbG9zZSkgewogICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24obXVzdGFjaGUuc2V4cHIuaWQub3JpZ2luYWwgKyAiIGRvZXNuJ3QgbWF0Y2ggIiArIGNsb3NlLCB0aGlzKTsKICAgICAgfQoKICAgICAgY29udGVudCA9IG5ldyBBU1QuQ29udGVudE5vZGUoY29udGVudCwgbG9jSW5mbyk7CgogICAgICB0aGlzLnR5cGUgPSAnYmxvY2snOwogICAgICB0aGlzLm11c3RhY2hlID0gbXVzdGFjaGU7CiAgICAgIHRoaXMucHJvZ3JhbSA9IG5ldyBBU1QuUHJvZ3JhbU5vZGUoW2NvbnRlbnRdLCB7fSwgbG9jSW5mbyk7CiAgICB9LAoKICAgIENvbnRlbnROb2RlOiBmdW5jdGlvbihzdHJpbmcsIGxvY0luZm8pIHsKICAgICAgTG9jYXRpb25JbmZvLmNhbGwodGhpcywgbG9jSW5mbyk7CiAgICAgIHRoaXMudHlwZSA9ICJjb250ZW50IjsKICAgICAgdGhpcy5vcmlnaW5hbCA9IHRoaXMuc3RyaW5nID0gc3RyaW5nOwogICAgfSwKCiAgICBIYXNoTm9kZTogZnVuY3Rpb24ocGFpcnMsIGxvY0luZm8pIHsKICAgICAgTG9jYXRpb25JbmZvLmNhbGwodGhpcywgbG9jSW5mbyk7CiAgICAgIHRoaXMudHlwZSA9ICJoYXNoIjsKICAgICAgdGhpcy5wYWlycyA9IHBhaXJzOwogICAgfSwKCiAgICBJZE5vZGU6IGZ1bmN0aW9uKHBhcnRzLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwogICAgICB0aGlzLnR5cGUgPSAiSUQiOwoKICAgICAgdmFyIG9yaWdpbmFsID0gIiIsCiAgICAgICAgICBkaWcgPSBbXSwKICAgICAgICAgIGRlcHRoID0gMCwKICAgICAgICAgIGRlcHRoU3RyaW5nID0gJyc7CgogICAgICBmb3IodmFyIGk9MCxsPXBhcnRzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICB2YXIgcGFydCA9IHBhcnRzW2ldLnBhcnQ7CiAgICAgICAgb3JpZ2luYWwgKz0gKHBhcnRzW2ldLnNlcGFyYXRvciB8fCAnJykgKyBwYXJ0OwoKICAgICAgICBpZiAocGFydCA9PT0gIi4uIiB8fCBwYXJ0ID09PSAiLiIgfHwgcGFydCA9PT0gInRoaXMiKSB7CiAgICAgICAgICBpZiAoZGlnLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiSW52YWxpZCBwYXRoOiAiICsgb3JpZ2luYWwsIHRoaXMpOwogICAgICAgICAgfSBlbHNlIGlmIChwYXJ0ID09PSAiLi4iKSB7CiAgICAgICAgICAgIGRlcHRoKys7CiAgICAgICAgICAgIGRlcHRoU3RyaW5nICs9ICcuLi8nOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pc1Njb3BlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRpZy5wdXNoKHBhcnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5vcmlnaW5hbCA9IG9yaWdpbmFsOwogICAgICB0aGlzLnBhcnRzICAgID0gZGlnOwogICAgICB0aGlzLnN0cmluZyAgID0gZGlnLmpvaW4oJy4nKTsKICAgICAgdGhpcy5kZXB0aCAgICA9IGRlcHRoOwogICAgICB0aGlzLmlkTmFtZSAgID0gZGVwdGhTdHJpbmcgKyB0aGlzLnN0cmluZzsKCiAgICAgIC8vIGFuIElEIGlzIHNpbXBsZSBpZiBpdCBvbmx5IGhhcyBvbmUgcGFydCwgYW5kIHRoYXQgcGFydCBpcyBub3QKICAgICAgLy8gYC4uYCBvciBgdGhpc2AuCiAgICAgIHRoaXMuaXNTaW1wbGUgPSBwYXJ0cy5sZW5ndGggPT09IDEgJiYgIXRoaXMuaXNTY29wZWQgJiYgZGVwdGggPT09IDA7CgogICAgICB0aGlzLnN0cmluZ01vZGVWYWx1ZSA9IHRoaXMuc3RyaW5nOwogICAgfSwKCiAgICBQYXJ0aWFsTmFtZU5vZGU6IGZ1bmN0aW9uKG5hbWUsIGxvY0luZm8pIHsKICAgICAgTG9jYXRpb25JbmZvLmNhbGwodGhpcywgbG9jSW5mbyk7CiAgICAgIHRoaXMudHlwZSA9ICJQQVJUSUFMX05BTUUiOwogICAgICB0aGlzLm5hbWUgPSBuYW1lLm9yaWdpbmFsOwogICAgfSwKCiAgICBEYXRhTm9kZTogZnVuY3Rpb24oaWQsIGxvY0luZm8pIHsKICAgICAgTG9jYXRpb25JbmZvLmNhbGwodGhpcywgbG9jSW5mbyk7CiAgICAgIHRoaXMudHlwZSA9ICJEQVRBIjsKICAgICAgdGhpcy5pZCA9IGlkOwogICAgICB0aGlzLnN0cmluZ01vZGVWYWx1ZSA9IGlkLnN0cmluZ01vZGVWYWx1ZTsKICAgICAgdGhpcy5pZE5hbWUgPSAnQCcgKyBpZC5zdHJpbmdNb2RlVmFsdWU7CiAgICB9LAoKICAgIFN0cmluZ05vZGU6IGZ1bmN0aW9uKHN0cmluZywgbG9jSW5mbykgewogICAgICBMb2NhdGlvbkluZm8uY2FsbCh0aGlzLCBsb2NJbmZvKTsKICAgICAgdGhpcy50eXBlID0gIlNUUklORyI7CiAgICAgIHRoaXMub3JpZ2luYWwgPQogICAgICAgIHRoaXMuc3RyaW5nID0KICAgICAgICB0aGlzLnN0cmluZ01vZGVWYWx1ZSA9IHN0cmluZzsKICAgIH0sCgogICAgTnVtYmVyTm9kZTogZnVuY3Rpb24obnVtYmVyLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwogICAgICB0aGlzLnR5cGUgPSAiTlVNQkVSIjsKICAgICAgdGhpcy5vcmlnaW5hbCA9CiAgICAgICAgdGhpcy5udW1iZXIgPSBudW1iZXI7CiAgICAgIHRoaXMuc3RyaW5nTW9kZVZhbHVlID0gTnVtYmVyKG51bWJlcik7CiAgICB9LAoKICAgIEJvb2xlYW5Ob2RlOiBmdW5jdGlvbihib29sLCBsb2NJbmZvKSB7CiAgICAgIExvY2F0aW9uSW5mby5jYWxsKHRoaXMsIGxvY0luZm8pOwogICAgICB0aGlzLnR5cGUgPSAiQk9PTEVBTiI7CiAgICAgIHRoaXMuYm9vbCA9IGJvb2w7CiAgICAgIHRoaXMuc3RyaW5nTW9kZVZhbHVlID0gYm9vbCA9PT0gInRydWUiOwogICAgfSwKCiAgICBDb21tZW50Tm9kZTogZnVuY3Rpb24oY29tbWVudCwgbG9jSW5mbykgewogICAgICBMb2NhdGlvbkluZm8uY2FsbCh0aGlzLCBsb2NJbmZvKTsKICAgICAgdGhpcy50eXBlID0gImNvbW1lbnQiOwogICAgICB0aGlzLmNvbW1lbnQgPSBjb21tZW50OwoKICAgICAgdGhpcy5zdHJpcCA9IHsKICAgICAgICBpbmxpbmVTdGFuZGFsb25lOiB0cnVlCiAgICAgIH07CiAgICB9CiAgfTsKCgogIC8vIE11c3QgYmUgZXhwb3J0ZWQgYXMgYW4gb2JqZWN0IHJhdGhlciB0aGFuIHRoZSByb290IG9mIHRoZSBtb2R1bGUgYXMgdGhlIGppc29uIGxleGVyCiAgLy8gbW9zdCBtb2RpZnkgdGhlIG9iamVjdCB0byBvcGVyYXRlIHByb3Blcmx5LgogIF9fZXhwb3J0c19fID0gQVNUOwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSkoX19tb2R1bGU1X18pOwoKLy8gaGFuZGxlYmFycy9jb21waWxlci9wYXJzZXIuanMKdmFyIF9fbW9kdWxlOV9fID0gKGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX187CiAgLyoganNoaW50IGlnbm9yZTpzdGFydCAqLwogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgLyogSmlzb24gZ2VuZXJhdGVkIHBhcnNlciAqLwogIHZhciBoYW5kbGViYXJzID0gKGZ1bmN0aW9uKCl7CiAgdmFyIHBhcnNlciA9IHt0cmFjZTogZnVuY3Rpb24gdHJhY2UoKSB7IH0sCiAgeXk6IHt9LAogIHN5bWJvbHNfOiB7ImVycm9yIjoyLCJyb290IjozLCJwcm9ncmFtIjo0LCJFT0YiOjUsInByb2dyYW1fcmVwZXRpdGlvbjAiOjYsInN0YXRlbWVudCI6NywibXVzdGFjaGUiOjgsImJsb2NrIjo5LCJyYXdCbG9jayI6MTAsInBhcnRpYWwiOjExLCJDT05URU5UIjoxMiwiQ09NTUVOVCI6MTMsIm9wZW5SYXdCbG9jayI6MTQsIkVORF9SQVdfQkxPQ0siOjE1LCJPUEVOX1JBV19CTE9DSyI6MTYsInNleHByIjoxNywiQ0xPU0VfUkFXX0JMT0NLIjoxOCwib3BlbkJsb2NrIjoxOSwiYmxvY2tfb3B0aW9uMCI6MjAsImNsb3NlQmxvY2siOjIxLCJvcGVuSW52ZXJzZSI6MjIsImJsb2NrX29wdGlvbjEiOjIzLCJPUEVOX0JMT0NLIjoyNCwiQ0xPU0UiOjI1LCJPUEVOX0lOVkVSU0UiOjI2LCJpbnZlcnNlQW5kUHJvZ3JhbSI6MjcsIklOVkVSU0UiOjI4LCJPUEVOX0VOREJMT0NLIjoyOSwicGF0aCI6MzAsIk9QRU4iOjMxLCJPUEVOX1VORVNDQVBFRCI6MzIsIkNMT1NFX1VORVNDQVBFRCI6MzMsIk9QRU5fUEFSVElBTCI6MzQsInBhcnRpYWxOYW1lIjozNSwicGFyYW0iOjM2LCJwYXJ0aWFsX29wdGlvbjAiOjM3LCJwYXJ0aWFsX29wdGlvbjEiOjM4LCJzZXhwcl9yZXBldGl0aW9uMCI6MzksInNleHByX29wdGlvbjAiOjQwLCJkYXRhTmFtZSI6NDEsIlNUUklORyI6NDIsIk5VTUJFUiI6NDMsIkJPT0xFQU4iOjQ0LCJPUEVOX1NFWFBSIjo0NSwiQ0xPU0VfU0VYUFIiOjQ2LCJoYXNoIjo0NywiaGFzaF9yZXBldGl0aW9uX3BsdXMwIjo0OCwiaGFzaFNlZ21lbnQiOjQ5LCJJRCI6NTAsIkVRVUFMUyI6NTEsIkRBVEEiOjUyLCJwYXRoU2VnbWVudHMiOjUzLCJTRVAiOjU0LCIkYWNjZXB0IjowLCIkZW5kIjoxfSwKICB0ZXJtaW5hbHNfOiB7MjoiZXJyb3IiLDU6IkVPRiIsMTI6IkNPTlRFTlQiLDEzOiJDT01NRU5UIiwxNToiRU5EX1JBV19CTE9DSyIsMTY6Ik9QRU5fUkFXX0JMT0NLIiwxODoiQ0xPU0VfUkFXX0JMT0NLIiwyNDoiT1BFTl9CTE9DSyIsMjU6IkNMT1NFIiwyNjoiT1BFTl9JTlZFUlNFIiwyODoiSU5WRVJTRSIsMjk6Ik9QRU5fRU5EQkxPQ0siLDMxOiJPUEVOIiwzMjoiT1BFTl9VTkVTQ0FQRUQiLDMzOiJDTE9TRV9VTkVTQ0FQRUQiLDM0OiJPUEVOX1BBUlRJQUwiLDQyOiJTVFJJTkciLDQzOiJOVU1CRVIiLDQ0OiJCT09MRUFOIiw0NToiT1BFTl9TRVhQUiIsNDY6IkNMT1NFX1NFWFBSIiw1MDoiSUQiLDUxOiJFUVVBTFMiLDUyOiJEQVRBIiw1NDoiU0VQIn0sCiAgcHJvZHVjdGlvbnNfOiBbMCxbMywyXSxbNCwxXSxbNywxXSxbNywxXSxbNywxXSxbNywxXSxbNywxXSxbNywxXSxbMTAsM10sWzE0LDNdLFs5LDRdLFs5LDRdLFsxOSwzXSxbMjIsM10sWzI3LDJdLFsyMSwzXSxbOCwzXSxbOCwzXSxbMTEsNV0sWzExLDRdLFsxNywzXSxbMTcsMV0sWzM2LDFdLFszNiwxXSxbMzYsMV0sWzM2LDFdLFszNiwxXSxbMzYsM10sWzQ3LDFdLFs0OSwzXSxbMzUsMV0sWzM1LDFdLFszNSwxXSxbNDEsMl0sWzMwLDFdLFs1MywzXSxbNTMsMV0sWzYsMF0sWzYsMl0sWzIwLDBdLFsyMCwxXSxbMjMsMF0sWzIzLDFdLFszNywwXSxbMzcsMV0sWzM4LDBdLFszOCwxXSxbMzksMF0sWzM5LDJdLFs0MCwwXSxbNDAsMV0sWzQ4LDFdLFs0OCwyXV0sCiAgcGVyZm9ybUFjdGlvbjogZnVuY3Rpb24gYW5vbnltb3VzKHl5dGV4dCx5eWxlbmcseXlsaW5lbm8seXkseXlzdGF0ZSwkJCxfJCkgewoKICB2YXIgJDAgPSAkJC5sZW5ndGggLSAxOwogIHN3aXRjaCAoeXlzdGF0ZSkgewogIGNhc2UgMTogeXkucHJlcGFyZVByb2dyYW0oJCRbJDAtMV0uc3RhdGVtZW50cywgdHJ1ZSk7IHJldHVybiAkJFskMC0xXTsKICBicmVhazsKICBjYXNlIDI6dGhpcy4kID0gbmV3IHl5LlByb2dyYW1Ob2RlKHl5LnByZXBhcmVQcm9ncmFtKCQkWyQwXSksIHt9LCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDM6dGhpcy4kID0gJCRbJDBdOwogIGJyZWFrOwogIGNhc2UgNDp0aGlzLiQgPSAkJFskMF07CiAgYnJlYWs7CiAgY2FzZSA1OnRoaXMuJCA9ICQkWyQwXTsKICBicmVhazsKICBjYXNlIDY6dGhpcy4kID0gJCRbJDBdOwogIGJyZWFrOwogIGNhc2UgNzp0aGlzLiQgPSBuZXcgeXkuQ29udGVudE5vZGUoJCRbJDBdLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDg6dGhpcy4kID0gbmV3IHl5LkNvbW1lbnROb2RlKCQkWyQwXSwgdGhpcy5fJCk7CiAgYnJlYWs7CiAgY2FzZSA5OnRoaXMuJCA9IG5ldyB5eS5SYXdCbG9ja05vZGUoJCRbJDAtMl0sICQkWyQwLTFdLCAkJFskMF0sIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMTA6dGhpcy4kID0gbmV3IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXSwgbnVsbCwgJycsICcnLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDExOnRoaXMuJCA9IHl5LnByZXBhcmVCbG9jaygkJFskMC0zXSwgJCRbJDAtMl0sICQkWyQwLTFdLCAkJFskMF0sIGZhbHNlLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDEyOnRoaXMuJCA9IHl5LnByZXBhcmVCbG9jaygkJFskMC0zXSwgJCRbJDAtMl0sICQkWyQwLTFdLCAkJFskMF0sIHRydWUsIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMTM6dGhpcy4kID0gbmV3IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXSwgbnVsbCwgJCRbJDAtMl0sIHl5LnN0cmlwRmxhZ3MoJCRbJDAtMl0sICQkWyQwXSksIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMTQ6dGhpcy4kID0gbmV3IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXSwgbnVsbCwgJCRbJDAtMl0sIHl5LnN0cmlwRmxhZ3MoJCRbJDAtMl0sICQkWyQwXSksIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMTU6dGhpcy4kID0geyBzdHJpcDogeXkuc3RyaXBGbGFncygkJFskMC0xXSwgJCRbJDAtMV0pLCBwcm9ncmFtOiAkJFskMF0gfTsKICBicmVhazsKICBjYXNlIDE2OnRoaXMuJCA9IHtwYXRoOiAkJFskMC0xXSwgc3RyaXA6IHl5LnN0cmlwRmxhZ3MoJCRbJDAtMl0sICQkWyQwXSl9OwogIGJyZWFrOwogIGNhc2UgMTc6dGhpcy4kID0gbmV3IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXSwgbnVsbCwgJCRbJDAtMl0sIHl5LnN0cmlwRmxhZ3MoJCRbJDAtMl0sICQkWyQwXSksIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMTg6dGhpcy4kID0gbmV3IHl5Lk11c3RhY2hlTm9kZSgkJFskMC0xXSwgbnVsbCwgJCRbJDAtMl0sIHl5LnN0cmlwRmxhZ3MoJCRbJDAtMl0sICQkWyQwXSksIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMTk6dGhpcy4kID0gbmV3IHl5LlBhcnRpYWxOb2RlKCQkWyQwLTNdLCAkJFskMC0yXSwgJCRbJDAtMV0sIHl5LnN0cmlwRmxhZ3MoJCRbJDAtNF0sICQkWyQwXSksIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMjA6dGhpcy4kID0gbmV3IHl5LlBhcnRpYWxOb2RlKCQkWyQwLTJdLCB1bmRlZmluZWQsICQkWyQwLTFdLCB5eS5zdHJpcEZsYWdzKCQkWyQwLTNdLCAkJFskMF0pLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDIxOnRoaXMuJCA9IG5ldyB5eS5TZXhwck5vZGUoWyQkWyQwLTJdXS5jb25jYXQoJCRbJDAtMV0pLCAkJFskMF0sIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMjI6dGhpcy4kID0gbmV3IHl5LlNleHByTm9kZShbJCRbJDBdXSwgbnVsbCwgdGhpcy5fJCk7CiAgYnJlYWs7CiAgY2FzZSAyMzp0aGlzLiQgPSAkJFskMF07CiAgYnJlYWs7CiAgY2FzZSAyNDp0aGlzLiQgPSBuZXcgeXkuU3RyaW5nTm9kZSgkJFskMF0sIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMjU6dGhpcy4kID0gbmV3IHl5Lk51bWJlck5vZGUoJCRbJDBdLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDI2OnRoaXMuJCA9IG5ldyB5eS5Cb29sZWFuTm9kZSgkJFskMF0sIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMjc6dGhpcy4kID0gJCRbJDBdOwogIGJyZWFrOwogIGNhc2UgMjg6JCRbJDAtMV0uaXNIZWxwZXIgPSB0cnVlOyB0aGlzLiQgPSAkJFskMC0xXTsKICBicmVhazsKICBjYXNlIDI5OnRoaXMuJCA9IG5ldyB5eS5IYXNoTm9kZSgkJFskMF0sIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMzA6dGhpcy4kID0gWyQkWyQwLTJdLCAkJFskMF1dOwogIGJyZWFrOwogIGNhc2UgMzE6dGhpcy4kID0gbmV3IHl5LlBhcnRpYWxOYW1lTm9kZSgkJFskMF0sIHRoaXMuXyQpOwogIGJyZWFrOwogIGNhc2UgMzI6dGhpcy4kID0gbmV3IHl5LlBhcnRpYWxOYW1lTm9kZShuZXcgeXkuU3RyaW5nTm9kZSgkJFskMF0sIHRoaXMuXyQpLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDMzOnRoaXMuJCA9IG5ldyB5eS5QYXJ0aWFsTmFtZU5vZGUobmV3IHl5Lk51bWJlck5vZGUoJCRbJDBdLCB0aGlzLl8kKSk7CiAgYnJlYWs7CiAgY2FzZSAzNDp0aGlzLiQgPSBuZXcgeXkuRGF0YU5vZGUoJCRbJDBdLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDM1OnRoaXMuJCA9IG5ldyB5eS5JZE5vZGUoJCRbJDBdLCB0aGlzLl8kKTsKICBicmVhazsKICBjYXNlIDM2OiAkJFskMC0yXS5wdXNoKHtwYXJ0OiAkJFskMF0sIHNlcGFyYXRvcjogJCRbJDAtMV19KTsgdGhpcy4kID0gJCRbJDAtMl07CiAgYnJlYWs7CiAgY2FzZSAzNzp0aGlzLiQgPSBbe3BhcnQ6ICQkWyQwXX1dOwogIGJyZWFrOwogIGNhc2UgMzg6dGhpcy4kID0gW107CiAgYnJlYWs7CiAgY2FzZSAzOTokJFskMC0xXS5wdXNoKCQkWyQwXSk7CiAgYnJlYWs7CiAgY2FzZSA0ODp0aGlzLiQgPSBbXTsKICBicmVhazsKICBjYXNlIDQ5OiQkWyQwLTFdLnB1c2goJCRbJDBdKTsKICBicmVhazsKICBjYXNlIDUyOnRoaXMuJCA9IFskJFskMF1dOwogIGJyZWFrOwogIGNhc2UgNTM6JCRbJDAtMV0ucHVzaCgkJFskMF0pOwogIGJyZWFrOwogIH0KICB9LAogIHRhYmxlOiBbezM6MSw0OjIsNTpbMiwzOF0sNjozLDEyOlsyLDM4XSwxMzpbMiwzOF0sMTY6WzIsMzhdLDI0OlsyLDM4XSwyNjpbMiwzOF0sMzE6WzIsMzhdLDMyOlsyLDM4XSwzNDpbMiwzOF19LHsxOlszXX0sezU6WzEsNF19LHs1OlsyLDJdLDc6NSw4OjYsOTo3LDEwOjgsMTE6OSwxMjpbMSwxMF0sMTM6WzEsMTFdLDE0OjE2LDE2OlsxLDIwXSwxOToxNCwyMjoxNSwyNDpbMSwxOF0sMjY6WzEsMTldLDI4OlsyLDJdLDI5OlsyLDJdLDMxOlsxLDEyXSwzMjpbMSwxM10sMzQ6WzEsMTddfSx7MTpbMiwxXX0sezU6WzIsMzldLDEyOlsyLDM5XSwxMzpbMiwzOV0sMTY6WzIsMzldLDI0OlsyLDM5XSwyNjpbMiwzOV0sMjg6WzIsMzldLDI5OlsyLDM5XSwzMTpbMiwzOV0sMzI6WzIsMzldLDM0OlsyLDM5XX0sezU6WzIsM10sMTI6WzIsM10sMTM6WzIsM10sMTY6WzIsM10sMjQ6WzIsM10sMjY6WzIsM10sMjg6WzIsM10sMjk6WzIsM10sMzE6WzIsM10sMzI6WzIsM10sMzQ6WzIsM119LHs1OlsyLDRdLDEyOlsyLDRdLDEzOlsyLDRdLDE2OlsyLDRdLDI0OlsyLDRdLDI2OlsyLDRdLDI4OlsyLDRdLDI5OlsyLDRdLDMxOlsyLDRdLDMyOlsyLDRdLDM0OlsyLDRdfSx7NTpbMiw1XSwxMjpbMiw1XSwxMzpbMiw1XSwxNjpbMiw1XSwyNDpbMiw1XSwyNjpbMiw1XSwyODpbMiw1XSwyOTpbMiw1XSwzMTpbMiw1XSwzMjpbMiw1XSwzNDpbMiw1XX0sezU6WzIsNl0sMTI6WzIsNl0sMTM6WzIsNl0sMTY6WzIsNl0sMjQ6WzIsNl0sMjY6WzIsNl0sMjg6WzIsNl0sMjk6WzIsNl0sMzE6WzIsNl0sMzI6WzIsNl0sMzQ6WzIsNl19LHs1OlsyLDddLDEyOlsyLDddLDEzOlsyLDddLDE2OlsyLDddLDI0OlsyLDddLDI2OlsyLDddLDI4OlsyLDddLDI5OlsyLDddLDMxOlsyLDddLDMyOlsyLDddLDM0OlsyLDddfSx7NTpbMiw4XSwxMjpbMiw4XSwxMzpbMiw4XSwxNjpbMiw4XSwyNDpbMiw4XSwyNjpbMiw4XSwyODpbMiw4XSwyOTpbMiw4XSwzMTpbMiw4XSwzMjpbMiw4XSwzNDpbMiw4XX0sezE3OjIxLDMwOjIyLDQxOjIzLDUwOlsxLDI2XSw1MjpbMSwyNV0sNTM6MjR9LHsxNzoyNywzMDoyMiw0MToyMyw1MDpbMSwyNl0sNTI6WzEsMjVdLDUzOjI0fSx7NDoyOCw2OjMsMTI6WzIsMzhdLDEzOlsyLDM4XSwxNjpbMiwzOF0sMjQ6WzIsMzhdLDI2OlsyLDM4XSwyODpbMiwzOF0sMjk6WzIsMzhdLDMxOlsyLDM4XSwzMjpbMiwzOF0sMzQ6WzIsMzhdfSx7NDoyOSw2OjMsMTI6WzIsMzhdLDEzOlsyLDM4XSwxNjpbMiwzOF0sMjQ6WzIsMzhdLDI2OlsyLDM4XSwyODpbMiwzOF0sMjk6WzIsMzhdLDMxOlsyLDM4XSwzMjpbMiwzOF0sMzQ6WzIsMzhdfSx7MTI6WzEsMzBdfSx7MzA6MzIsMzU6MzEsNDI6WzEsMzNdLDQzOlsxLDM0XSw1MDpbMSwyNl0sNTM6MjR9LHsxNzozNSwzMDoyMiw0MToyMyw1MDpbMSwyNl0sNTI6WzEsMjVdLDUzOjI0fSx7MTc6MzYsMzA6MjIsNDE6MjMsNTA6WzEsMjZdLDUyOlsxLDI1XSw1MzoyNH0sezE3OjM3LDMwOjIyLDQxOjIzLDUwOlsxLDI2XSw1MjpbMSwyNV0sNTM6MjR9LHsyNTpbMSwzOF19LHsxODpbMiw0OF0sMjU6WzIsNDhdLDMzOlsyLDQ4XSwzOTozOSw0MjpbMiw0OF0sNDM6WzIsNDhdLDQ0OlsyLDQ4XSw0NTpbMiw0OF0sNDY6WzIsNDhdLDUwOlsyLDQ4XSw1MjpbMiw0OF19LHsxODpbMiwyMl0sMjU6WzIsMjJdLDMzOlsyLDIyXSw0NjpbMiwyMl19LHsxODpbMiwzNV0sMjU6WzIsMzVdLDMzOlsyLDM1XSw0MjpbMiwzNV0sNDM6WzIsMzVdLDQ0OlsyLDM1XSw0NTpbMiwzNV0sNDY6WzIsMzVdLDUwOlsyLDM1XSw1MjpbMiwzNV0sNTQ6WzEsNDBdfSx7MzA6NDEsNTA6WzEsMjZdLDUzOjI0fSx7MTg6WzIsMzddLDI1OlsyLDM3XSwzMzpbMiwzN10sNDI6WzIsMzddLDQzOlsyLDM3XSw0NDpbMiwzN10sNDU6WzIsMzddLDQ2OlsyLDM3XSw1MDpbMiwzN10sNTI6WzIsMzddLDU0OlsyLDM3XX0sezMzOlsxLDQyXX0sezIwOjQzLDI3OjQ0LDI4OlsxLDQ1XSwyOTpbMiw0MF19LHsyMzo0NiwyNzo0NywyODpbMSw0NV0sMjk6WzIsNDJdfSx7MTU6WzEsNDhdfSx7MjU6WzIsNDZdLDMwOjUxLDM2OjQ5LDM4OjUwLDQxOjU1LDQyOlsxLDUyXSw0MzpbMSw1M10sNDQ6WzEsNTRdLDQ1OlsxLDU2XSw0Nzo1Nyw0ODo1OCw0OTo2MCw1MDpbMSw1OV0sNTI6WzEsMjVdLDUzOjI0fSx7MjU6WzIsMzFdLDQyOlsyLDMxXSw0MzpbMiwzMV0sNDQ6WzIsMzFdLDQ1OlsyLDMxXSw1MDpbMiwzMV0sNTI6WzIsMzFdfSx7MjU6WzIsMzJdLDQyOlsyLDMyXSw0MzpbMiwzMl0sNDQ6WzIsMzJdLDQ1OlsyLDMyXSw1MDpbMiwzMl0sNTI6WzIsMzJdfSx7MjU6WzIsMzNdLDQyOlsyLDMzXSw0MzpbMiwzM10sNDQ6WzIsMzNdLDQ1OlsyLDMzXSw1MDpbMiwzM10sNTI6WzIsMzNdfSx7MjU6WzEsNjFdfSx7MjU6WzEsNjJdfSx7MTg6WzEsNjNdfSx7NTpbMiwxN10sMTI6WzIsMTddLDEzOlsyLDE3XSwxNjpbMiwxN10sMjQ6WzIsMTddLDI2OlsyLDE3XSwyODpbMiwxN10sMjk6WzIsMTddLDMxOlsyLDE3XSwzMjpbMiwxN10sMzQ6WzIsMTddfSx7MTg6WzIsNTBdLDI1OlsyLDUwXSwzMDo1MSwzMzpbMiw1MF0sMzY6NjUsNDA6NjQsNDE6NTUsNDI6WzEsNTJdLDQzOlsxLDUzXSw0NDpbMSw1NF0sNDU6WzEsNTZdLDQ2OlsyLDUwXSw0Nzo2Niw0ODo1OCw0OTo2MCw1MDpbMSw1OV0sNTI6WzEsMjVdLDUzOjI0fSx7NTA6WzEsNjddfSx7MTg6WzIsMzRdLDI1OlsyLDM0XSwzMzpbMiwzNF0sNDI6WzIsMzRdLDQzOlsyLDM0XSw0NDpbMiwzNF0sNDU6WzIsMzRdLDQ2OlsyLDM0XSw1MDpbMiwzNF0sNTI6WzIsMzRdfSx7NTpbMiwxOF0sMTI6WzIsMThdLDEzOlsyLDE4XSwxNjpbMiwxOF0sMjQ6WzIsMThdLDI2OlsyLDE4XSwyODpbMiwxOF0sMjk6WzIsMThdLDMxOlsyLDE4XSwzMjpbMiwxOF0sMzQ6WzIsMThdfSx7MjE6NjgsMjk6WzEsNjldfSx7Mjk6WzIsNDFdfSx7NDo3MCw2OjMsMTI6WzIsMzhdLDEzOlsyLDM4XSwxNjpbMiwzOF0sMjQ6WzIsMzhdLDI2OlsyLDM4XSwyOTpbMiwzOF0sMzE6WzIsMzhdLDMyOlsyLDM4XSwzNDpbMiwzOF19LHsyMTo3MSwyOTpbMSw2OV19LHsyOTpbMiw0M119LHs1OlsyLDldLDEyOlsyLDldLDEzOlsyLDldLDE2OlsyLDldLDI0OlsyLDldLDI2OlsyLDldLDI4OlsyLDldLDI5OlsyLDldLDMxOlsyLDldLDMyOlsyLDldLDM0OlsyLDldfSx7MjU6WzIsNDRdLDM3OjcyLDQ3OjczLDQ4OjU4LDQ5OjYwLDUwOlsxLDc0XX0sezI1OlsxLDc1XX0sezE4OlsyLDIzXSwyNTpbMiwyM10sMzM6WzIsMjNdLDQyOlsyLDIzXSw0MzpbMiwyM10sNDQ6WzIsMjNdLDQ1OlsyLDIzXSw0NjpbMiwyM10sNTA6WzIsMjNdLDUyOlsyLDIzXX0sezE4OlsyLDI0XSwyNTpbMiwyNF0sMzM6WzIsMjRdLDQyOlsyLDI0XSw0MzpbMiwyNF0sNDQ6WzIsMjRdLDQ1OlsyLDI0XSw0NjpbMiwyNF0sNTA6WzIsMjRdLDUyOlsyLDI0XX0sezE4OlsyLDI1XSwyNTpbMiwyNV0sMzM6WzIsMjVdLDQyOlsyLDI1XSw0MzpbMiwyNV0sNDQ6WzIsMjVdLDQ1OlsyLDI1XSw0NjpbMiwyNV0sNTA6WzIsMjVdLDUyOlsyLDI1XX0sezE4OlsyLDI2XSwyNTpbMiwyNl0sMzM6WzIsMjZdLDQyOlsyLDI2XSw0MzpbMiwyNl0sNDQ6WzIsMjZdLDQ1OlsyLDI2XSw0NjpbMiwyNl0sNTA6WzIsMjZdLDUyOlsyLDI2XX0sezE4OlsyLDI3XSwyNTpbMiwyN10sMzM6WzIsMjddLDQyOlsyLDI3XSw0MzpbMiwyN10sNDQ6WzIsMjddLDQ1OlsyLDI3XSw0NjpbMiwyN10sNTA6WzIsMjddLDUyOlsyLDI3XX0sezE3Ojc2LDMwOjIyLDQxOjIzLDUwOlsxLDI2XSw1MjpbMSwyNV0sNTM6MjR9LHsyNTpbMiw0N119LHsxODpbMiwyOV0sMjU6WzIsMjldLDMzOlsyLDI5XSw0NjpbMiwyOV0sNDk6NzcsNTA6WzEsNzRdfSx7MTg6WzIsMzddLDI1OlsyLDM3XSwzMzpbMiwzN10sNDI6WzIsMzddLDQzOlsyLDM3XSw0NDpbMiwzN10sNDU6WzIsMzddLDQ2OlsyLDM3XSw1MDpbMiwzN10sNTE6WzEsNzhdLDUyOlsyLDM3XSw1NDpbMiwzN119LHsxODpbMiw1Ml0sMjU6WzIsNTJdLDMzOlsyLDUyXSw0NjpbMiw1Ml0sNTA6WzIsNTJdfSx7MTI6WzIsMTNdLDEzOlsyLDEzXSwxNjpbMiwxM10sMjQ6WzIsMTNdLDI2OlsyLDEzXSwyODpbMiwxM10sMjk6WzIsMTNdLDMxOlsyLDEzXSwzMjpbMiwxM10sMzQ6WzIsMTNdfSx7MTI6WzIsMTRdLDEzOlsyLDE0XSwxNjpbMiwxNF0sMjQ6WzIsMTRdLDI2OlsyLDE0XSwyODpbMiwxNF0sMjk6WzIsMTRdLDMxOlsyLDE0XSwzMjpbMiwxNF0sMzQ6WzIsMTRdfSx7MTI6WzIsMTBdfSx7MTg6WzIsMjFdLDI1OlsyLDIxXSwzMzpbMiwyMV0sNDY6WzIsMjFdfSx7MTg6WzIsNDldLDI1OlsyLDQ5XSwzMzpbMiw0OV0sNDI6WzIsNDldLDQzOlsyLDQ5XSw0NDpbMiw0OV0sNDU6WzIsNDldLDQ2OlsyLDQ5XSw1MDpbMiw0OV0sNTI6WzIsNDldfSx7MTg6WzIsNTFdLDI1OlsyLDUxXSwzMzpbMiw1MV0sNDY6WzIsNTFdfSx7MTg6WzIsMzZdLDI1OlsyLDM2XSwzMzpbMiwzNl0sNDI6WzIsMzZdLDQzOlsyLDM2XSw0NDpbMiwzNl0sNDU6WzIsMzZdLDQ2OlsyLDM2XSw1MDpbMiwzNl0sNTI6WzIsMzZdLDU0OlsyLDM2XX0sezU6WzIsMTFdLDEyOlsyLDExXSwxMzpbMiwxMV0sMTY6WzIsMTFdLDI0OlsyLDExXSwyNjpbMiwxMV0sMjg6WzIsMTFdLDI5OlsyLDExXSwzMTpbMiwxMV0sMzI6WzIsMTFdLDM0OlsyLDExXX0sezMwOjc5LDUwOlsxLDI2XSw1MzoyNH0sezI5OlsyLDE1XX0sezU6WzIsMTJdLDEyOlsyLDEyXSwxMzpbMiwxMl0sMTY6WzIsMTJdLDI0OlsyLDEyXSwyNjpbMiwxMl0sMjg6WzIsMTJdLDI5OlsyLDEyXSwzMTpbMiwxMl0sMzI6WzIsMTJdLDM0OlsyLDEyXX0sezI1OlsxLDgwXX0sezI1OlsyLDQ1XX0sezUxOlsxLDc4XX0sezU6WzIsMjBdLDEyOlsyLDIwXSwxMzpbMiwyMF0sMTY6WzIsMjBdLDI0OlsyLDIwXSwyNjpbMiwyMF0sMjg6WzIsMjBdLDI5OlsyLDIwXSwzMTpbMiwyMF0sMzI6WzIsMjBdLDM0OlsyLDIwXX0sezQ2OlsxLDgxXX0sezE4OlsyLDUzXSwyNTpbMiw1M10sMzM6WzIsNTNdLDQ2OlsyLDUzXSw1MDpbMiw1M119LHszMDo1MSwzNjo4Miw0MTo1NSw0MjpbMSw1Ml0sNDM6WzEsNTNdLDQ0OlsxLDU0XSw0NTpbMSw1Nl0sNTA6WzEsMjZdLDUyOlsxLDI1XSw1MzoyNH0sezI1OlsxLDgzXX0sezU6WzIsMTldLDEyOlsyLDE5XSwxMzpbMiwxOV0sMTY6WzIsMTldLDI0OlsyLDE5XSwyNjpbMiwxOV0sMjg6WzIsMTldLDI5OlsyLDE5XSwzMTpbMiwxOV0sMzI6WzIsMTldLDM0OlsyLDE5XX0sezE4OlsyLDI4XSwyNTpbMiwyOF0sMzM6WzIsMjhdLDQyOlsyLDI4XSw0MzpbMiwyOF0sNDQ6WzIsMjhdLDQ1OlsyLDI4XSw0NjpbMiwyOF0sNTA6WzIsMjhdLDUyOlsyLDI4XX0sezE4OlsyLDMwXSwyNTpbMiwzMF0sMzM6WzIsMzBdLDQ2OlsyLDMwXSw1MDpbMiwzMF19LHs1OlsyLDE2XSwxMjpbMiwxNl0sMTM6WzIsMTZdLDE2OlsyLDE2XSwyNDpbMiwxNl0sMjY6WzIsMTZdLDI4OlsyLDE2XSwyOTpbMiwxNl0sMzE6WzIsMTZdLDMyOlsyLDE2XSwzNDpbMiwxNl19XSwKICBkZWZhdWx0QWN0aW9uczogezQ6WzIsMV0sNDQ6WzIsNDFdLDQ3OlsyLDQzXSw1NzpbMiw0N10sNjM6WzIsMTBdLDcwOlsyLDE1XSw3MzpbMiw0NV19LAogIHBhcnNlRXJyb3I6IGZ1bmN0aW9uIHBhcnNlRXJyb3Ioc3RyLCBoYXNoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihzdHIpOwogIH0sCiAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKGlucHV0KSB7CiAgICAgIHZhciBzZWxmID0gdGhpcywgc3RhY2sgPSBbMF0sIHZzdGFjayA9IFtudWxsXSwgbHN0YWNrID0gW10sIHRhYmxlID0gdGhpcy50YWJsZSwgeXl0ZXh0ID0gIiIsIHl5bGluZW5vID0gMCwgeXlsZW5nID0gMCwgcmVjb3ZlcmluZyA9IDAsIFRFUlJPUiA9IDIsIEVPRiA9IDE7CiAgICAgIHRoaXMubGV4ZXIuc2V0SW5wdXQoaW5wdXQpOwogICAgICB0aGlzLmxleGVyLnl5ID0gdGhpcy55eTsKICAgICAgdGhpcy55eS5sZXhlciA9IHRoaXMubGV4ZXI7CiAgICAgIHRoaXMueXkucGFyc2VyID0gdGhpczsKICAgICAgaWYgKHR5cGVvZiB0aGlzLmxleGVyLnl5bGxvYyA9PSAidW5kZWZpbmVkIikKICAgICAgICAgIHRoaXMubGV4ZXIueXlsbG9jID0ge307CiAgICAgIHZhciB5eWxvYyA9IHRoaXMubGV4ZXIueXlsbG9jOwogICAgICBsc3RhY2sucHVzaCh5eWxvYyk7CiAgICAgIHZhciByYW5nZXMgPSB0aGlzLmxleGVyLm9wdGlvbnMgJiYgdGhpcy5sZXhlci5vcHRpb25zLnJhbmdlczsKICAgICAgaWYgKHR5cGVvZiB0aGlzLnl5LnBhcnNlRXJyb3IgPT09ICJmdW5jdGlvbiIpCiAgICAgICAgICB0aGlzLnBhcnNlRXJyb3IgPSB0aGlzLnl5LnBhcnNlRXJyb3I7CiAgICAgIGZ1bmN0aW9uIHBvcFN0YWNrKG4pIHsKICAgICAgICAgIHN0YWNrLmxlbmd0aCA9IHN0YWNrLmxlbmd0aCAtIDIgKiBuOwogICAgICAgICAgdnN0YWNrLmxlbmd0aCA9IHZzdGFjay5sZW5ndGggLSBuOwogICAgICAgICAgbHN0YWNrLmxlbmd0aCA9IGxzdGFjay5sZW5ndGggLSBuOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGxleCgpIHsKICAgICAgICAgIHZhciB0b2tlbjsKICAgICAgICAgIHRva2VuID0gc2VsZi5sZXhlci5sZXgoKSB8fCAxOwogICAgICAgICAgaWYgKHR5cGVvZiB0b2tlbiAhPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICB0b2tlbiA9IHNlbGYuc3ltYm9sc19bdG9rZW5dIHx8IHRva2VuOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRva2VuOwogICAgICB9CiAgICAgIHZhciBzeW1ib2wsIHByZUVycm9yU3ltYm9sLCBzdGF0ZSwgYWN0aW9uLCBhLCByLCB5eXZhbCA9IHt9LCBwLCBsZW4sIG5ld1N0YXRlLCBleHBlY3RlZDsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIHN0YXRlID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICBpZiAodGhpcy5kZWZhdWx0QWN0aW9uc1tzdGF0ZV0pIHsKICAgICAgICAgICAgICBhY3Rpb24gPSB0aGlzLmRlZmF1bHRBY3Rpb25zW3N0YXRlXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHN5bWJvbCA9PT0gbnVsbCB8fCB0eXBlb2Ygc3ltYm9sID09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgIHN5bWJvbCA9IGxleCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhY3Rpb24gPSB0YWJsZVtzdGF0ZV0gJiYgdGFibGVbc3RhdGVdW3N5bWJvbF07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gInVuZGVmaW5lZCIgfHwgIWFjdGlvbi5sZW5ndGggfHwgIWFjdGlvblswXSkgewogICAgICAgICAgICAgIHZhciBlcnJTdHIgPSAiIjsKICAgICAgICAgICAgICBpZiAoIXJlY292ZXJpbmcpIHsKICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSBbXTsKICAgICAgICAgICAgICAgICAgZm9yIChwIGluIHRhYmxlW3N0YXRlXSkKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlcm1pbmFsc19bcF0gJiYgcCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZC5wdXNoKCInIiArIHRoaXMudGVybWluYWxzX1twXSArICInIik7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxleGVyLnNob3dQb3NpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgZXJyU3RyID0gIlBhcnNlIGVycm9yIG9uIGxpbmUgIiArICh5eWxpbmVubyArIDEpICsgIjpcbiIgKyB0aGlzLmxleGVyLnNob3dQb3NpdGlvbigpICsgIlxuRXhwZWN0aW5nICIgKyBleHBlY3RlZC5qb2luKCIsICIpICsgIiwgZ290ICciICsgKHRoaXMudGVybWluYWxzX1tzeW1ib2xdIHx8IHN5bWJvbCkgKyAiJyI7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBlcnJTdHIgPSAiUGFyc2UgZXJyb3Igb24gbGluZSAiICsgKHl5bGluZW5vICsgMSkgKyAiOiBVbmV4cGVjdGVkICIgKyAoc3ltYm9sID09IDE/ImVuZCBvZiBpbnB1dCI6IiciICsgKHRoaXMudGVybWluYWxzX1tzeW1ib2xdIHx8IHN5bWJvbCkgKyAiJyIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VFcnJvcihlcnJTdHIsIHt0ZXh0OiB0aGlzLmxleGVyLm1hdGNoLCB0b2tlbjogdGhpcy50ZXJtaW5hbHNfW3N5bWJvbF0gfHwgc3ltYm9sLCBsaW5lOiB0aGlzLmxleGVyLnl5bGluZW5vLCBsb2M6IHl5bG9jLCBleHBlY3RlZDogZXhwZWN0ZWR9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYWN0aW9uWzBdIGluc3RhbmNlb2YgQXJyYXkgJiYgYWN0aW9uLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcnNlIEVycm9yOiBtdWx0aXBsZSBhY3Rpb25zIHBvc3NpYmxlIGF0IHN0YXRlOiAiICsgc3RhdGUgKyAiLCB0b2tlbjogIiArIHN5bWJvbCk7CiAgICAgICAgICB9CiAgICAgICAgICBzd2l0Y2ggKGFjdGlvblswXSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIHN0YWNrLnB1c2goc3ltYm9sKTsKICAgICAgICAgICAgICB2c3RhY2sucHVzaCh0aGlzLmxleGVyLnl5dGV4dCk7CiAgICAgICAgICAgICAgbHN0YWNrLnB1c2godGhpcy5sZXhlci55eWxsb2MpOwogICAgICAgICAgICAgIHN0YWNrLnB1c2goYWN0aW9uWzFdKTsKICAgICAgICAgICAgICBzeW1ib2wgPSBudWxsOwogICAgICAgICAgICAgIGlmICghcHJlRXJyb3JTeW1ib2wpIHsKICAgICAgICAgICAgICAgICAgeXlsZW5nID0gdGhpcy5sZXhlci55eWxlbmc7CiAgICAgICAgICAgICAgICAgIHl5dGV4dCA9IHRoaXMubGV4ZXIueXl0ZXh0OwogICAgICAgICAgICAgICAgICB5eWxpbmVubyA9IHRoaXMubGV4ZXIueXlsaW5lbm87CiAgICAgICAgICAgICAgICAgIHl5bG9jID0gdGhpcy5sZXhlci55eWxsb2M7CiAgICAgICAgICAgICAgICAgIGlmIChyZWNvdmVyaW5nID4gMCkKICAgICAgICAgICAgICAgICAgICAgIHJlY292ZXJpbmctLTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBzeW1ib2wgPSBwcmVFcnJvclN5bWJvbDsKICAgICAgICAgICAgICAgICAgcHJlRXJyb3JTeW1ib2wgPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBsZW4gPSB0aGlzLnByb2R1Y3Rpb25zX1thY3Rpb25bMV1dWzFdOwogICAgICAgICAgICAgIHl5dmFsLiQgPSB2c3RhY2tbdnN0YWNrLmxlbmd0aCAtIGxlbl07CiAgICAgICAgICAgICAgeXl2YWwuXyQgPSB7Zmlyc3RfbGluZTogbHN0YWNrW2xzdGFjay5sZW5ndGggLSAobGVuIHx8IDEpXS5maXJzdF9saW5lLCBsYXN0X2xpbmU6IGxzdGFja1tsc3RhY2subGVuZ3RoIC0gMV0ubGFzdF9saW5lLCBmaXJzdF9jb2x1bW46IGxzdGFja1tsc3RhY2subGVuZ3RoIC0gKGxlbiB8fCAxKV0uZmlyc3RfY29sdW1uLCBsYXN0X2NvbHVtbjogbHN0YWNrW2xzdGFjay5sZW5ndGggLSAxXS5sYXN0X2NvbHVtbn07CiAgICAgICAgICAgICAgaWYgKHJhbmdlcykgewogICAgICAgICAgICAgICAgICB5eXZhbC5fJC5yYW5nZSA9IFtsc3RhY2tbbHN0YWNrLmxlbmd0aCAtIChsZW4gfHwgMSldLnJhbmdlWzBdLCBsc3RhY2tbbHN0YWNrLmxlbmd0aCAtIDFdLnJhbmdlWzFdXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgciA9IHRoaXMucGVyZm9ybUFjdGlvbi5jYWxsKHl5dmFsLCB5eXRleHQsIHl5bGVuZywgeXlsaW5lbm8sIHRoaXMueXksIGFjdGlvblsxXSwgdnN0YWNrLCBsc3RhY2spOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgciAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgICAgc3RhY2sgPSBzdGFjay5zbGljZSgwLCAtMSAqIGxlbiAqIDIpOwogICAgICAgICAgICAgICAgICB2c3RhY2sgPSB2c3RhY2suc2xpY2UoMCwgLTEgKiBsZW4pOwogICAgICAgICAgICAgICAgICBsc3RhY2sgPSBsc3RhY2suc2xpY2UoMCwgLTEgKiBsZW4pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdGFjay5wdXNoKHRoaXMucHJvZHVjdGlvbnNfW2FjdGlvblsxXV1bMF0pOwogICAgICAgICAgICAgIHZzdGFjay5wdXNoKHl5dmFsLiQpOwogICAgICAgICAgICAgIGxzdGFjay5wdXNoKHl5dmFsLl8kKTsKICAgICAgICAgICAgICBuZXdTdGF0ZSA9IHRhYmxlW3N0YWNrW3N0YWNrLmxlbmd0aCAtIDJdXVtzdGFja1tzdGFjay5sZW5ndGggLSAxXV07CiAgICAgICAgICAgICAgc3RhY2sucHVzaChuZXdTdGF0ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgfQogIH07CiAgLyogSmlzb24gZ2VuZXJhdGVkIGxleGVyICovCiAgdmFyIGxleGVyID0gKGZ1bmN0aW9uKCl7CiAgdmFyIGxleGVyID0gKHtFT0Y6MSwKICBwYXJzZUVycm9yOmZ1bmN0aW9uIHBhcnNlRXJyb3Ioc3RyLCBoYXNoKSB7CiAgICAgICAgICBpZiAodGhpcy55eS5wYXJzZXIpIHsKICAgICAgICAgICAgICB0aGlzLnl5LnBhcnNlci5wYXJzZUVycm9yKHN0ciwgaGFzaCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihzdHIpOwogICAgICAgICAgfQogICAgICB9LAogIHNldElucHV0OmZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgdGhpcy5faW5wdXQgPSBpbnB1dDsKICAgICAgICAgIHRoaXMuX21vcmUgPSB0aGlzLl9sZXNzID0gdGhpcy5kb25lID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnl5bGluZW5vID0gdGhpcy55eWxlbmcgPSAwOwogICAgICAgICAgdGhpcy55eXRleHQgPSB0aGlzLm1hdGNoZWQgPSB0aGlzLm1hdGNoID0gJyc7CiAgICAgICAgICB0aGlzLmNvbmRpdGlvblN0YWNrID0gWydJTklUSUFMJ107CiAgICAgICAgICB0aGlzLnl5bGxvYyA9IHtmaXJzdF9saW5lOjEsZmlyc3RfY29sdW1uOjAsbGFzdF9saW5lOjEsbGFzdF9jb2x1bW46MH07CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJhbmdlcykgdGhpcy55eWxsb2MucmFuZ2UgPSBbMCwwXTsKICAgICAgICAgIHRoaXMub2Zmc2V0ID0gMDsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogIGlucHV0OmZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBjaCA9IHRoaXMuX2lucHV0WzBdOwogICAgICAgICAgdGhpcy55eXRleHQgKz0gY2g7CiAgICAgICAgICB0aGlzLnl5bGVuZysrOwogICAgICAgICAgdGhpcy5vZmZzZXQrKzsKICAgICAgICAgIHRoaXMubWF0Y2ggKz0gY2g7CiAgICAgICAgICB0aGlzLm1hdGNoZWQgKz0gY2g7CiAgICAgICAgICB2YXIgbGluZXMgPSBjaC5tYXRjaCgvKD86XHJcbj98XG4pLiovZyk7CiAgICAgICAgICBpZiAobGluZXMpIHsKICAgICAgICAgICAgICB0aGlzLnl5bGluZW5vKys7CiAgICAgICAgICAgICAgdGhpcy55eWxsb2MubGFzdF9saW5lKys7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMueXlsbG9jLmxhc3RfY29sdW1uKys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJhbmdlcykgdGhpcy55eWxsb2MucmFuZ2VbMV0rKzsKCiAgICAgICAgICB0aGlzLl9pbnB1dCA9IHRoaXMuX2lucHV0LnNsaWNlKDEpOwogICAgICAgICAgcmV0dXJuIGNoOwogICAgICB9LAogIHVucHV0OmZ1bmN0aW9uIChjaCkgewogICAgICAgICAgdmFyIGxlbiA9IGNoLmxlbmd0aDsKICAgICAgICAgIHZhciBsaW5lcyA9IGNoLnNwbGl0KC8oPzpcclxuP3xcbikvZyk7CgogICAgICAgICAgdGhpcy5faW5wdXQgPSBjaCArIHRoaXMuX2lucHV0OwogICAgICAgICAgdGhpcy55eXRleHQgPSB0aGlzLnl5dGV4dC5zdWJzdHIoMCwgdGhpcy55eXRleHQubGVuZ3RoLWxlbi0xKTsKICAgICAgICAgIC8vdGhpcy55eWxlbmcgLT0gbGVuOwogICAgICAgICAgdGhpcy5vZmZzZXQgLT0gbGVuOwogICAgICAgICAgdmFyIG9sZExpbmVzID0gdGhpcy5tYXRjaC5zcGxpdCgvKD86XHJcbj98XG4pL2cpOwogICAgICAgICAgdGhpcy5tYXRjaCA9IHRoaXMubWF0Y2guc3Vic3RyKDAsIHRoaXMubWF0Y2gubGVuZ3RoLTEpOwogICAgICAgICAgdGhpcy5tYXRjaGVkID0gdGhpcy5tYXRjaGVkLnN1YnN0cigwLCB0aGlzLm1hdGNoZWQubGVuZ3RoLTEpOwoKICAgICAgICAgIGlmIChsaW5lcy5sZW5ndGgtMSkgdGhpcy55eWxpbmVubyAtPSBsaW5lcy5sZW5ndGgtMTsKICAgICAgICAgIHZhciByID0gdGhpcy55eWxsb2MucmFuZ2U7CgogICAgICAgICAgdGhpcy55eWxsb2MgPSB7Zmlyc3RfbGluZTogdGhpcy55eWxsb2MuZmlyc3RfbGluZSwKICAgICAgICAgICAgbGFzdF9saW5lOiB0aGlzLnl5bGluZW5vKzEsCiAgICAgICAgICAgIGZpcnN0X2NvbHVtbjogdGhpcy55eWxsb2MuZmlyc3RfY29sdW1uLAogICAgICAgICAgICBsYXN0X2NvbHVtbjogbGluZXMgPwogICAgICAgICAgICAgICAgKGxpbmVzLmxlbmd0aCA9PT0gb2xkTGluZXMubGVuZ3RoID8gdGhpcy55eWxsb2MuZmlyc3RfY29sdW1uIDogMCkgKyBvbGRMaW5lc1tvbGRMaW5lcy5sZW5ndGggLSBsaW5lcy5sZW5ndGhdLmxlbmd0aCAtIGxpbmVzWzBdLmxlbmd0aDoKICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jLmZpcnN0X2NvbHVtbiAtIGxlbgogICAgICAgICAgICB9OwoKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmFuZ2VzKSB7CiAgICAgICAgICAgICAgdGhpcy55eWxsb2MucmFuZ2UgPSBbclswXSwgclswXSArIHRoaXMueXlsZW5nIC0gbGVuXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogIG1vcmU6ZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhpcy5fbW9yZSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICBsZXNzOmZ1bmN0aW9uIChuKSB7CiAgICAgICAgICB0aGlzLnVucHV0KHRoaXMubWF0Y2guc2xpY2UobikpOwogICAgICB9LAogIHBhc3RJbnB1dDpmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcGFzdCA9IHRoaXMubWF0Y2hlZC5zdWJzdHIoMCwgdGhpcy5tYXRjaGVkLmxlbmd0aCAtIHRoaXMubWF0Y2gubGVuZ3RoKTsKICAgICAgICAgIHJldHVybiAocGFzdC5sZW5ndGggPiAyMCA/ICcuLi4nOicnKSArIHBhc3Quc3Vic3RyKC0yMCkucmVwbGFjZSgvXG4vZywgIiIpOwogICAgICB9LAogIHVwY29taW5nSW5wdXQ6ZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIG5leHQgPSB0aGlzLm1hdGNoOwogICAgICAgICAgaWYgKG5leHQubGVuZ3RoIDwgMjApIHsKICAgICAgICAgICAgICBuZXh0ICs9IHRoaXMuX2lucHV0LnN1YnN0cigwLCAyMC1uZXh0Lmxlbmd0aCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gKG5leHQuc3Vic3RyKDAsMjApKyhuZXh0Lmxlbmd0aCA+IDIwID8gJy4uLic6JycpKS5yZXBsYWNlKC9cbi9nLCAiIik7CiAgICAgIH0sCiAgc2hvd1Bvc2l0aW9uOmZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBwcmUgPSB0aGlzLnBhc3RJbnB1dCgpOwogICAgICAgICAgdmFyIGMgPSBuZXcgQXJyYXkocHJlLmxlbmd0aCArIDEpLmpvaW4oIi0iKTsKICAgICAgICAgIHJldHVybiBwcmUgKyB0aGlzLnVwY29taW5nSW5wdXQoKSArICJcbiIgKyBjKyJeIjsKICAgICAgfSwKICBuZXh0OmZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5FT0Y7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMuX2lucHV0KSB0aGlzLmRvbmUgPSB0cnVlOwoKICAgICAgICAgIHZhciB0b2tlbiwKICAgICAgICAgICAgICBtYXRjaCwKICAgICAgICAgICAgICB0ZW1wTWF0Y2gsCiAgICAgICAgICAgICAgaW5kZXgsCiAgICAgICAgICAgICAgY29sLAogICAgICAgICAgICAgIGxpbmVzOwogICAgICAgICAgaWYgKCF0aGlzLl9tb3JlKSB7CiAgICAgICAgICAgICAgdGhpcy55eXRleHQgPSAnJzsKICAgICAgICAgICAgICB0aGlzLm1hdGNoID0gJyc7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcnVsZXMgPSB0aGlzLl9jdXJyZW50UnVsZXMoKTsKICAgICAgICAgIGZvciAodmFyIGk9MDtpIDwgcnVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICB0ZW1wTWF0Y2ggPSB0aGlzLl9pbnB1dC5tYXRjaCh0aGlzLnJ1bGVzW3J1bGVzW2ldXSk7CiAgICAgICAgICAgICAgaWYgKHRlbXBNYXRjaCAmJiAoIW1hdGNoIHx8IHRlbXBNYXRjaFswXS5sZW5ndGggPiBtYXRjaFswXS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIG1hdGNoID0gdGVtcE1hdGNoOwogICAgICAgICAgICAgICAgICBpbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLmZsZXgpIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgIGxpbmVzID0gbWF0Y2hbMF0ubWF0Y2goLyg/OlxyXG4/fFxuKS4qL2cpOwogICAgICAgICAgICAgIGlmIChsaW5lcykgdGhpcy55eWxpbmVubyArPSBsaW5lcy5sZW5ndGg7CiAgICAgICAgICAgICAgdGhpcy55eWxsb2MgPSB7Zmlyc3RfbGluZTogdGhpcy55eWxsb2MubGFzdF9saW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZTogdGhpcy55eWxpbmVubysxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0X2NvbHVtbjogdGhpcy55eWxsb2MubGFzdF9jb2x1bW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9jb2x1bW46IGxpbmVzID8gbGluZXNbbGluZXMubGVuZ3RoLTFdLmxlbmd0aC1saW5lc1tsaW5lcy5sZW5ndGgtMV0ubWF0Y2goL1xyP1xuPy8pWzBdLmxlbmd0aCA6IHRoaXMueXlsbG9jLmxhc3RfY29sdW1uICsgbWF0Y2hbMF0ubGVuZ3RofTsKICAgICAgICAgICAgICB0aGlzLnl5dGV4dCArPSBtYXRjaFswXTsKICAgICAgICAgICAgICB0aGlzLm1hdGNoICs9IG1hdGNoWzBdOwogICAgICAgICAgICAgIHRoaXMubWF0Y2hlcyA9IG1hdGNoOwogICAgICAgICAgICAgIHRoaXMueXlsZW5nID0gdGhpcy55eXRleHQubGVuZ3RoOwogICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmFuZ2VzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jLnJhbmdlID0gW3RoaXMub2Zmc2V0LCB0aGlzLm9mZnNldCArPSB0aGlzLnl5bGVuZ107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuX21vcmUgPSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLl9pbnB1dCA9IHRoaXMuX2lucHV0LnNsaWNlKG1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgICAgdGhpcy5tYXRjaGVkICs9IG1hdGNoWzBdOwogICAgICAgICAgICAgIHRva2VuID0gdGhpcy5wZXJmb3JtQWN0aW9uLmNhbGwodGhpcywgdGhpcy55eSwgdGhpcywgcnVsZXNbaW5kZXhdLHRoaXMuY29uZGl0aW9uU3RhY2tbdGhpcy5jb25kaXRpb25TdGFjay5sZW5ndGgtMV0pOwogICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUgJiYgdGhpcy5faW5wdXQpIHRoaXMuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICAgIGlmICh0b2tlbikgcmV0dXJuIHRva2VuOwogICAgICAgICAgICAgIGVsc2UgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX2lucHV0ID09PSAiIikgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLkVPRjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VFcnJvcignTGV4aWNhbCBlcnJvciBvbiBsaW5lICcrKHRoaXMueXlsaW5lbm8rMSkrJy4gVW5yZWNvZ25pemVkIHRleHQuXG4nK3RoaXMuc2hvd1Bvc2l0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICB7dGV4dDogIiIsIHRva2VuOiBudWxsLCBsaW5lOiB0aGlzLnl5bGluZW5vfSk7CiAgICAgICAgICB9CiAgICAgIH0sCiAgbGV4OmZ1bmN0aW9uIGxleCgpIHsKICAgICAgICAgIHZhciByID0gdGhpcy5uZXh0KCk7CiAgICAgICAgICBpZiAodHlwZW9mIHIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmxleCgpOwogICAgICAgICAgfQogICAgICB9LAogIGJlZ2luOmZ1bmN0aW9uIGJlZ2luKGNvbmRpdGlvbikgewogICAgICAgICAgdGhpcy5jb25kaXRpb25TdGFjay5wdXNoKGNvbmRpdGlvbik7CiAgICAgIH0sCiAgcG9wU3RhdGU6ZnVuY3Rpb24gcG9wU3RhdGUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb25kaXRpb25TdGFjay5wb3AoKTsKICAgICAgfSwKICBfY3VycmVudFJ1bGVzOmZ1bmN0aW9uIF9jdXJyZW50UnVsZXMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb25kaXRpb25zW3RoaXMuY29uZGl0aW9uU3RhY2tbdGhpcy5jb25kaXRpb25TdGFjay5sZW5ndGgtMV1dLnJ1bGVzOwogICAgICB9LAogIHRvcFN0YXRlOmZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbmRpdGlvblN0YWNrW3RoaXMuY29uZGl0aW9uU3RhY2subGVuZ3RoLTJdOwogICAgICB9LAogIHB1c2hTdGF0ZTpmdW5jdGlvbiBiZWdpbihjb25kaXRpb24pIHsKICAgICAgICAgIHRoaXMuYmVnaW4oY29uZGl0aW9uKTsKICAgICAgfX0pOwogIGxleGVyLm9wdGlvbnMgPSB7fTsKICBsZXhlci5wZXJmb3JtQWN0aW9uID0gZnVuY3Rpb24gYW5vbnltb3VzKHl5LHl5XywkYXZvaWRpbmdfbmFtZV9jb2xsaXNpb25zLFlZX1NUQVJUKSB7CgoKICBmdW5jdGlvbiBzdHJpcChzdGFydCwgZW5kKSB7CiAgICByZXR1cm4geXlfLnl5dGV4dCA9IHl5Xy55eXRleHQuc3Vic3RyKHN0YXJ0LCB5eV8ueXlsZW5nLWVuZCk7CiAgfQoKCiAgdmFyIFlZU1RBVEU9WVlfU1RBUlQKICBzd2l0Y2goJGF2b2lkaW5nX25hbWVfY29sbGlzaW9ucykgewogIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHl5Xy55eXRleHQuc2xpY2UoLTIpID09PSAiXFxcXCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaXAoMCwxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iZWdpbigibXUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZih5eV8ueXl0ZXh0LnNsaWNlKC0xKSA9PT0gIlxcIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpcCgwLDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJlZ2luKCJlbXUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmVnaW4oIm11Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih5eV8ueXl0ZXh0KSByZXR1cm4gMTI7CgogIGJyZWFrOwogIGNhc2UgMTpyZXR1cm4gMTI7CiAgYnJlYWs7CiAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3BTdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEyOwoKICBicmVhazsKICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl5Xy55eXRleHQgPSB5eV8ueXl0ZXh0LnN1YnN0cig1LCB5eV8ueXlsZW5nLTkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcFN0YXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxNTsKCiAgYnJlYWs7CiAgY2FzZSA0OiByZXR1cm4gMTI7CiAgYnJlYWs7CiAgY2FzZSA1OnN0cmlwKDAsNCk7IHRoaXMucG9wU3RhdGUoKTsgcmV0dXJuIDEzOwogIGJyZWFrOwogIGNhc2UgNjpyZXR1cm4gNDU7CiAgYnJlYWs7CiAgY2FzZSA3OnJldHVybiA0NjsKICBicmVhazsKICBjYXNlIDg6IHJldHVybiAxNjsKICBicmVhazsKICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucG9wU3RhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iZWdpbigncmF3Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxODsKCiAgYnJlYWs7CiAgY2FzZSAxMDpyZXR1cm4gMzQ7CiAgYnJlYWs7CiAgY2FzZSAxMTpyZXR1cm4gMjQ7CiAgYnJlYWs7CiAgY2FzZSAxMjpyZXR1cm4gMjk7CiAgYnJlYWs7CiAgY2FzZSAxMzp0aGlzLnBvcFN0YXRlKCk7IHJldHVybiAyODsKICBicmVhazsKICBjYXNlIDE0OnRoaXMucG9wU3RhdGUoKTsgcmV0dXJuIDI4OwogIGJyZWFrOwogIGNhc2UgMTU6cmV0dXJuIDI2OwogIGJyZWFrOwogIGNhc2UgMTY6cmV0dXJuIDI2OwogIGJyZWFrOwogIGNhc2UgMTc6cmV0dXJuIDMyOwogIGJyZWFrOwogIGNhc2UgMTg6cmV0dXJuIDMxOwogIGJyZWFrOwogIGNhc2UgMTk6dGhpcy5wb3BTdGF0ZSgpOyB0aGlzLmJlZ2luKCdjb20nKTsKICBicmVhazsKICBjYXNlIDIwOnN0cmlwKDMsNSk7IHRoaXMucG9wU3RhdGUoKTsgcmV0dXJuIDEzOwogIGJyZWFrOwogIGNhc2UgMjE6cmV0dXJuIDMxOwogIGJyZWFrOwogIGNhc2UgMjI6cmV0dXJuIDUxOwogIGJyZWFrOwogIGNhc2UgMjM6cmV0dXJuIDUwOwogIGJyZWFrOwogIGNhc2UgMjQ6cmV0dXJuIDUwOwogIGJyZWFrOwogIGNhc2UgMjU6cmV0dXJuIDU0OwogIGJyZWFrOwogIGNhc2UgMjY6Ly8gaWdub3JlIHdoaXRlc3BhY2UKICBicmVhazsKICBjYXNlIDI3OnRoaXMucG9wU3RhdGUoKTsgcmV0dXJuIDMzOwogIGJyZWFrOwogIGNhc2UgMjg6dGhpcy5wb3BTdGF0ZSgpOyByZXR1cm4gMjU7CiAgYnJlYWs7CiAgY2FzZSAyOTp5eV8ueXl0ZXh0ID0gc3RyaXAoMSwyKS5yZXBsYWNlKC9cXCIvZywnIicpOyByZXR1cm4gNDI7CiAgYnJlYWs7CiAgY2FzZSAzMDp5eV8ueXl0ZXh0ID0gc3RyaXAoMSwyKS5yZXBsYWNlKC9cXCcvZywiJyIpOyByZXR1cm4gNDI7CiAgYnJlYWs7CiAgY2FzZSAzMTpyZXR1cm4gNTI7CiAgYnJlYWs7CiAgY2FzZSAzMjpyZXR1cm4gNDQ7CiAgYnJlYWs7CiAgY2FzZSAzMzpyZXR1cm4gNDQ7CiAgYnJlYWs7CiAgY2FzZSAzNDpyZXR1cm4gNDM7CiAgYnJlYWs7CiAgY2FzZSAzNTpyZXR1cm4gNTA7CiAgYnJlYWs7CiAgY2FzZSAzNjp5eV8ueXl0ZXh0ID0gc3RyaXAoMSwyKTsgcmV0dXJuIDUwOwogIGJyZWFrOwogIGNhc2UgMzc6cmV0dXJuICdJTlZBTElEJzsKICBicmVhazsKICBjYXNlIDM4OnJldHVybiA1OwogIGJyZWFrOwogIH0KICB9OwogIGxleGVyLnJ1bGVzID0gWy9eKD86W15ceDAwXSo/KD89KFx7XHspKSkvLC9eKD86W15ceDAwXSspLywvXig/OlteXHgwMF17Mix9Pyg/PShce1x7fFxcXHtce3xcXFxcXHtce3wkKSkpLywvXig/Olx7XHtce1x7XC9bXlxzISIjJS0sXC5cLzstPkBcWy1cXmBcey1+XSsoPz1bPX1cc1wvLl0pXH1cfVx9XH0pLywvXig/OlteXHgwMF0qPyg/PShce1x7XHtce1wvKSkpLywvXig/Oltcc1xTXSo/LS1cfVx9KS8sL14oPzpcKCkvLC9eKD86XCkpLywvXig/Olx7XHtce1x7KS8sL14oPzpcfVx9XH1cfSkvLC9eKD86XHtceyh+KT8+KS8sL14oPzpce1x7KH4pPyMpLywvXig/Olx7XHsofik/XC8pLywvXig/Olx7XHsofik/XF5ccyoofik/XH1cfSkvLC9eKD86XHtceyh+KT9ccyplbHNlXHMqKH4pP1x9XH0pLywvXig/Olx7XHsofik/XF4pLywvXig/Olx7XHsofik/XHMqZWxzZVxiKS8sL14oPzpce1x7KH4pP1x7KS8sL14oPzpce1x7KH4pPyYpLywvXig/Olx7XHshLS0pLywvXig/Olx7XHshW1xzXFNdKj9cfVx9KS8sL14oPzpce1x7KH4pPykvLC9eKD86PSkvLC9eKD86XC5cLikvLC9eKD86XC4oPz0oWz1+fVxzXC8uKV0pKSkvLC9eKD86W1wvLl0pLywvXig/OlxzKykvLC9eKD86XH0ofik/XH1cfSkvLC9eKD86KH4pP1x9XH0pLywvXig/OiIoXFxbIl18W14iXSkqIikvLC9eKD86JyhcXFsnXXxbXiddKSonKS8sL14oPzpAKS8sL14oPzp0cnVlKD89KFt+fVxzKV0pKSkvLC9eKD86ZmFsc2UoPz0oW359XHMpXSkpKS8sL14oPzotP1swLTldKyg/OlwuWzAtOV0rKT8oPz0oW359XHMpXSkpKS8sL14oPzooW15ccyEiIyUtLFwuXC87LT5AXFstXF5gXHstfl0rKD89KFs9fn1cc1wvLildKSkpKS8sL14oPzpcW1teXF1dKlxdKS8sL14oPzouKS8sL14oPzokKS9dOwogIGxleGVyLmNvbmRpdGlvbnMgPSB7Im11Ijp7InJ1bGVzIjpbNiw3LDgsOSwxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOSwyMCwyMSwyMiwyMywyNCwyNSwyNiwyNywyOCwyOSwzMCwzMSwzMiwzMywzNCwzNSwzNiwzNywzOF0sImluY2x1c2l2ZSI6ZmFsc2V9LCJlbXUiOnsicnVsZXMiOlsyXSwiaW5jbHVzaXZlIjpmYWxzZX0sImNvbSI6eyJydWxlcyI6WzVdLCJpbmNsdXNpdmUiOmZhbHNlfSwicmF3Ijp7InJ1bGVzIjpbMyw0XSwiaW5jbHVzaXZlIjpmYWxzZX0sIklOSVRJQUwiOnsicnVsZXMiOlswLDEsMzhdLCJpbmNsdXNpdmUiOnRydWV9fTsKICByZXR1cm4gbGV4ZXI7fSkoKQogIHBhcnNlci5sZXhlciA9IGxleGVyOwogIGZ1bmN0aW9uIFBhcnNlciAoKSB7IHRoaXMueXkgPSB7fTsgfVBhcnNlci5wcm90b3R5cGUgPSBwYXJzZXI7cGFyc2VyLlBhcnNlciA9IFBhcnNlcjsKICByZXR1cm4gbmV3IFBhcnNlcjsKICB9KSgpO19fZXhwb3J0c19fID0gaGFuZGxlYmFyczsKICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqLwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSkoKTsKCi8vIGhhbmRsZWJhcnMvY29tcGlsZXIvaGVscGVycy5qcwp2YXIgX19tb2R1bGUxMF9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX18gPSB7fTsKICB2YXIgRXhjZXB0aW9uID0gX19kZXBlbmRlbmN5MV9fOwoKICBmdW5jdGlvbiBzdHJpcEZsYWdzKG9wZW4sIGNsb3NlKSB7CiAgICByZXR1cm4gewogICAgICBsZWZ0OiBvcGVuLmNoYXJBdCgyKSA9PT0gJ34nLAogICAgICByaWdodDogY2xvc2UuY2hhckF0KGNsb3NlLmxlbmd0aC0zKSA9PT0gJ34nCiAgICB9OwogIH0KCiAgX19leHBvcnRzX18uc3RyaXBGbGFncyA9IHN0cmlwRmxhZ3M7CiAgZnVuY3Rpb24gcHJlcGFyZUJsb2NrKG11c3RhY2hlLCBwcm9ncmFtLCBpbnZlcnNlQW5kUHJvZ3JhbSwgY2xvc2UsIGludmVydGVkLCBsb2NJbmZvKSB7CiAgICAvKmpzaGludCAtVzA0MCAqLwogICAgaWYgKG11c3RhY2hlLnNleHByLmlkLm9yaWdpbmFsICE9PSBjbG9zZS5wYXRoLm9yaWdpbmFsKSB7CiAgICAgIHRocm93IG5ldyBFeGNlcHRpb24obXVzdGFjaGUuc2V4cHIuaWQub3JpZ2luYWwgKyAnIGRvZXNuXCd0IG1hdGNoICcgKyBjbG9zZS5wYXRoLm9yaWdpbmFsLCBtdXN0YWNoZSk7CiAgICB9CgogICAgdmFyIGludmVyc2UgPSBpbnZlcnNlQW5kUHJvZ3JhbSAmJiBpbnZlcnNlQW5kUHJvZ3JhbS5wcm9ncmFtOwoKICAgIHZhciBzdHJpcCA9IHsKICAgICAgbGVmdDogbXVzdGFjaGUuc3RyaXAubGVmdCwKICAgICAgcmlnaHQ6IGNsb3NlLnN0cmlwLnJpZ2h0LAoKICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBzdGFuZGFsb25lIGNhbmRpYWN5LiBCYXNpY2FsbHkgZmxhZyBvdXIgY29udGVudCBhcyBiZWluZyBwb3NzaWJseSBzdGFuZGFsb25lCiAgICAgIC8vIHNvIG91ciBwYXJlbnQgY2FuIGRldGVybWluZSBpZiB3ZSBhY3R1YWxseSBhcmUgc3RhbmRhbG9uZQogICAgICBvcGVuU3RhbmRhbG9uZTogaXNOZXh0V2hpdGVzcGFjZShwcm9ncmFtLnN0YXRlbWVudHMpLAogICAgICBjbG9zZVN0YW5kYWxvbmU6IGlzUHJldldoaXRlc3BhY2UoKGludmVyc2UgfHwgcHJvZ3JhbSkuc3RhdGVtZW50cykKICAgIH07CgogICAgaWYgKG11c3RhY2hlLnN0cmlwLnJpZ2h0KSB7CiAgICAgIG9taXRSaWdodChwcm9ncmFtLnN0YXRlbWVudHMsIG51bGwsIHRydWUpOwogICAgfQoKICAgIGlmIChpbnZlcnNlKSB7CiAgICAgIHZhciBpbnZlcnNlU3RyaXAgPSBpbnZlcnNlQW5kUHJvZ3JhbS5zdHJpcDsKCiAgICAgIGlmIChpbnZlcnNlU3RyaXAubGVmdCkgewogICAgICAgIG9taXRMZWZ0KHByb2dyYW0uc3RhdGVtZW50cywgbnVsbCwgdHJ1ZSk7CiAgICAgIH0KICAgICAgaWYgKGludmVyc2VTdHJpcC5yaWdodCkgewogICAgICAgIG9taXRSaWdodChpbnZlcnNlLnN0YXRlbWVudHMsIG51bGwsIHRydWUpOwogICAgICB9CiAgICAgIGlmIChjbG9zZS5zdHJpcC5sZWZ0KSB7CiAgICAgICAgb21pdExlZnQoaW52ZXJzZS5zdGF0ZW1lbnRzLCBudWxsLCB0cnVlKTsKICAgICAgfQoKICAgICAgLy8gRmluZCBzdGFuZGFsb25lIGVsc2Ugc3RhdG1lbnRzCiAgICAgIGlmIChpc1ByZXZXaGl0ZXNwYWNlKHByb2dyYW0uc3RhdGVtZW50cykKICAgICAgICAgICYmIGlzTmV4dFdoaXRlc3BhY2UoaW52ZXJzZS5zdGF0ZW1lbnRzKSkgewoKICAgICAgICBvbWl0TGVmdChwcm9ncmFtLnN0YXRlbWVudHMpOwogICAgICAgIG9taXRSaWdodChpbnZlcnNlLnN0YXRlbWVudHMpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoY2xvc2Uuc3RyaXAubGVmdCkgewogICAgICAgIG9taXRMZWZ0KHByb2dyYW0uc3RhdGVtZW50cywgbnVsbCwgdHJ1ZSk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoaW52ZXJ0ZWQpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLkJsb2NrTm9kZShtdXN0YWNoZSwgaW52ZXJzZSwgcHJvZ3JhbSwgc3RyaXAsIGxvY0luZm8pOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLkJsb2NrTm9kZShtdXN0YWNoZSwgcHJvZ3JhbSwgaW52ZXJzZSwgc3RyaXAsIGxvY0luZm8pOwogICAgfQogIH0KCiAgX19leHBvcnRzX18ucHJlcGFyZUJsb2NrID0gcHJlcGFyZUJsb2NrOwogIGZ1bmN0aW9uIHByZXBhcmVQcm9ncmFtKHN0YXRlbWVudHMsIGlzUm9vdCkgewogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzdGF0ZW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgY3VycmVudCA9IHN0YXRlbWVudHNbaV0sCiAgICAgICAgICBzdHJpcCA9IGN1cnJlbnQuc3RyaXA7CgogICAgICBpZiAoIXN0cmlwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciBfaXNQcmV2V2hpdGVzcGFjZSA9IGlzUHJldldoaXRlc3BhY2Uoc3RhdGVtZW50cywgaSwgaXNSb290LCBjdXJyZW50LnR5cGUgPT09ICdwYXJ0aWFsJyksCiAgICAgICAgICBfaXNOZXh0V2hpdGVzcGFjZSA9IGlzTmV4dFdoaXRlc3BhY2Uoc3RhdGVtZW50cywgaSwgaXNSb290KSwKCiAgICAgICAgICBvcGVuU3RhbmRhbG9uZSA9IHN0cmlwLm9wZW5TdGFuZGFsb25lICYmIF9pc1ByZXZXaGl0ZXNwYWNlLAogICAgICAgICAgY2xvc2VTdGFuZGFsb25lID0gc3RyaXAuY2xvc2VTdGFuZGFsb25lICYmIF9pc05leHRXaGl0ZXNwYWNlLAogICAgICAgICAgaW5saW5lU3RhbmRhbG9uZSA9IHN0cmlwLmlubGluZVN0YW5kYWxvbmUgJiYgX2lzUHJldldoaXRlc3BhY2UgJiYgX2lzTmV4dFdoaXRlc3BhY2U7CgogICAgICBpZiAoc3RyaXAucmlnaHQpIHsKICAgICAgICBvbWl0UmlnaHQoc3RhdGVtZW50cywgaSwgdHJ1ZSk7CiAgICAgIH0KICAgICAgaWYgKHN0cmlwLmxlZnQpIHsKICAgICAgICBvbWl0TGVmdChzdGF0ZW1lbnRzLCBpLCB0cnVlKTsKICAgICAgfQoKICAgICAgaWYgKGlubGluZVN0YW5kYWxvbmUpIHsKICAgICAgICBvbWl0UmlnaHQoc3RhdGVtZW50cywgaSk7CgogICAgICAgIGlmIChvbWl0TGVmdChzdGF0ZW1lbnRzLCBpKSkgewogICAgICAgICAgLy8gSWYgd2UgYXJlIG9uIGEgc3RhbmRhbG9uZSBub2RlLCBzYXZlIHRoZSBpbmRlbnQgaW5mbyBmb3IgcGFydGlhbHMKICAgICAgICAgIGlmIChjdXJyZW50LnR5cGUgPT09ICdwYXJ0aWFsJykgewogICAgICAgICAgICBjdXJyZW50LmluZGVudCA9ICgvKFsgXHRdKyQpLykuZXhlYyhzdGF0ZW1lbnRzW2ktMV0ub3JpZ2luYWwpID8gUmVnRXhwLiQxIDogJyc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChvcGVuU3RhbmRhbG9uZSkgewogICAgICAgIG9taXRSaWdodCgoY3VycmVudC5wcm9ncmFtIHx8IGN1cnJlbnQuaW52ZXJzZSkuc3RhdGVtZW50cyk7CgogICAgICAgIC8vIFN0cmlwIG91dCB0aGUgcHJldmlvdXMgY29udGVudCBub2RlIGlmIGl0J3Mgd2hpdGVzcGFjZSBvbmx5CiAgICAgICAgb21pdExlZnQoc3RhdGVtZW50cywgaSk7CiAgICAgIH0KICAgICAgaWYgKGNsb3NlU3RhbmRhbG9uZSkgewogICAgICAgIC8vIEFsd2F5cyBzdHJpcCB0aGUgbmV4dCBub2RlCiAgICAgICAgb21pdFJpZ2h0KHN0YXRlbWVudHMsIGkpOwoKICAgICAgICBvbWl0TGVmdCgoY3VycmVudC5pbnZlcnNlIHx8IGN1cnJlbnQucHJvZ3JhbSkuc3RhdGVtZW50cyk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc3RhdGVtZW50czsKICB9CgogIF9fZXhwb3J0c19fLnByZXBhcmVQcm9ncmFtID0gcHJlcGFyZVByb2dyYW07ZnVuY3Rpb24gaXNQcmV2V2hpdGVzcGFjZShzdGF0ZW1lbnRzLCBpLCBpc1Jvb3QpIHsKICAgIGlmIChpID09PSB1bmRlZmluZWQpIHsKICAgICAgaSA9IHN0YXRlbWVudHMubGVuZ3RoOwogICAgfQoKICAgIC8vIE5vZGVzIHRoYXQgZW5kIHdpdGggbmV3bGluZXMgYXJlIGNvbnNpZGVyZWQgd2hpdGVzcGFjZSAoYnV0IGFyZSBzcGVjaWFsCiAgICAvLyBjYXNlZCBmb3Igc3RyaXAgb3BlcmF0aW9ucykKICAgIHZhciBwcmV2ID0gc3RhdGVtZW50c1tpLTFdLAogICAgICAgIHNpYmxpbmcgPSBzdGF0ZW1lbnRzW2ktMl07CiAgICBpZiAoIXByZXYpIHsKICAgICAgcmV0dXJuIGlzUm9vdDsKICAgIH0KCiAgICBpZiAocHJldi50eXBlID09PSAnY29udGVudCcpIHsKICAgICAgcmV0dXJuIChzaWJsaW5nIHx8ICFpc1Jvb3QgPyAoL1xyP1xuXHMqPyQvKSA6ICgvKF58XHI/XG4pXHMqPyQvKSkudGVzdChwcmV2Lm9yaWdpbmFsKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gaXNOZXh0V2hpdGVzcGFjZShzdGF0ZW1lbnRzLCBpLCBpc1Jvb3QpIHsKICAgIGlmIChpID09PSB1bmRlZmluZWQpIHsKICAgICAgaSA9IC0xOwogICAgfQoKICAgIHZhciBuZXh0ID0gc3RhdGVtZW50c1tpKzFdLAogICAgICAgIHNpYmxpbmcgPSBzdGF0ZW1lbnRzW2krMl07CiAgICBpZiAoIW5leHQpIHsKICAgICAgcmV0dXJuIGlzUm9vdDsKICAgIH0KCiAgICBpZiAobmV4dC50eXBlID09PSAnY29udGVudCcpIHsKICAgICAgcmV0dXJuIChzaWJsaW5nIHx8ICFpc1Jvb3QgPyAoL15ccyo/XHI/XG4vKSA6ICgvXlxzKj8oXHI/XG58JCkvKSkudGVzdChuZXh0Lm9yaWdpbmFsKTsKICAgIH0KICB9CgogIC8vIE1hcmtzIHRoZSBub2RlIHRvIHRoZSByaWdodCBvZiB0aGUgcG9zaXRpb24gYXMgb21pdHRlZC4KICAvLyBJLmUuIHt7Zm9vfX0nICcgd2lsbCBtYXJrIHRoZSAnICcgbm9kZSBhcyBvbWl0dGVkLgogIC8vCiAgLy8gSWYgaSBpcyB1bmRlZmluZWQsIHRoZW4gdGhlIGZpcnN0IGNoaWxkIHdpbGwgYmUgbWFya2VkIGFzIHN1Y2guCiAgLy8KICAvLyBJZiBtdWxpdHBsZSBpcyB0cnV0aHkgdGhlbiBhbGwgd2hpdGVzcGFjZSB3aWxsIGJlIHN0cmlwcGVkIG91dCB1bnRpbCBub24td2hpdGVzcGFjZQogIC8vIGNvbnRlbnQgaXMgbWV0LgogIGZ1bmN0aW9uIG9taXRSaWdodChzdGF0ZW1lbnRzLCBpLCBtdWx0aXBsZSkgewogICAgdmFyIGN1cnJlbnQgPSBzdGF0ZW1lbnRzW2kgPT0gbnVsbCA/IDAgOiBpICsgMV07CiAgICBpZiAoIWN1cnJlbnQgfHwgY3VycmVudC50eXBlICE9PSAnY29udGVudCcgfHwgKCFtdWx0aXBsZSAmJiBjdXJyZW50LnJpZ2h0U3RyaXBwZWQpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgb3JpZ2luYWwgPSBjdXJyZW50LnN0cmluZzsKICAgIGN1cnJlbnQuc3RyaW5nID0gY3VycmVudC5zdHJpbmcucmVwbGFjZShtdWx0aXBsZSA/ICgvXlxzKy8pIDogKC9eWyBcdF0qXHI/XG4/LyksICcnKTsKICAgIGN1cnJlbnQucmlnaHRTdHJpcHBlZCA9IGN1cnJlbnQuc3RyaW5nICE9PSBvcmlnaW5hbDsKICB9CgogIC8vIE1hcmtzIHRoZSBub2RlIHRvIHRoZSBsZWZ0IG9mIHRoZSBwb3NpdGlvbiBhcyBvbWl0dGVkLgogIC8vIEkuZS4gJyAne3tmb299fSB3aWxsIG1hcmsgdGhlICcgJyBub2RlIGFzIG9taXR0ZWQuCiAgLy8KICAvLyBJZiBpIGlzIHVuZGVmaW5lZCB0aGVuIHRoZSBsYXN0IGNoaWxkIHdpbGwgYmUgbWFya2VkIGFzIHN1Y2guCiAgLy8KICAvLyBJZiBtdWxpdHBsZSBpcyB0cnV0aHkgdGhlbiBhbGwgd2hpdGVzcGFjZSB3aWxsIGJlIHN0cmlwcGVkIG91dCB1bnRpbCBub24td2hpdGVzcGFjZQogIC8vIGNvbnRlbnQgaXMgbWV0LgogIGZ1bmN0aW9uIG9taXRMZWZ0KHN0YXRlbWVudHMsIGksIG11bHRpcGxlKSB7CiAgICB2YXIgY3VycmVudCA9IHN0YXRlbWVudHNbaSA9PSBudWxsID8gc3RhdGVtZW50cy5sZW5ndGggLSAxIDogaSAtIDFdOwogICAgaWYgKCFjdXJyZW50IHx8IGN1cnJlbnQudHlwZSAhPT0gJ2NvbnRlbnQnIHx8ICghbXVsdGlwbGUgJiYgY3VycmVudC5sZWZ0U3RyaXBwZWQpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBXZSBvbWl0IHRoZSBsYXN0IG5vZGUgaWYgaXQncyB3aGl0ZXNwYWNlIG9ubHkgYW5kIG5vdCBwcmVjZWVkZWQgYnkgYSBub24tY29udGVudCBub2RlLgogICAgdmFyIG9yaWdpbmFsID0gY3VycmVudC5zdHJpbmc7CiAgICBjdXJyZW50LnN0cmluZyA9IGN1cnJlbnQuc3RyaW5nLnJlcGxhY2UobXVsdGlwbGUgPyAoL1xzKyQvKSA6ICgvWyBcdF0rJC8pLCAnJyk7CiAgICBjdXJyZW50LmxlZnRTdHJpcHBlZCA9IGN1cnJlbnQuc3RyaW5nICE9PSBvcmlnaW5hbDsKICAgIHJldHVybiBjdXJyZW50LmxlZnRTdHJpcHBlZDsKICB9CiAgcmV0dXJuIF9fZXhwb3J0c19fOwp9KShfX21vZHVsZTVfXyk7CgovLyBoYW5kbGViYXJzL2NvbXBpbGVyL2Jhc2UuanMKdmFyIF9fbW9kdWxlOF9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZGVwZW5kZW5jeTRfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX18gPSB7fTsKICB2YXIgcGFyc2VyID0gX19kZXBlbmRlbmN5MV9fOwogIHZhciBBU1QgPSBfX2RlcGVuZGVuY3kyX187CiAgdmFyIEhlbHBlcnMgPSBfX2RlcGVuZGVuY3kzX187CiAgdmFyIGV4dGVuZCA9IF9fZGVwZW5kZW5jeTRfXy5leHRlbmQ7CgogIF9fZXhwb3J0c19fLnBhcnNlciA9IHBhcnNlcjsKCiAgdmFyIHl5ID0ge307CiAgZXh0ZW5kKHl5LCBIZWxwZXJzLCBBU1QpOwoKICBmdW5jdGlvbiBwYXJzZShpbnB1dCkgewogICAgLy8gSnVzdCByZXR1cm4gaWYgYW4gYWxyZWFkeS1jb21waWxlIEFTVCB3YXMgcGFzc2VkIGluLgogICAgaWYgKGlucHV0LmNvbnN0cnVjdG9yID09PSBBU1QuUHJvZ3JhbU5vZGUpIHsgcmV0dXJuIGlucHV0OyB9CgogICAgcGFyc2VyLnl5ID0geXk7CgogICAgcmV0dXJuIHBhcnNlci5wYXJzZShpbnB1dCk7CiAgfQoKICBfX2V4cG9ydHNfXy5wYXJzZSA9IHBhcnNlOwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSkoX19tb2R1bGU5X18sIF9fbW9kdWxlN19fLCBfX21vZHVsZTEwX18sIF9fbW9kdWxlM19fKTsKCi8vIGhhbmRsZWJhcnMvY29tcGlsZXIvY29tcGlsZXIuanMKdmFyIF9fbW9kdWxlMTFfXyA9IChmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZGVwZW5kZW5jeTJfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX18gPSB7fTsKICB2YXIgRXhjZXB0aW9uID0gX19kZXBlbmRlbmN5MV9fOwogIHZhciBpc0FycmF5ID0gX19kZXBlbmRlbmN5Ml9fLmlzQXJyYXk7CgogIHZhciBzbGljZSA9IFtdLnNsaWNlOwoKICBmdW5jdGlvbiBDb21waWxlcigpIHt9CgogIF9fZXhwb3J0c19fLkNvbXBpbGVyID0gQ29tcGlsZXI7Ly8gdGhlIGZvdW5kSGVscGVyIHJlZ2lzdGVyIHdpbGwgZGlzYW1iaWd1YXRlIGhlbHBlciBsb29rdXAgZnJvbSBmaW5kaW5nIGEKICAvLyBmdW5jdGlvbiBpbiBhIGNvbnRleHQuIFRoaXMgaXMgbmVjZXNzYXJ5IGZvciBtdXN0YWNoZSBjb21wYXRpYmlsaXR5LCB3aGljaAogIC8vIHJlcXVpcmVzIHRoYXQgY29udGV4dCBmdW5jdGlvbnMgaW4gYmxvY2tzIGFyZSBldmFsdWF0ZWQgYnkgYmxvY2tIZWxwZXJNaXNzaW5nLAogIC8vIGFuZCB0aGVuIHByb2NlZWQgYXMgaWYgdGhlIHJlc3VsdGluZyB2YWx1ZSB3YXMgcHJvdmlkZWQgdG8gYmxvY2tIZWxwZXJNaXNzaW5nLgoKICBDb21waWxlci5wcm90b3R5cGUgPSB7CiAgICBjb21waWxlcjogQ29tcGlsZXIsCgogICAgZXF1YWxzOiBmdW5jdGlvbihvdGhlcikgewogICAgICB2YXIgbGVuID0gdGhpcy5vcGNvZGVzLmxlbmd0aDsKICAgICAgaWYgKG90aGVyLm9wY29kZXMubGVuZ3RoICE9PSBsZW4pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgb3Bjb2RlID0gdGhpcy5vcGNvZGVzW2ldLAogICAgICAgICAgICBvdGhlck9wY29kZSA9IG90aGVyLm9wY29kZXNbaV07CiAgICAgICAgaWYgKG9wY29kZS5vcGNvZGUgIT09IG90aGVyT3Bjb2RlLm9wY29kZSB8fCAhYXJnRXF1YWxzKG9wY29kZS5hcmdzLCBvdGhlck9wY29kZS5hcmdzKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gV2Uga25vdyB0aGF0IGxlbmd0aCBpcyB0aGUgc2FtZSBiZXR3ZWVuIHRoZSB0d28gYXJyYXlzIGJlY2F1c2UgdGhleSBhcmUgZGlyZWN0bHkgdGllZAogICAgICAvLyB0byB0aGUgb3Bjb2RlIGJlaGF2aW9yIGFib3ZlLgogICAgICBsZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmVxdWFscyhvdGhlci5jaGlsZHJlbltpXSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICBndWlkOiAwLAoKICAgIGNvbXBpbGU6IGZ1bmN0aW9uKHByb2dyYW0sIG9wdGlvbnMpIHsKICAgICAgdGhpcy5vcGNvZGVzID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgICAgdGhpcy5kZXB0aHMgPSB7bGlzdDogW119OwogICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICB0aGlzLnN0cmluZ1BhcmFtcyA9IG9wdGlvbnMuc3RyaW5nUGFyYW1zOwogICAgICB0aGlzLnRyYWNrSWRzID0gb3B0aW9ucy50cmFja0lkczsKCiAgICAgIC8vIFRoZXNlIGNoYW5nZXMgd2lsbCBwcm9wYWdhdGUgdG8gdGhlIG90aGVyIGNvbXBpbGVyIGNvbXBvbmVudHMKICAgICAgdmFyIGtub3duSGVscGVycyA9IHRoaXMub3B0aW9ucy5rbm93bkhlbHBlcnM7CiAgICAgIHRoaXMub3B0aW9ucy5rbm93bkhlbHBlcnMgPSB7CiAgICAgICAgJ2hlbHBlck1pc3NpbmcnOiB0cnVlLAogICAgICAgICdibG9ja0hlbHBlck1pc3NpbmcnOiB0cnVlLAogICAgICAgICdlYWNoJzogdHJ1ZSwKICAgICAgICAnaWYnOiB0cnVlLAogICAgICAgICd1bmxlc3MnOiB0cnVlLAogICAgICAgICd3aXRoJzogdHJ1ZSwKICAgICAgICAnbG9nJzogdHJ1ZSwKICAgICAgICAnbG9va3VwJzogdHJ1ZQogICAgICB9OwogICAgICBpZiAoa25vd25IZWxwZXJzKSB7CiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBrbm93bkhlbHBlcnMpIHsKICAgICAgICAgIHRoaXMub3B0aW9ucy5rbm93bkhlbHBlcnNbbmFtZV0gPSBrbm93bkhlbHBlcnNbbmFtZV07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5hY2NlcHQocHJvZ3JhbSk7CiAgICB9LAoKICAgIGFjY2VwdDogZnVuY3Rpb24obm9kZSkgewogICAgICByZXR1cm4gdGhpc1tub2RlLnR5cGVdKG5vZGUpOwogICAgfSwKCiAgICBwcm9ncmFtOiBmdW5jdGlvbihwcm9ncmFtKSB7CiAgICAgIHZhciBzdGF0ZW1lbnRzID0gcHJvZ3JhbS5zdGF0ZW1lbnRzOwoKICAgICAgZm9yKHZhciBpPTAsIGw9c3RhdGVtZW50cy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgdGhpcy5hY2NlcHQoc3RhdGVtZW50c1tpXSk7CiAgICAgIH0KICAgICAgdGhpcy5pc1NpbXBsZSA9IGwgPT09IDE7CgogICAgICB0aGlzLmRlcHRocy5saXN0ID0gdGhpcy5kZXB0aHMubGlzdC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIGNvbXBpbGVQcm9ncmFtOiBmdW5jdGlvbihwcm9ncmFtKSB7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgdGhpcy5jb21waWxlcigpLmNvbXBpbGUocHJvZ3JhbSwgdGhpcy5vcHRpb25zKTsKICAgICAgdmFyIGd1aWQgPSB0aGlzLmd1aWQrKywgZGVwdGg7CgogICAgICB0aGlzLnVzZVBhcnRpYWwgPSB0aGlzLnVzZVBhcnRpYWwgfHwgcmVzdWx0LnVzZVBhcnRpYWw7CgogICAgICB0aGlzLmNoaWxkcmVuW2d1aWRdID0gcmVzdWx0OwoKICAgICAgZm9yKHZhciBpPTAsIGw9cmVzdWx0LmRlcHRocy5saXN0Lmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICBkZXB0aCA9IHJlc3VsdC5kZXB0aHMubGlzdFtpXTsKCiAgICAgICAgaWYoZGVwdGggPCAyKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgZWxzZSB7IHRoaXMuYWRkRGVwdGgoZGVwdGggLSAxKTsgfQogICAgICB9CgogICAgICByZXR1cm4gZ3VpZDsKICAgIH0sCgogICAgYmxvY2s6IGZ1bmN0aW9uKGJsb2NrKSB7CiAgICAgIHZhciBtdXN0YWNoZSA9IGJsb2NrLm11c3RhY2hlLAogICAgICAgICAgcHJvZ3JhbSA9IGJsb2NrLnByb2dyYW0sCiAgICAgICAgICBpbnZlcnNlID0gYmxvY2suaW52ZXJzZTsKCiAgICAgIGlmIChwcm9ncmFtKSB7CiAgICAgICAgcHJvZ3JhbSA9IHRoaXMuY29tcGlsZVByb2dyYW0ocHJvZ3JhbSk7CiAgICAgIH0KCiAgICAgIGlmIChpbnZlcnNlKSB7CiAgICAgICAgaW52ZXJzZSA9IHRoaXMuY29tcGlsZVByb2dyYW0oaW52ZXJzZSk7CiAgICAgIH0KCiAgICAgIHZhciBzZXhwciA9IG11c3RhY2hlLnNleHByOwogICAgICB2YXIgdHlwZSA9IHRoaXMuY2xhc3NpZnlTZXhwcihzZXhwcik7CgogICAgICBpZiAodHlwZSA9PT0gImhlbHBlciIpIHsKICAgICAgICB0aGlzLmhlbHBlclNleHByKHNleHByLCBwcm9ncmFtLCBpbnZlcnNlKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAic2ltcGxlIikgewogICAgICAgIHRoaXMuc2ltcGxlU2V4cHIoc2V4cHIpOwoKICAgICAgICAvLyBub3cgdGhhdCB0aGUgc2ltcGxlIG11c3RhY2hlIGlzIHJlc29sdmVkLCB3ZSBuZWVkIHRvCiAgICAgICAgLy8gZXZhbHVhdGUgaXQgYnkgZXhlY3V0aW5nIGBibG9ja0hlbHBlck1pc3NpbmdgCiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgcHJvZ3JhbSk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgaW52ZXJzZSk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2VtcHR5SGFzaCcpOwogICAgICAgIHRoaXMub3Bjb2RlKCdibG9ja1ZhbHVlJywgc2V4cHIuaWQub3JpZ2luYWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYW1iaWd1b3VzU2V4cHIoc2V4cHIsIHByb2dyYW0sIGludmVyc2UpOwoKICAgICAgICAvLyBub3cgdGhhdCB0aGUgc2ltcGxlIG11c3RhY2hlIGlzIHJlc29sdmVkLCB3ZSBuZWVkIHRvCiAgICAgICAgLy8gZXZhbHVhdGUgaXQgYnkgZXhlY3V0aW5nIGBibG9ja0hlbHBlck1pc3NpbmdgCiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgcHJvZ3JhbSk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgaW52ZXJzZSk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2VtcHR5SGFzaCcpOwogICAgICAgIHRoaXMub3Bjb2RlKCdhbWJpZ3VvdXNCbG9ja1ZhbHVlJyk7CiAgICAgIH0KCiAgICAgIHRoaXMub3Bjb2RlKCdhcHBlbmQnKTsKICAgIH0sCgogICAgaGFzaDogZnVuY3Rpb24oaGFzaCkgewogICAgICB2YXIgcGFpcnMgPSBoYXNoLnBhaXJzLCBpLCBsOwoKICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hIYXNoJyk7CgogICAgICBmb3IoaT0wLCBsPXBhaXJzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICB0aGlzLnB1c2hQYXJhbShwYWlyc1tpXVsxXSk7CiAgICAgIH0KICAgICAgd2hpbGUoaS0tKSB7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2Fzc2lnblRvSGFzaCcsIHBhaXJzW2ldWzBdKTsKICAgICAgfQogICAgICB0aGlzLm9wY29kZSgncG9wSGFzaCcpOwogICAgfSwKCiAgICBwYXJ0aWFsOiBmdW5jdGlvbihwYXJ0aWFsKSB7CiAgICAgIHZhciBwYXJ0aWFsTmFtZSA9IHBhcnRpYWwucGFydGlhbE5hbWU7CiAgICAgIHRoaXMudXNlUGFydGlhbCA9IHRydWU7CgogICAgICBpZiAocGFydGlhbC5oYXNoKSB7CiAgICAgICAgdGhpcy5hY2NlcHQocGFydGlhbC5oYXNoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm9wY29kZSgncHVzaCcsICd1bmRlZmluZWQnKTsKICAgICAgfQoKICAgICAgaWYgKHBhcnRpYWwuY29udGV4dCkgewogICAgICAgIHRoaXMuYWNjZXB0KHBhcnRpYWwuY29udGV4dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2dldENvbnRleHQnLCAwKTsKICAgICAgICB0aGlzLm9wY29kZSgncHVzaENvbnRleHQnKTsKICAgICAgfQoKICAgICAgdGhpcy5vcGNvZGUoJ2ludm9rZVBhcnRpYWwnLCBwYXJ0aWFsTmFtZS5uYW1lLCBwYXJ0aWFsLmluZGVudCB8fCAnJyk7CiAgICAgIHRoaXMub3Bjb2RlKCdhcHBlbmQnKTsKICAgIH0sCgogICAgY29udGVudDogZnVuY3Rpb24oY29udGVudCkgewogICAgICBpZiAoY29udGVudC5zdHJpbmcpIHsKICAgICAgICB0aGlzLm9wY29kZSgnYXBwZW5kQ29udGVudCcsIGNvbnRlbnQuc3RyaW5nKTsKICAgICAgfQogICAgfSwKCiAgICBtdXN0YWNoZTogZnVuY3Rpb24obXVzdGFjaGUpIHsKICAgICAgdGhpcy5zZXhwcihtdXN0YWNoZS5zZXhwcik7CgogICAgICBpZihtdXN0YWNoZS5lc2NhcGVkICYmICF0aGlzLm9wdGlvbnMubm9Fc2NhcGUpIHsKICAgICAgICB0aGlzLm9wY29kZSgnYXBwZW5kRXNjYXBlZCcpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMub3Bjb2RlKCdhcHBlbmQnKTsKICAgICAgfQogICAgfSwKCiAgICBhbWJpZ3VvdXNTZXhwcjogZnVuY3Rpb24oc2V4cHIsIHByb2dyYW0sIGludmVyc2UpIHsKICAgICAgdmFyIGlkID0gc2V4cHIuaWQsCiAgICAgICAgICBuYW1lID0gaWQucGFydHNbMF0sCiAgICAgICAgICBpc0Jsb2NrID0gcHJvZ3JhbSAhPSBudWxsIHx8IGludmVyc2UgIT0gbnVsbDsKCiAgICAgIHRoaXMub3Bjb2RlKCdnZXRDb250ZXh0JywgaWQuZGVwdGgpOwoKICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgcHJvZ3JhbSk7CiAgICAgIHRoaXMub3Bjb2RlKCdwdXNoUHJvZ3JhbScsIGludmVyc2UpOwoKICAgICAgdGhpcy5JRChpZCk7CgogICAgICB0aGlzLm9wY29kZSgnaW52b2tlQW1iaWd1b3VzJywgbmFtZSwgaXNCbG9jayk7CiAgICB9LAoKICAgIHNpbXBsZVNleHByOiBmdW5jdGlvbihzZXhwcikgewogICAgICB2YXIgaWQgPSBzZXhwci5pZDsKCiAgICAgIGlmIChpZC50eXBlID09PSAnREFUQScpIHsKICAgICAgICB0aGlzLkRBVEEoaWQpOwogICAgICB9IGVsc2UgaWYgKGlkLnBhcnRzLmxlbmd0aCkgewogICAgICAgIHRoaXMuSUQoaWQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNpbXBsaWZpZWQgSUQgZm9yIGB0aGlzYAogICAgICAgIHRoaXMuYWRkRGVwdGgoaWQuZGVwdGgpOwogICAgICAgIHRoaXMub3Bjb2RlKCdnZXRDb250ZXh0JywgaWQuZGVwdGgp", "base64"));
  res.write(new Buffer("OwogICAgICAgIHRoaXMub3Bjb2RlKCdwdXNoQ29udGV4dCcpOwogICAgICB9CgogICAgICB0aGlzLm9wY29kZSgncmVzb2x2ZVBvc3NpYmxlTGFtYmRhJyk7CiAgICB9LAoKICAgIGhlbHBlclNleHByOiBmdW5jdGlvbihzZXhwciwgcHJvZ3JhbSwgaW52ZXJzZSkgewogICAgICB2YXIgcGFyYW1zID0gdGhpcy5zZXR1cEZ1bGxNdXN0YWNoZVBhcmFtcyhzZXhwciwgcHJvZ3JhbSwgaW52ZXJzZSksCiAgICAgICAgICBpZCA9IHNleHByLmlkLAogICAgICAgICAgbmFtZSA9IGlkLnBhcnRzWzBdOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5rbm93bkhlbHBlcnNbbmFtZV0pIHsKICAgICAgICB0aGlzLm9wY29kZSgnaW52b2tlS25vd25IZWxwZXInLCBwYXJhbXMubGVuZ3RoLCBuYW1lKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMua25vd25IZWxwZXJzT25seSkgewogICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIllvdSBzcGVjaWZpZWQga25vd25IZWxwZXJzT25seSwgYnV0IHVzZWQgdGhlIHVua25vd24gaGVscGVyICIgKyBuYW1lLCBzZXhwcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWQuZmFsc3kgPSB0cnVlOwoKICAgICAgICB0aGlzLklEKGlkKTsKICAgICAgICB0aGlzLm9wY29kZSgnaW52b2tlSGVscGVyJywgcGFyYW1zLmxlbmd0aCwgaWQub3JpZ2luYWwsIGlkLmlzU2ltcGxlKTsKICAgICAgfQogICAgfSwKCiAgICBzZXhwcjogZnVuY3Rpb24oc2V4cHIpIHsKICAgICAgdmFyIHR5cGUgPSB0aGlzLmNsYXNzaWZ5U2V4cHIoc2V4cHIpOwoKICAgICAgaWYgKHR5cGUgPT09ICJzaW1wbGUiKSB7CiAgICAgICAgdGhpcy5zaW1wbGVTZXhwcihzZXhwcik7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImhlbHBlciIpIHsKICAgICAgICB0aGlzLmhlbHBlclNleHByKHNleHByKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFtYmlndW91c1NleHByKHNleHByKTsKICAgICAgfQogICAgfSwKCiAgICBJRDogZnVuY3Rpb24oaWQpIHsKICAgICAgdGhpcy5hZGREZXB0aChpZC5kZXB0aCk7CiAgICAgIHRoaXMub3Bjb2RlKCdnZXRDb250ZXh0JywgaWQuZGVwdGgpOwoKICAgICAgdmFyIG5hbWUgPSBpZC5wYXJ0c1swXTsKICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgLy8gQ29udGV4dCByZWZlcmVuY2UsIGkuZS4gYHt7Zm9vIC59fWAgb3IgYHt7Zm9vIC4ufX1gCiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hDb250ZXh0Jyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5vcGNvZGUoJ2xvb2t1cE9uQ29udGV4dCcsIGlkLnBhcnRzLCBpZC5mYWxzeSwgaWQuaXNTY29wZWQpOwogICAgICB9CiAgICB9LAoKICAgIERBVEE6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgdGhpcy5vcHRpb25zLmRhdGEgPSB0cnVlOwogICAgICB0aGlzLm9wY29kZSgnbG9va3VwRGF0YScsIGRhdGEuaWQuZGVwdGgsIGRhdGEuaWQucGFydHMpOwogICAgfSwKCiAgICBTVFJJTkc6IGZ1bmN0aW9uKHN0cmluZykgewogICAgICB0aGlzLm9wY29kZSgncHVzaFN0cmluZycsIHN0cmluZy5zdHJpbmcpOwogICAgfSwKCiAgICBOVU1CRVI6IGZ1bmN0aW9uKG51bWJlcikgewogICAgICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBudW1iZXIubnVtYmVyKTsKICAgIH0sCgogICAgQk9PTEVBTjogZnVuY3Rpb24oYm9vbCkgewogICAgICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBib29sLmJvb2wpOwogICAgfSwKCiAgICBjb21tZW50OiBmdW5jdGlvbigpIHt9LAoKICAgIC8vIEhFTFBFUlMKICAgIG9wY29kZTogZnVuY3Rpb24obmFtZSkgewogICAgICB0aGlzLm9wY29kZXMucHVzaCh7IG9wY29kZTogbmFtZSwgYXJnczogc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpIH0pOwogICAgfSwKCiAgICBhZGREZXB0aDogZnVuY3Rpb24oZGVwdGgpIHsKICAgICAgaWYoZGVwdGggPT09IDApIHsgcmV0dXJuOyB9CgogICAgICBpZighdGhpcy5kZXB0aHNbZGVwdGhdKSB7CiAgICAgICAgdGhpcy5kZXB0aHNbZGVwdGhdID0gdHJ1ZTsKICAgICAgICB0aGlzLmRlcHRocy5saXN0LnB1c2goZGVwdGgpOwogICAgICB9CiAgICB9LAoKICAgIGNsYXNzaWZ5U2V4cHI6IGZ1bmN0aW9uKHNleHByKSB7CiAgICAgIHZhciBpc0hlbHBlciAgID0gc2V4cHIuaXNIZWxwZXI7CiAgICAgIHZhciBpc0VsaWdpYmxlID0gc2V4cHIuZWxpZ2libGVIZWxwZXI7CiAgICAgIHZhciBvcHRpb25zICAgID0gdGhpcy5vcHRpb25zOwoKICAgICAgLy8gaWYgYW1iaWd1b3VzLCB3ZSBjYW4gcG9zc2libHkgcmVzb2x2ZSB0aGUgYW1iaWd1aXR5IG5vdwogICAgICAvLyBBbiBlbGlnaWJsZSBoZWxwZXIgaXMgb25lIHRoYXQgZG9lcyBub3QgaGF2ZSBhIGNvbXBsZXggcGF0aCwgaS5lLiBgdGhpcy5mb29gLCBgLi4vZm9vYCBldGMuCiAgICAgIGlmIChpc0VsaWdpYmxlICYmICFpc0hlbHBlcikgewogICAgICAgIHZhciBuYW1lID0gc2V4cHIuaWQucGFydHNbMF07CgogICAgICAgIGlmIChvcHRpb25zLmtub3duSGVscGVyc1tuYW1lXSkgewogICAgICAgICAgaXNIZWxwZXIgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5rbm93bkhlbHBlcnNPbmx5KSB7CiAgICAgICAgICBpc0VsaWdpYmxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoaXNIZWxwZXIpIHsgcmV0dXJuICJoZWxwZXIiOyB9CiAgICAgIGVsc2UgaWYgKGlzRWxpZ2libGUpIHsgcmV0dXJuICJhbWJpZ3VvdXMiOyB9CiAgICAgIGVsc2UgeyByZXR1cm4gInNpbXBsZSI7IH0KICAgIH0sCgogICAgcHVzaFBhcmFtczogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgIGZvcih2YXIgaT0wLCBsPXBhcmFtcy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgdGhpcy5wdXNoUGFyYW0ocGFyYW1zW2ldKTsKICAgICAgfQogICAgfSwKCiAgICBwdXNoUGFyYW06IGZ1bmN0aW9uKHZhbCkgewogICAgICBpZiAodGhpcy5zdHJpbmdQYXJhbXMpIHsKICAgICAgICBpZih2YWwuZGVwdGgpIHsKICAgICAgICAgIHRoaXMuYWRkRGVwdGgodmFsLmRlcHRoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5vcGNvZGUoJ2dldENvbnRleHQnLCB2YWwuZGVwdGggfHwgMCk7CiAgICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hTdHJpbmdQYXJhbScsIHZhbC5zdHJpbmdNb2RlVmFsdWUsIHZhbC50eXBlKTsKCiAgICAgICAgaWYgKHZhbC50eXBlID09PSAnc2V4cHInKSB7CiAgICAgICAgICAvLyBTdWJleHByZXNzaW9ucyBnZXQgZXZhbHVhdGVkIGFuZCBwYXNzZWQgaW4KICAgICAgICAgIC8vIGluIHN0cmluZyBwYXJhbXMgbW9kZS4KICAgICAgICAgIHRoaXMuc2V4cHIodmFsKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKICAgICAgICAgIHRoaXMub3Bjb2RlKCdwdXNoSWQnLCB2YWwudHlwZSwgdmFsLmlkTmFtZSB8fCB2YWwuc3RyaW5nTW9kZVZhbHVlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5hY2NlcHQodmFsKTsKICAgICAgfQogICAgfSwKCiAgICBzZXR1cEZ1bGxNdXN0YWNoZVBhcmFtczogZnVuY3Rpb24oc2V4cHIsIHByb2dyYW0sIGludmVyc2UpIHsKICAgICAgdmFyIHBhcmFtcyA9IHNleHByLnBhcmFtczsKICAgICAgdGhpcy5wdXNoUGFyYW1zKHBhcmFtcyk7CgogICAgICB0aGlzLm9wY29kZSgncHVzaFByb2dyYW0nLCBwcm9ncmFtKTsKICAgICAgdGhpcy5vcGNvZGUoJ3B1c2hQcm9ncmFtJywgaW52ZXJzZSk7CgogICAgICBpZiAoc2V4cHIuaGFzaCkgewogICAgICAgIHRoaXMuaGFzaChzZXhwci5oYXNoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm9wY29kZSgnZW1wdHlIYXNoJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwYXJhbXM7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gcHJlY29tcGlsZShpbnB1dCwgb3B0aW9ucywgZW52KSB7CiAgICBpZiAoaW5wdXQgPT0gbnVsbCB8fCAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJyAmJiBpbnB1dC5jb25zdHJ1Y3RvciAhPT0gZW52LkFTVC5Qcm9ncmFtTm9kZSkpIHsKICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiWW91IG11c3QgcGFzcyBhIHN0cmluZyBvciBIYW5kbGViYXJzIEFTVCB0byBIYW5kbGViYXJzLnByZWNvbXBpbGUuIFlvdSBwYXNzZWQgIiArIGlucHV0KTsKICAgIH0KCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIGlmICghKCdkYXRhJyBpbiBvcHRpb25zKSkgewogICAgICBvcHRpb25zLmRhdGEgPSB0cnVlOwogICAgfQogICAgaWYgKG9wdGlvbnMuY29tcGF0KSB7CiAgICAgIG9wdGlvbnMudXNlRGVwdGhzID0gdHJ1ZTsKICAgIH0KCiAgICB2YXIgYXN0ID0gZW52LnBhcnNlKGlucHV0KTsKICAgIHZhciBlbnZpcm9ubWVudCA9IG5ldyBlbnYuQ29tcGlsZXIoKS5jb21waWxlKGFzdCwgb3B0aW9ucyk7CiAgICByZXR1cm4gbmV3IGVudi5KYXZhU2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGVudmlyb25tZW50LCBvcHRpb25zKTsKICB9CgogIF9fZXhwb3J0c19fLnByZWNvbXBpbGUgPSBwcmVjb21waWxlO2Z1bmN0aW9uIGNvbXBpbGUoaW5wdXQsIG9wdGlvbnMsIGVudikgewogICAgaWYgKGlucHV0ID09IG51bGwgfHwgKHR5cGVvZiBpbnB1dCAhPT0gJ3N0cmluZycgJiYgaW5wdXQuY29uc3RydWN0b3IgIT09IGVudi5BU1QuUHJvZ3JhbU5vZGUpKSB7CiAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIllvdSBtdXN0IHBhc3MgYSBzdHJpbmcgb3IgSGFuZGxlYmFycyBBU1QgdG8gSGFuZGxlYmFycy5jb21waWxlLiBZb3UgcGFzc2VkICIgKyBpbnB1dCk7CiAgICB9CgogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgaWYgKCEoJ2RhdGEnIGluIG9wdGlvbnMpKSB7CiAgICAgIG9wdGlvbnMuZGF0YSA9IHRydWU7CiAgICB9CiAgICBpZiAob3B0aW9ucy5jb21wYXQpIHsKICAgICAgb3B0aW9ucy51c2VEZXB0aHMgPSB0cnVlOwogICAgfQoKICAgIHZhciBjb21waWxlZDsKCiAgICBmdW5jdGlvbiBjb21waWxlSW5wdXQoKSB7CiAgICAgIHZhciBhc3QgPSBlbnYucGFyc2UoaW5wdXQpOwogICAgICB2YXIgZW52aXJvbm1lbnQgPSBuZXcgZW52LkNvbXBpbGVyKCkuY29tcGlsZShhc3QsIG9wdGlvbnMpOwogICAgICB2YXIgdGVtcGxhdGVTcGVjID0gbmV3IGVudi5KYXZhU2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGVudmlyb25tZW50LCBvcHRpb25zLCB1bmRlZmluZWQsIHRydWUpOwogICAgICByZXR1cm4gZW52LnRlbXBsYXRlKHRlbXBsYXRlU3BlYyk7CiAgICB9CgogICAgLy8gVGVtcGxhdGUgaXMgb25seSBjb21waWxlZCBvbiBmaXJzdCB1c2UgYW5kIGNhY2hlZCBhZnRlciB0aGF0IHBvaW50LgogICAgdmFyIHJldCA9IGZ1bmN0aW9uKGNvbnRleHQsIG9wdGlvbnMpIHsKICAgICAgaWYgKCFjb21waWxlZCkgewogICAgICAgIGNvbXBpbGVkID0gY29tcGlsZUlucHV0KCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbXBpbGVkLmNhbGwodGhpcywgY29udGV4dCwgb3B0aW9ucyk7CiAgICB9OwogICAgcmV0Ll9zZXR1cCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKCFjb21waWxlZCkgewogICAgICAgIGNvbXBpbGVkID0gY29tcGlsZUlucHV0KCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbXBpbGVkLl9zZXR1cChvcHRpb25zKTsKICAgIH07CiAgICByZXQuX2NoaWxkID0gZnVuY3Rpb24oaSwgZGF0YSwgZGVwdGhzKSB7CiAgICAgIGlmICghY29tcGlsZWQpIHsKICAgICAgICBjb21waWxlZCA9IGNvbXBpbGVJbnB1dCgpOwogICAgICB9CiAgICAgIHJldHVybiBjb21waWxlZC5fY2hpbGQoaSwgZGF0YSwgZGVwdGhzKTsKICAgIH07CiAgICByZXR1cm4gcmV0OwogIH0KCiAgX19leHBvcnRzX18uY29tcGlsZSA9IGNvbXBpbGU7ZnVuY3Rpb24gYXJnRXF1YWxzKGEsIGIpIHsKICAgIGlmIChhID09PSBiKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGlmIChpc0FycmF5KGEpICYmIGlzQXJyYXkoYikgJiYgYS5sZW5ndGggPT09IGIubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICghYXJnRXF1YWxzKGFbaV0sIGJbaV0pKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0KICByZXR1cm4gX19leHBvcnRzX187Cn0pKF9fbW9kdWxlNV9fLCBfX21vZHVsZTNfXyk7CgovLyBoYW5kbGViYXJzL2NvbXBpbGVyL2phdmFzY3JpcHQtY29tcGlsZXIuanMKdmFyIF9fbW9kdWxlMTJfXyA9IChmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZGVwZW5kZW5jeTJfXykgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgX19leHBvcnRzX187CiAgdmFyIENPTVBJTEVSX1JFVklTSU9OID0gX19kZXBlbmRlbmN5MV9fLkNPTVBJTEVSX1JFVklTSU9OOwogIHZhciBSRVZJU0lPTl9DSEFOR0VTID0gX19kZXBlbmRlbmN5MV9fLlJFVklTSU9OX0NIQU5HRVM7CiAgdmFyIEV4Y2VwdGlvbiA9IF9fZGVwZW5kZW5jeTJfXzsKCiAgZnVuY3Rpb24gTGl0ZXJhbCh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogIH0KCiAgZnVuY3Rpb24gSmF2YVNjcmlwdENvbXBpbGVyKCkge30KCiAgSmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZSA9IHsKICAgIC8vIFBVQkxJQyBBUEk6IFlvdSBjYW4gb3ZlcnJpZGUgdGhlc2UgbWV0aG9kcyBpbiBhIHN1YmNsYXNzIHRvIHByb3ZpZGUKICAgIC8vIGFsdGVybmF0aXZlIGNvbXBpbGVkIGZvcm1zIGZvciBuYW1lIGxvb2t1cCBhbmQgYnVmZmVyaW5nIHNlbWFudGljcwogICAgbmFtZUxvb2t1cDogZnVuY3Rpb24ocGFyZW50LCBuYW1lIC8qICwgdHlwZSovKSB7CiAgICAgIGlmIChKYXZhU2NyaXB0Q29tcGlsZXIuaXNWYWxpZEphdmFTY3JpcHRWYXJpYWJsZU5hbWUobmFtZSkpIHsKICAgICAgICByZXR1cm4gcGFyZW50ICsgIi4iICsgbmFtZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gcGFyZW50ICsgIlsnIiArIG5hbWUgKyAiJ10iOwogICAgICB9CiAgICB9LAogICAgZGVwdGhlZExvb2t1cDogZnVuY3Rpb24obmFtZSkgewogICAgICB0aGlzLmFsaWFzZXMubG9va3VwID0gJ3RoaXMubG9va3VwJzsKCiAgICAgIHJldHVybiAnbG9va3VwKGRlcHRocywgIicgKyBuYW1lICsgJyIpJzsKICAgIH0sCgogICAgY29tcGlsZXJJbmZvOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHJldmlzaW9uID0gQ09NUElMRVJfUkVWSVNJT04sCiAgICAgICAgICB2ZXJzaW9ucyA9IFJFVklTSU9OX0NIQU5HRVNbcmV2aXNpb25dOwogICAgICByZXR1cm4gW3JldmlzaW9uLCB2ZXJzaW9uc107CiAgICB9LAoKICAgIGFwcGVuZFRvQnVmZmVyOiBmdW5jdGlvbihzdHJpbmcpIHsKICAgICAgaWYgKHRoaXMuZW52aXJvbm1lbnQuaXNTaW1wbGUpIHsKICAgICAgICByZXR1cm4gInJldHVybiAiICsgc3RyaW5nICsgIjsiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBhcHBlbmRUb0J1ZmZlcjogdHJ1ZSwKICAgICAgICAgIGNvbnRlbnQ6IHN0cmluZywKICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsgcmV0dXJuICJidWZmZXIgKz0gIiArIHN0cmluZyArICI7IjsgfQogICAgICAgIH07CiAgICAgIH0KICAgIH0sCgogICAgaW5pdGlhbGl6ZUJ1ZmZlcjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnF1b3RlZFN0cmluZygiIik7CiAgICB9LAoKICAgIG5hbWVzcGFjZTogIkhhbmRsZWJhcnMiLAogICAgLy8gRU5EIFBVQkxJQyBBUEkKCiAgICBjb21waWxlOiBmdW5jdGlvbihlbnZpcm9ubWVudCwgb3B0aW9ucywgY29udGV4dCwgYXNPYmplY3QpIHsKICAgICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50OwogICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICB0aGlzLnN0cmluZ1BhcmFtcyA9IHRoaXMub3B0aW9ucy5zdHJpbmdQYXJhbXM7CiAgICAgIHRoaXMudHJhY2tJZHMgPSB0aGlzLm9wdGlvbnMudHJhY2tJZHM7CiAgICAgIHRoaXMucHJlY29tcGlsZSA9ICFhc09iamVjdDsKCiAgICAgIHRoaXMubmFtZSA9IHRoaXMuZW52aXJvbm1lbnQubmFtZTsKICAgICAgdGhpcy5pc0NoaWxkID0gISFjb250ZXh0OwogICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0IHx8IHsKICAgICAgICBwcm9ncmFtczogW10sCiAgICAgICAgZW52aXJvbm1lbnRzOiBbXQogICAgICB9OwoKICAgICAgdGhpcy5wcmVhbWJsZSgpOwoKICAgICAgdGhpcy5zdGFja1Nsb3QgPSAwOwogICAgICB0aGlzLnN0YWNrVmFycyA9IFtdOwogICAgICB0aGlzLmFsaWFzZXMgPSB7fTsKICAgICAgdGhpcy5yZWdpc3RlcnMgPSB7IGxpc3Q6IFtdIH07CiAgICAgIHRoaXMuaGFzaGVzID0gW107CiAgICAgIHRoaXMuY29tcGlsZVN0YWNrID0gW107CiAgICAgIHRoaXMuaW5saW5lU3RhY2sgPSBbXTsKCiAgICAgIHRoaXMuY29tcGlsZUNoaWxkcmVuKGVudmlyb25tZW50LCBvcHRpb25zKTsKCiAgICAgIHRoaXMudXNlRGVwdGhzID0gdGhpcy51c2VEZXB0aHMgfHwgZW52aXJvbm1lbnQuZGVwdGhzLmxpc3QubGVuZ3RoIHx8IHRoaXMub3B0aW9ucy5jb21wYXQ7CgogICAgICB2YXIgb3Bjb2RlcyA9IGVudmlyb25tZW50Lm9wY29kZXMsCiAgICAgICAgICBvcGNvZGUsCiAgICAgICAgICBpLAogICAgICAgICAgbDsKCiAgICAgIGZvciAoaSA9IDAsIGwgPSBvcGNvZGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG9wY29kZSA9IG9wY29kZXNbaV07CgogICAgICAgIHRoaXNbb3Bjb2RlLm9wY29kZV0uYXBwbHkodGhpcywgb3Bjb2RlLmFyZ3MpOwogICAgICB9CgogICAgICAvLyBGbHVzaCBhbnkgdHJhaWxpbmcgY29udGVudCB0aGF0IG1pZ2h0IGJlIHBlbmRpbmcuCiAgICAgIHRoaXMucHVzaFNvdXJjZSgnJyk7CgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICBpZiAodGhpcy5zdGFja1Nsb3QgfHwgdGhpcy5pbmxpbmVTdGFjay5sZW5ndGggfHwgdGhpcy5jb21waWxlU3RhY2subGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignQ29tcGlsZSBjb21wbGV0ZWQgd2l0aCBjb250ZW50IGxlZnQgb24gc3RhY2snKTsKICAgICAgfQoKICAgICAgdmFyIGZuID0gdGhpcy5jcmVhdGVGdW5jdGlvbkNvbnRleHQoYXNPYmplY3QpOwogICAgICBpZiAoIXRoaXMuaXNDaGlsZCkgewogICAgICAgIHZhciByZXQgPSB7CiAgICAgICAgICBjb21waWxlcjogdGhpcy5jb21waWxlckluZm8oKSwKICAgICAgICAgIG1haW46IGZuCiAgICAgICAgfTsKICAgICAgICB2YXIgcHJvZ3JhbXMgPSB0aGlzLmNvbnRleHQucHJvZ3JhbXM7CiAgICAgICAgZm9yIChpID0gMCwgbCA9IHByb2dyYW1zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgaWYgKHByb2dyYW1zW2ldKSB7CiAgICAgICAgICAgIHJldFtpXSA9IHByb2dyYW1zW2ldOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW52aXJvbm1lbnQudXNlUGFydGlhbCkgewogICAgICAgICAgcmV0LnVzZVBhcnRpYWwgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRhdGEpIHsKICAgICAgICAgIHJldC51c2VEYXRhID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudXNlRGVwdGhzKSB7CiAgICAgICAgICByZXQudXNlRGVwdGhzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb21wYXQpIHsKICAgICAgICAgIHJldC5jb21wYXQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFhc09iamVjdCkgewogICAgICAgICAgcmV0LmNvbXBpbGVyID0gSlNPTi5zdHJpbmdpZnkocmV0LmNvbXBpbGVyKTsKICAgICAgICAgIHJldCA9IHRoaXMub2JqZWN0TGl0ZXJhbChyZXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZm47CiAgICAgIH0KICAgIH0sCgogICAgcHJlYW1ibGU6IGZ1bmN0aW9uKCkgewogICAgICAvLyB0cmFjayB0aGUgbGFzdCBjb250ZXh0IHB1c2hlZCBpbnRvIHBsYWNlIHRvIGFsbG93IHNraXBwaW5nIHRoZQogICAgICAvLyBnZXRDb250ZXh0IG9wY29kZSB3aGVuIGl0IHdvdWxkIGJlIGEgbm9vcAogICAgICB0aGlzLmxhc3RDb250ZXh0ID0gMDsKICAgICAgdGhpcy5zb3VyY2UgPSBbXTsKICAgIH0sCgogICAgY3JlYXRlRnVuY3Rpb25Db250ZXh0OiBmdW5jdGlvbihhc09iamVjdCkgewogICAgICB2YXIgdmFyRGVjbGFyYXRpb25zID0gJyc7CgogICAgICB2YXIgbG9jYWxzID0gdGhpcy5zdGFja1ZhcnMuY29uY2F0KHRoaXMucmVnaXN0ZXJzLmxpc3QpOwogICAgICBpZihsb2NhbHMubGVuZ3RoID4gMCkgewogICAgICAgIHZhckRlY2xhcmF0aW9ucyArPSAiLCAiICsgbG9jYWxzLmpvaW4oIiwgIik7CiAgICAgIH0KCiAgICAgIC8vIEdlbmVyYXRlIG1pbmltaXplciBhbGlhcyBtYXBwaW5ncwogICAgICBmb3IgKHZhciBhbGlhcyBpbiB0aGlzLmFsaWFzZXMpIHsKICAgICAgICBpZiAodGhpcy5hbGlhc2VzLmhhc093blByb3BlcnR5KGFsaWFzKSkgewogICAgICAgICAgdmFyRGVjbGFyYXRpb25zICs9ICcsICcgKyBhbGlhcyArICc9JyArIHRoaXMuYWxpYXNlc1thbGlhc107CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgcGFyYW1zID0gWyJkZXB0aDAiLCAiaGVscGVycyIsICJwYXJ0aWFscyIsICJkYXRhIl07CgogICAgICBpZiAodGhpcy51c2VEZXB0aHMpIHsKICAgICAgICBwYXJhbXMucHVzaCgnZGVwdGhzJyk7CiAgICAgIH0KCiAgICAgIC8vIFBlcmZvcm0gYSBzZWNvbmQgcGFzcyBvdmVyIHRoZSBvdXRwdXQgdG8gbWVyZ2UgY29udGVudCB3aGVuIHBvc3NpYmxlCiAgICAgIHZhciBzb3VyY2UgPSB0aGlzLm1lcmdlU291cmNlKHZhckRlY2xhcmF0aW9ucyk7CgogICAgICBpZiAoYXNPYmplY3QpIHsKICAgICAgICBwYXJhbXMucHVzaChzb3VyY2UpOwoKICAgICAgICByZXR1cm4gRnVuY3Rpb24uYXBwbHkodGhpcywgcGFyYW1zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJ2Z1bmN0aW9uKCcgKyBwYXJhbXMuam9pbignLCcpICsgJykge1xuICAnICsgc291cmNlICsgJ30nOwogICAgICB9CiAgICB9LAogICAgbWVyZ2VTb3VyY2U6IGZ1bmN0aW9uKHZhckRlY2xhcmF0aW9ucykgewogICAgICB2YXIgc291cmNlID0gJycsCiAgICAgICAgICBidWZmZXIsCiAgICAgICAgICBhcHBlbmRPbmx5ID0gIXRoaXMuZm9yY2VCdWZmZXIsCiAgICAgICAgICBhcHBlbmRGaXJzdDsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLnNvdXJjZS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBsaW5lID0gdGhpcy5zb3VyY2VbaV07CiAgICAgICAgaWYgKGxpbmUuYXBwZW5kVG9CdWZmZXIpIHsKICAgICAgICAgIGlmIChidWZmZXIpIHsKICAgICAgICAgICAgYnVmZmVyID0gYnVmZmVyICsgJ1xuICAgICsgJyArIGxpbmUuY29udGVudDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1ZmZlciA9IGxpbmUuY29udGVudDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGJ1ZmZlcikgewogICAgICAgICAgICBpZiAoIXNvdXJjZSkgewogICAgICAgICAgICAgIGFwcGVuZEZpcnN0ID0gdHJ1ZTsKICAgICAgICAgICAgICBzb3VyY2UgPSBidWZmZXIgKyAnO1xuICAnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNvdXJjZSArPSAnYnVmZmVyICs9ICcgKyBidWZmZXIgKyAnO1xuICAnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1ZmZlciA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIHNvdXJjZSArPSBsaW5lICsgJ1xuICAnOwoKICAgICAgICAgIGlmICghdGhpcy5lbnZpcm9ubWVudC5pc1NpbXBsZSkgewogICAgICAgICAgICBhcHBlbmRPbmx5ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoYXBwZW5kT25seSkgewogICAgICAgIGlmIChidWZmZXIgfHwgIXNvdXJjZSkgewogICAgICAgICAgc291cmNlICs9ICdyZXR1cm4gJyArIChidWZmZXIgfHwgJyIiJykgKyAnO1xuJzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyRGVjbGFyYXRpb25zICs9ICIsIGJ1ZmZlciA9ICIgKyAoYXBwZW5kRmlyc3QgPyAnJyA6IHRoaXMuaW5pdGlhbGl6ZUJ1ZmZlcigpKTsKICAgICAgICBpZiAoYnVmZmVyKSB7CiAgICAgICAgICBzb3VyY2UgKz0gJ3JldHVybiBidWZmZXIgKyAnICsgYnVmZmVyICsgJztcbic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNvdXJjZSArPSAncmV0dXJuIGJ1ZmZlcjtcbic7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodmFyRGVjbGFyYXRpb25zKSB7CiAgICAgICAgc291cmNlID0gJ3ZhciAnICsgdmFyRGVjbGFyYXRpb25zLnN1YnN0cmluZygyKSArIChhcHBlbmRGaXJzdCA/ICcnIDogJztcbiAgJykgKyBzb3VyY2U7CiAgICAgIH0KCiAgICAgIHJldHVybiBzb3VyY2U7CiAgICB9LAoKICAgIC8vIFtibG9ja1ZhbHVlXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dyYW0sIHZhbHVlCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJldHVybiB2YWx1ZSBvZiBibG9ja0hlbHBlck1pc3NpbmcKICAgIC8vCiAgICAvLyBUaGUgcHVycG9zZSBvZiB0aGlzIG9wY29kZSBpcyB0byB0YWtlIGEgYmxvY2sgb2YgdGhlIGZvcm0KICAgIC8vIGB7eyN0aGlzLmZvb319Li4ue3svdGhpcy5mb299fWAsIHJlc29sdmUgdGhlIHZhbHVlIG9mIGBmb29gLCBhbmQKICAgIC8vIHJlcGxhY2UgaXQgb24gdGhlIHN0YWNrIHdpdGggdGhlIHJlc3VsdCBvZiBwcm9wZXJseQogICAgLy8gaW52b2tpbmcgYmxvY2tIZWxwZXJNaXNzaW5nLgogICAgYmxvY2tWYWx1ZTogZnVuY3Rpb24obmFtZSkgewogICAgICB0aGlzLmFsaWFzZXMuYmxvY2tIZWxwZXJNaXNzaW5nID0gJ2hlbHBlcnMuYmxvY2tIZWxwZXJNaXNzaW5nJzsKCiAgICAgIHZhciBwYXJhbXMgPSBbdGhpcy5jb250ZXh0TmFtZSgwKV07CiAgICAgIHRoaXMuc2V0dXBQYXJhbXMobmFtZSwgMCwgcGFyYW1zKTsKCiAgICAgIHZhciBibG9ja05hbWUgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIHBhcmFtcy5zcGxpY2UoMSwgMCwgYmxvY2tOYW1lKTsKCiAgICAgIHRoaXMucHVzaCgnYmxvY2tIZWxwZXJNaXNzaW5nLmNhbGwoJyArIHBhcmFtcy5qb2luKCcsICcpICsgJyknKTsKICAgIH0sCgogICAgLy8gW2FtYmlndW91c0Jsb2NrVmFsdWVdCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogaGFzaCwgaW52ZXJzZSwgcHJvZ3JhbSwgdmFsdWUKICAgIC8vIENvbXBpbGVyIHZhbHVlLCBiZWZvcmU6IGxhc3RIZWxwZXI9dmFsdWUgb2YgbGFzdCBmb3VuZCBoZWxwZXIsIGlmIGFueQogICAgLy8gT24gc3RhY2ssIGFmdGVyLCBpZiBubyBsYXN0SGVscGVyOiBzYW1lIGFzIFtibG9ja1ZhbHVlXQogICAgLy8gT24gc3RhY2ssIGFmdGVyLCBpZiBsYXN0SGVscGVyOiB2YWx1ZQogICAgYW1iaWd1b3VzQmxvY2tWYWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuYWxpYXNlcy5ibG9ja0hlbHBlck1pc3NpbmcgPSAnaGVscGVycy5ibG9ja0hlbHBlck1pc3NpbmcnOwoKICAgICAgLy8gV2UncmUgYmVpbmcgYSBiaXQgY2hlZWt5IGFuZCByZXVzaW5nIHRoZSBvcHRpb25zIHZhbHVlIGZyb20gdGhlIHByaW9yIGV4ZWMKICAgICAgdmFyIHBhcmFtcyA9IFt0aGlzLmNvbnRleHROYW1lKDApXTsKICAgICAgdGhpcy5zZXR1cFBhcmFtcygnJywgMCwgcGFyYW1zLCB0cnVlKTsKCiAgICAgIHRoaXMuZmx1c2hJbmxpbmUoKTsKCiAgICAgIHZhciBjdXJyZW50ID0gdGhpcy50b3BTdGFjaygpOwogICAgICBwYXJhbXMuc3BsaWNlKDEsIDAsIGN1cnJlbnQpOwoKICAgICAgdGhpcy5wdXNoU291cmNlKCJpZiAoISIgKyB0aGlzLmxhc3RIZWxwZXIgKyAiKSB7ICIgKyBjdXJyZW50ICsgIiA9IGJsb2NrSGVscGVyTWlzc2luZy5jYWxsKCIgKyBwYXJhbXMuam9pbigiLCAiKSArICIpOyB9Iik7CiAgICB9LAoKICAgIC8vIFthcHBlbmRDb250ZW50XQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4KICAgIC8vCiAgICAvLyBBcHBlbmRzIHRoZSBzdHJpbmcgdmFsdWUgb2YgYGNvbnRlbnRgIHRvIHRoZSBjdXJyZW50IGJ1ZmZlcgogICAgYXBwZW5kQ29udGVudDogZnVuY3Rpb24oY29udGVudCkgewogICAgICBpZiAodGhpcy5wZW5kaW5nQ29udGVudCkgewogICAgICAgIGNvbnRlbnQgPSB0aGlzLnBlbmRpbmdDb250ZW50ICsgY29udGVudDsKICAgICAgfQoKICAgICAgdGhpcy5wZW5kaW5nQ29udGVudCA9IGNvbnRlbnQ7CiAgICB9LAoKICAgIC8vIFthcHBlbmRdCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogdmFsdWUsIC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4KICAgIC8vCiAgICAvLyBDb2VyY2VzIGB2YWx1ZWAgdG8gYSBTdHJpbmcgYW5kIGFwcGVuZHMgaXQgdG8gdGhlIGN1cnJlbnQgYnVmZmVyLgogICAgLy8KICAgIC8vIElmIGB2YWx1ZWAgaXMgdHJ1dGh5LCBvciAwLCBpdCBpcyBjb2VyY2VkIGludG8gYSBzdHJpbmcgYW5kIGFwcGVuZGVkCiAgICAvLyBPdGhlcndpc2UsIHRoZSBlbXB0eSBzdHJpbmcgaXMgYXBwZW5kZWQKICAgIGFwcGVuZDogZnVuY3Rpb24oKSB7CiAgICAgIC8vIEZvcmNlIGFueXRoaW5nIHRoYXQgaXMgaW5saW5lZCBvbnRvIHRoZSBzdGFjayBzbyB3ZSBkb24ndCBoYXZlIGR1cGxpY2F0aW9uCiAgICAgIC8vIHdoZW4gd2UgZXhhbWluZSBsb2NhbAogICAgICB0aGlzLmZsdXNoSW5saW5lKCk7CiAgICAgIHZhciBsb2NhbCA9IHRoaXMucG9wU3RhY2soKTsKICAgICAgdGhpcy5wdXNoU291cmNlKCdpZiAoJyArIGxvY2FsICsgJyAhPSBudWxsKSB7ICcgKyB0aGlzLmFwcGVuZFRvQnVmZmVyKGxvY2FsKSArICcgfScpOwogICAgICBpZiAodGhpcy5lbnZpcm9ubWVudC5pc1NpbXBsZSkgewogICAgICAgIHRoaXMucHVzaFNvdXJjZSgiZWxzZSB7ICIgKyB0aGlzLmFwcGVuZFRvQnVmZmVyKCInJyIpICsgIiB9Iik7CiAgICAgIH0KICAgIH0sCgogICAgLy8gW2FwcGVuZEVzY2FwZWRdCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogdmFsdWUsIC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiAuLi4KICAgIC8vCiAgICAvLyBFc2NhcGUgYHZhbHVlYCBhbmQgYXBwZW5kIGl0IHRvIHRoZSBidWZmZXIKICAgIGFwcGVuZEVzY2FwZWQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmFsaWFzZXMuZXNjYXBlRXhwcmVzc2lvbiA9ICd0aGlzLmVzY2FwZUV4cHJlc3Npb24nOwoKICAgICAgdGhpcy5wdXNoU291cmNlKHRoaXMuYXBwZW5kVG9CdWZmZXIoImVzY2FwZUV4cHJlc3Npb24oIiArIHRoaXMucG9wU3RhY2soKSArICIpIikpOwogICAgfSwKCiAgICAvLyBbZ2V0Q29udGV4dF0KICAgIC8vCiAgICAvLyBPbiBzdGFjaywgYmVmb3JlOiAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogLi4uCiAgICAvLyBDb21waWxlciB2YWx1ZSwgYWZ0ZXI6IGxhc3RDb250ZXh0PWRlcHRoCiAgICAvLwogICAgLy8gU2V0IHRoZSB2YWx1ZSBvZiB0aGUgYGxhc3RDb250ZXh0YCBjb21waWxlciB2YWx1ZSB0byB0aGUgZGVwdGgKICAgIGdldENvbnRleHQ6IGZ1bmN0aW9uKGRlcHRoKSB7CiAgICAgIHRoaXMubGFzdENvbnRleHQgPSBkZXB0aDsKICAgIH0sCgogICAgLy8gW3B1c2hDb250ZXh0XQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiBjdXJyZW50Q29udGV4dCwgLi4uCiAgICAvLwogICAgLy8gUHVzaGVzIHRoZSB2YWx1ZSBvZiB0aGUgY3VycmVudCBjb250ZXh0IG9udG8gdGhlIHN0YWNrLgogICAgcHVzaENvbnRleHQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwodGhpcy5jb250ZXh0TmFtZSh0aGlzLmxhc3RDb250ZXh0KSk7CiAgICB9LAoKICAgIC8vIFtsb29rdXBPbkNvbnRleHRdCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IGN1cnJlbnRDb250ZXh0W25hbWVdLCAuLi4KICAgIC8vCiAgICAvLyBMb29rcyB1cCB0aGUgdmFsdWUgb2YgYG5hbWVgIG9uIHRoZSBjdXJyZW50IGNvbnRleHQgYW5kIHB1c2hlcwogICAgLy8gaXQgb250byB0aGUgc3RhY2suCiAgICBsb29rdXBPbkNvbnRleHQ6IGZ1bmN0aW9uKHBhcnRzLCBmYWxzeSwgc2NvcGVkKSB7CiAgICAgIC8qanNoaW50IC1XMDgzICovCiAgICAgIHZhciBpID0gMCwKICAgICAgICAgIGxlbiA9IHBhcnRzLmxlbmd0aDsKCiAgICAgIGlmICghc2NvcGVkICYmIHRoaXMub3B0aW9ucy5jb21wYXQgJiYgIXRoaXMubGFzdENvbnRleHQpIHsKICAgICAgICAvLyBUaGUgZGVwdGhlZCBxdWVyeSBpcyBleHBlY3RlZCB0byBoYW5kbGUgdGhlIHVuZGVmaW5lZCBsb2dpYyBmb3IgdGhlIHJvb3QgbGV2ZWwgdGhhdAogICAgICAgIC8vIGlzIGltcGxlbWVudGVkIGJlbG93LCBzbyB3ZSBldmFsdWF0ZSB0aGF0IGRpcmVjdGx5IGluIGNvbXBhdCBtb2RlCiAgICAgICAgdGhpcy5wdXNoKHRoaXMuZGVwdGhlZExvb2t1cChwYXJ0c1tpKytdKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wdXNoQ29udGV4dCgpOwogICAgICB9CgogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdGhpcy5yZXBsYWNlU3RhY2soZnVuY3Rpb24oY3VycmVudCkgewogICAgICAgICAgdmFyIGxvb2t1cCA9IHRoaXMubmFtZUxvb2t1cChjdXJyZW50LCBwYXJ0c1tpXSwgJ2NvbnRleHQnKTsKICAgICAgICAgIC8vIFdlIHdhbnQgdG8gZW5zdXJlIHRoYXQgemVybyBhbmQgZmFsc2UgYXJlIGhhbmRsZWQgcHJvcGVybHkgaWYgdGhlIGNvbnRleHQgKGZhbHN5IGZsYWcpCiAgICAgICAgICAvLyBuZWVkcyB0byBoYXZlIHRoZSBzcGVjaWFsIGhhbmRsaW5nIGZvciB0aGVzZSB2YWx1ZXMuCiAgICAgICAgICBpZiAoIWZhbHN5KSB7CiAgICAgICAgICAgIHJldHVybiAnICE9IG51bGwgPyAnICsgbG9va3VwICsgJyA6ICcgKyBjdXJyZW50OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHdlIGNhbiB1c2UgZ2VuZXJpYyBmYWxzeSBoYW5kbGluZwogICAgICAgICAgICByZXR1cm4gJyAmJiAnICsgbG9va3VwOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIFtsb29rdXBEYXRhXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiBkYXRhLCAuLi4KICAgIC8vCiAgICAvLyBQdXNoIHRoZSBkYXRhIGxvb2t1cCBvcGVyYXRvcgogICAgbG9va3VwRGF0YTogZnVuY3Rpb24oZGVwdGgsIHBhcnRzKSB7CiAgICAgIC8qanNoaW50IC1XMDgzICovCiAgICAgIGlmICghZGVwdGgpIHsKICAgICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwoJ2RhdGEnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwoJ3RoaXMuZGF0YShkYXRhLCAnICsgZGVwdGggKyAnKScpOwogICAgICB9CgogICAgICB2YXIgbGVuID0gcGFydHMubGVuZ3RoOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdGhpcy5yZXBsYWNlU3RhY2soZnVuY3Rpb24oY3VycmVudCkgewogICAgICAgICAgcmV0dXJuICcgJiYgJyArIHRoaXMubmFtZUxvb2t1cChjdXJyZW50LCBwYXJ0c1tpXSwgJ2RhdGEnKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvLyBbcmVzb2x2ZVBvc3NpYmxlTGFtYmRhXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IHZhbHVlLCAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogcmVzb2x2ZWQgdmFsdWUsIC4uLgogICAgLy8KICAgIC8vIElmIHRoZSBgdmFsdWVgIGlzIGEgbGFtYmRhLCByZXBsYWNlIGl0IG9uIHRoZSBzdGFjayBieQogICAgLy8gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgbGFtYmRhCiAgICByZXNvbHZlUG9zc2libGVMYW1iZGE6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmFsaWFzZXMubGFtYmRhID0gJ3RoaXMubGFtYmRhJzsKCiAgICAgIHRoaXMucHVzaCgnbGFtYmRhKCcgKyB0aGlzLnBvcFN0YWNrKCkgKyAnLCAnICsgdGhpcy5jb250ZXh0TmFtZSgwKSArICcpJyk7CiAgICB9LAoKICAgIC8vIFtwdXNoU3RyaW5nUGFyYW1dCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHN0cmluZywgY3VycmVudENvbnRleHQsIC4uLgogICAgLy8KICAgIC8vIFRoaXMgb3Bjb2RlIGlzIGRlc2lnbmVkIGZvciB1c2UgaW4gc3RyaW5nIG1vZGUsIHdoaWNoCiAgICAvLyBwcm92aWRlcyB0aGUgc3RyaW5nIHZhbHVlIG9mIGEgcGFyYW1ldGVyIGFsb25nIHdpdGggaXRzCiAgICAvLyBkZXB0aCByYXRoZXIgdGhhbiByZXNvbHZpbmcgaXQgaW1tZWRpYXRlbHkuCiAgICBwdXNoU3RyaW5nUGFyYW06IGZ1bmN0aW9uKHN0cmluZywgdHlwZSkgewogICAgICB0aGlzLnB1c2hDb250ZXh0KCk7CiAgICAgIHRoaXMucHVzaFN0cmluZyh0eXBlKTsKCiAgICAgIC8vIElmIGl0J3MgYSBzdWJleHByZXNzaW9uLCB0aGUgc3RyaW5nIHJlc3VsdAogICAgICAvLyB3aWxsIGJlIHB1c2hlZCBhZnRlciB0aGlzIG9wY29kZS4KICAgICAgaWYgKHR5cGUgIT09ICdzZXhwcicpIHsKICAgICAgICBpZiAodHlwZW9mIHN0cmluZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHRoaXMucHVzaFN0cmluZyhzdHJpbmcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwoc3RyaW5nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgZW1wdHlIYXNoOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKCd7fScpOwoKICAgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKICAgICAgICB0aGlzLnB1c2goJ3t9Jyk7IC8vIGhhc2hJZHMKICAgICAgfQogICAgICBpZiAodGhpcy5zdHJpbmdQYXJhbXMpIHsKICAgICAgICB0aGlzLnB1c2goJ3t9Jyk7IC8vIGhhc2hDb250ZXh0cwogICAgICAgIHRoaXMucHVzaCgne30nKTsgLy8gaGFzaFR5cGVzCiAgICAgIH0KICAgIH0sCiAgICBwdXNoSGFzaDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmhhc2gpIHsKICAgICAgICB0aGlzLmhhc2hlcy5wdXNoKHRoaXMuaGFzaCk7CiAgICAgIH0KICAgICAgdGhpcy5oYXNoID0ge3ZhbHVlczogW10sIHR5cGVzOiBbXSwgY29udGV4dHM6IFtdLCBpZHM6IFtdfTsKICAgIH0sCiAgICBwb3BIYXNoOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGhhc2ggPSB0aGlzLmhhc2g7CiAgICAgIHRoaXMuaGFzaCA9IHRoaXMuaGFzaGVzLnBvcCgpOwoKICAgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKICAgICAgICB0aGlzLnB1c2goJ3snICsgaGFzaC5pZHMuam9pbignLCcpICsgJ30nKTsKICAgICAgfQogICAgICBpZiAodGhpcy5zdHJpbmdQYXJhbXMpIHsKICAgICAgICB0aGlzLnB1c2goJ3snICsgaGFzaC5jb250ZXh0cy5qb2luKCcsJykgKyAnfScpOwogICAgICAgIHRoaXMucHVzaCgneycgKyBoYXNoLnR5cGVzLmpvaW4oJywnKSArICd9Jyk7CiAgICAgIH0KCiAgICAgIHRoaXMucHVzaCgne1xuICAgICcgKyBoYXNoLnZhbHVlcy5qb2luKCcsXG4gICAgJykgKyAnXG4gIH0nKTsKICAgIH0sCgogICAgLy8gW3B1c2hTdHJpbmddCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHF1b3RlZFN0cmluZyhzdHJpbmcpLCAuLi4KICAgIC8vCiAgICAvLyBQdXNoIGEgcXVvdGVkIHZlcnNpb24gb2YgYHN0cmluZ2Agb250byB0aGUgc3RhY2sKICAgIHB1c2hTdHJpbmc6IGZ1bmN0aW9uKHN0cmluZykgewogICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwodGhpcy5xdW90ZWRTdHJpbmcoc3RyaW5nKSk7CiAgICB9LAoKICAgIC8vIFtwdXNoXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiBleHByLCAuLi4KICAgIC8vCiAgICAvLyBQdXNoIGFuIGV4cHJlc3Npb24gb250byB0aGUgc3RhY2sKICAgIHB1c2g6IGZ1bmN0aW9uKGV4cHIpIHsKICAgICAgdGhpcy5pbmxpbmVTdGFjay5wdXNoKGV4cHIpOwogICAgICByZXR1cm4gZXhwcjsKICAgIH0sCgogICAgLy8gW3B1c2hMaXRlcmFsXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiB2YWx1ZSwgLi4uCiAgICAvLwogICAgLy8gUHVzaGVzIGEgdmFsdWUgb250byB0aGUgc3RhY2suIFRoaXMgb3BlcmF0aW9uIHByZXZlbnRzCiAgICAvLyB0aGUgY29tcGlsZXIgZnJvbSBjcmVhdGluZyBhIHRlbXBvcmFyeSB2YXJpYWJsZSB0byBob2xkCiAgICAvLyBpdC4KICAgIHB1c2hMaXRlcmFsOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICB0aGlzLnB1c2hTdGFja0xpdGVyYWwodmFsdWUpOwogICAgfSwKCiAgICAvLyBbcHVzaFByb2dyYW1dCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHByb2dyYW0oZ3VpZCksIC4uLgogICAgLy8KICAgIC8vIFB1c2ggYSBwcm9ncmFtIGV4cHJlc3Npb24gb250byB0aGUgc3RhY2suIFRoaXMgdGFrZXMKICAgIC8vIGEgY29tcGlsZS10aW1lIGd1aWQgYW5kIGNvbnZlcnRzIGl0IGludG8gYSBydW50aW1lLWFjY2Vzc2libGUKICAgIC8vIGV4cHJlc3Npb24uCiAgICBwdXNoUHJvZ3JhbTogZnVuY3Rpb24oZ3VpZCkgewogICAgICBpZiAoZ3VpZCAhPSBudWxsKSB7CiAgICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKHRoaXMucHJvZ3JhbUV4cHJlc3Npb24oZ3VpZCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucHVzaFN0YWNrTGl0ZXJhbChudWxsKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBbaW52b2tlSGVscGVyXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGhhc2gsIGludmVyc2UsIHByb2dyYW0sIHBhcmFtcy4uLiwgLi4uCiAgICAvLyBPbiBzdGFjaywgYWZ0ZXI6IHJlc3VsdCBvZiBoZWxwZXIgaW52b2NhdGlvbgogICAgLy8KICAgIC8vIFBvcHMgb2ZmIHRoZSBoZWxwZXIncyBwYXJhbWV0ZXJzLCBpbnZva2VzIHRoZSBoZWxwZXIsCiAgICAvLyBhbmQgcHVzaGVzIHRoZSBoZWxwZXIncyByZXR1cm4gdmFsdWUgb250byB0aGUgc3RhY2suCiAgICAvLwogICAgLy8gSWYgdGhlIGhlbHBlciBpcyBub3QgZm91bmQsIGBoZWxwZXJNaXNzaW5nYCBpcyBjYWxsZWQuCiAgICBpbnZva2VIZWxwZXI6IGZ1bmN0aW9uKHBhcmFtU2l6ZSwgbmFtZSwgaXNTaW1wbGUpIHsKICAgICAgdGhpcy5hbGlhc2VzLmhlbHBlck1pc3NpbmcgPSAnaGVscGVycy5oZWxwZXJNaXNzaW5nJzsKCiAgICAgIHZhciBub25IZWxwZXIgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIHZhciBoZWxwZXIgPSB0aGlzLnNldHVwSGVscGVyKHBhcmFtU2l6ZSwgbmFtZSk7CgogICAgICB2YXIgbG9va3VwID0gKGlzU2ltcGxlID8gaGVscGVyLm5hbWUgKyAnIHx8ICcgOiAnJykgKyBub25IZWxwZXIgKyAnIHx8IGhlbHBlck1pc3NpbmcnOwogICAgICB0aGlzLnB1c2goJygoJyArIGxvb2t1cCArICcpLmNhbGwoJyArIGhlbHBlci5jYWxsUGFyYW1zICsgJykpJyk7CiAgICB9LAoKICAgIC8vIFtpbnZva2VLbm93bkhlbHBlcl0KICAgIC8vCiAgICAvLyBPbiBzdGFjaywgYmVmb3JlOiBoYXNoLCBpbnZlcnNlLCBwcm9ncmFtLCBwYXJhbXMuLi4sIC4uLgogICAgLy8gT24gc3RhY2ssIGFmdGVyOiByZXN1bHQgb2YgaGVscGVyIGludm9jYXRpb24KICAgIC8vCiAgICAvLyBUaGlzIG9wZXJhdGlvbiBpcyB1c2VkIHdoZW4gdGhlIGhlbHBlciBpcyBrbm93biB0byBleGlzdCwKICAgIC8vIHNvIGEgYGhlbHBlck1pc3NpbmdgIGZhbGxiYWNrIGlzIG5vdCByZXF1aXJlZC4KICAgIGludm9rZUtub3duSGVscGVyOiBmdW5jdGlvbihwYXJhbVNpemUsIG5hbWUpIHsKICAgICAgdmFyIGhlbHBlciA9IHRoaXMuc2V0dXBIZWxwZXIocGFyYW1TaXplLCBuYW1lKTsKICAgICAgdGhpcy5wdXNoKGhlbHBlci5uYW1lICsgIi5jYWxsKCIgKyBoZWxwZXIuY2FsbFBhcmFtcyArICIpIik7CiAgICB9LAoKICAgIC8vIFtpbnZva2VBbWJpZ3VvdXNdCiAgICAvLwogICAgLy8gT24gc3RhY2ssIGJlZm9yZTogaGFzaCwgaW52ZXJzZSwgcHJvZ3JhbSwgcGFyYW1zLi4uLCAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogcmVzdWx0IG9mIGRpc2FtYmlndWF0aW9uCiAgICAvLwogICAgLy8gVGhpcyBvcGVyYXRpb24gaXMgdXNlZCB3aGVuIGFuIGV4cHJlc3Npb24gbGlrZSBge3tmb299fWAKICAgIC8vIGlzIHByb3ZpZGVkLCBidXQgd2UgZG9uJ3Qga25vdyBhdCBjb21waWxlLXRpbWUgd2hldGhlciBpdAogICAgLy8gaXMgYSBoZWxwZXIgb3IgYSBwYXRoLgogICAgLy8KICAgIC8vIFRoaXMgb3BlcmF0aW9uIGVtaXRzIG1vcmUgY29kZSB0aGFuIHRoZSBvdGhlciBvcHRpb25zLAogICAgLy8gYW5kIGNhbiBiZSBhdm9pZGVkIGJ5IHBhc3NpbmcgdGhlIGBrbm93bkhlbHBlcnNgIGFuZAogICAgLy8gYGtub3duSGVscGVyc09ubHlgIGZsYWdzIGF0IGNvbXBpbGUtdGltZS4KICAgIGludm9rZUFtYmlndW91czogZnVuY3Rpb24obmFtZSwgaGVscGVyQ2FsbCkgewogICAgICB0aGlzLmFsaWFzZXMuZnVuY3Rpb25UeXBlID0gJyJmdW5jdGlvbiInOwogICAgICB0aGlzLmFsaWFzZXMuaGVscGVyTWlzc2luZyA9ICdoZWxwZXJzLmhlbHBlck1pc3NpbmcnOwogICAgICB0aGlzLnVzZVJlZ2lzdGVyKCdoZWxwZXInKTsKCiAgICAgIHZhciBub25IZWxwZXIgPSB0aGlzLnBvcFN0YWNrKCk7CgogICAgICB0aGlzLmVtcHR5SGFzaCgpOwogICAgICB2YXIgaGVscGVyID0gdGhpcy5zZXR1cEhlbHBlcigwLCBuYW1lLCBoZWxwZXJDYWxsKTsKCiAgICAgIHZhciBoZWxwZXJOYW1lID0gdGhpcy5sYXN0SGVscGVyID0gdGhpcy5uYW1lTG9va3VwKCdoZWxwZXJzJywgbmFtZSwgJ2hlbHBlcicpOwoKICAgICAgdGhpcy5wdXNoKAogICAgICAgICcoKGhlbHBlciA9IChoZWxwZXIgPSAnICsgaGVscGVyTmFtZSArICcgfHwgJyArIG5vbkhlbHBlciArICcpICE9IG51bGwgPyBoZWxwZXIgOiBoZWxwZXJNaXNzaW5nJwogICAgICAgICAgKyAoaGVscGVyLnBhcmFtc0luaXQgPyAnKSwoJyArIGhlbHBlci5wYXJhbXNJbml0IDogJycpICsgJyksJwogICAgICAgICsgJyh0eXBlb2YgaGVscGVyID09PSBmdW5jdGlvblR5cGUgPyBoZWxwZXIuY2FsbCgnICsgaGVscGVyLmNhbGxQYXJhbXMgKyAnKSA6IGhlbHBlcikpJyk7CiAgICB9LAoKICAgIC8vIFtpbnZva2VQYXJ0aWFsXQogICAgLy8KICAgIC8vIE9uIHN0YWNrLCBiZWZvcmU6IGNvbnRleHQsIC4uLgogICAgLy8gT24gc3RhY2sgYWZ0ZXI6IHJlc3VsdCBvZiBwYXJ0aWFsIGludm9jYXRpb24KICAgIC8vCiAgICAvLyBUaGlzIG9wZXJhdGlvbiBwb3BzIG9mZiBhIGNvbnRleHQsIGludm9rZXMgYSBwYXJ0aWFsIHdpdGggdGhhdCBjb250ZXh0LAogICAgLy8gYW5kIHB1c2hlcyB0aGUgcmVzdWx0IG9mIHRoZSBpbnZvY2F0aW9uIGJhY2suCiAgICBpbnZva2VQYXJ0aWFsOiBmdW5jdGlvbihuYW1lLCBpbmRlbnQpIHsKICAgICAgdmFyIHBhcmFtcyA9IFt0aGlzLm5hbWVMb29rdXAoJ3BhcnRpYWxzJywgbmFtZSwgJ3BhcnRpYWwnKSwgIiciICsgaW5kZW50ICsgIiciLCAiJyIgKyBuYW1lICsgIiciLCB0aGlzLnBvcFN0YWNrKCksIHRoaXMucG9wU3RhY2soKSwgImhlbHBlcnMiLCAicGFydGlhbHMiXTsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGF0YSkgewogICAgICAgIHBhcmFtcy5wdXNoKCJkYXRhIik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmNvbXBhdCkgewogICAgICAgIHBhcmFtcy5wdXNoKCd1bmRlZmluZWQnKTsKICAgICAgfQogICAgICBpZiAodGhpcy5vcHRpb25zLmNvbXBhdCkgewogICAgICAgIHBhcmFtcy5wdXNoKCdkZXB0aHMnKTsKICAgICAgfQoKICAgICAgdGhpcy5wdXNoKCJ0aGlzLmludm9rZVBhcnRpYWwoIiArIHBhcmFtcy5qb2luKCIsICIpICsgIikiKTsKICAgIH0sCgogICAgLy8gW2Fzc2lnblRvSGFzaF0KICAgIC8vCiAgICAvLyBPbiBzdGFjaywgYmVmb3JlOiB2YWx1ZSwgLi4uLCBoYXNoLCAuLi4KICAgIC8vIE9uIHN0YWNrLCBhZnRlcjogLi4uLCBoYXNoLCAuLi4KICAgIC8vCiAgICAvLyBQb3BzIGEgdmFsdWUgb2ZmIHRoZSBzdGFjayBhbmQgYXNzaWducyBpdCB0byB0aGUgY3VycmVudCBoYXNoCiAgICBhc3NpZ25Ub0hhc2g6IGZ1bmN0aW9uKGtleSkgewogICAgICB2YXIgdmFsdWUgPSB0aGlzLnBvcFN0YWNrKCksCiAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgdHlwZSwKICAgICAgICAgIGlkOwoKICAgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKICAgICAgICBpZCA9IHRoaXMucG9wU3RhY2soKTsKICAgICAgfQogICAgICBpZiAodGhpcy5zdHJpbmdQYXJhbXMpIHsKICAgICAgICB0eXBlID0gdGhpcy5wb3BTdGFjaygpOwogICAgICAgIGNvbnRleHQgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIH0KCiAgICAgIHZhciBoYXNoID0gdGhpcy5oYXNoOwogICAgICBpZiAoY29udGV4dCkgewogICAgICAgIGhhc2guY29udGV4dHMucHVzaCgiJyIgKyBrZXkgKyAiJzogIiArIGNvbnRleHQpOwogICAgICB9CiAgICAgIGlmICh0eXBlKSB7CiAgICAgICAgaGFzaC50eXBlcy5wdXNoKCInIiArIGtleSArICInOiAiICsgdHlwZSk7CiAgICAgIH0KICAgICAgaWYgKGlkKSB7CiAgICAgICAgaGFzaC5pZHMucHVzaCgiJyIgKyBrZXkgKyAiJzogIiArIGlkKTsKICAgICAgfQogICAgICBoYXNoLnZhbHVlcy5wdXNoKCInIiArIGtleSArICInOiAoIiArIHZhbHVlICsgIikiKTsKICAgIH0sCgogICAgcHVzaElkOiBmdW5jdGlvbih0eXBlLCBuYW1lKSB7CiAgICAgIGlmICh0eXBlID09PSAnSUQnIHx8IHR5cGUgPT09ICdEQVRBJykgewogICAgICAgIHRoaXMucHVzaFN0cmluZyhuYW1lKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2V4cHInKSB7CiAgICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKCd0cnVlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wdXNoU3RhY2tMaXRlcmFsKCdudWxsJyk7CiAgICAgIH0KICAgIH0sCgogICAgLy8gSEVMUEVSUwoKICAgIGNvbXBpbGVyOiBKYXZhU2NyaXB0Q29tcGlsZXIsCgogICAgY29tcGlsZUNoaWxkcmVuOiBmdW5jdGlvbihlbnZpcm9ubWVudCwgb3B0aW9ucykgewogICAgICB2YXIgY2hpbGRyZW4gPSBlbnZpcm9ubWVudC5jaGlsZHJlbiwgY2hpbGQsIGNvbXBpbGVyOwoKICAgICAgZm9yKHZhciBpPTAsIGw9Y2hpbGRyZW4ubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICAgIGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgICAgY29tcGlsZXIgPSBuZXcgdGhpcy5jb21waWxlcigpOwoKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLm1hdGNoRXhpc3RpbmdQcm9ncmFtKGNoaWxkKTsKCiAgICAgICAgaWYgKGluZGV4ID09IG51bGwpIHsKICAgICAgICAgIHRoaXMuY29udGV4dC5wcm9ncmFtcy5wdXNoKCcnKTsgICAgIC8vIFBsYWNlaG9sZGVyIHRvIHByZXZlbnQgbmFtZSBjb25mbGljdHMgZm9yIG5lc3RlZCBjaGlsZHJlbgogICAgICAgICAgaW5kZXggPSB0aGlzLmNvbnRleHQucHJvZ3JhbXMubGVuZ3RoOwogICAgICAgICAgY2hpbGQuaW5kZXggPSBpbmRleDsKICAgICAgICAgIGNoaWxkLm5hbWUgPSAncHJvZ3JhbScgKyBpbmRleDsKICAgICAgICAgIHRoaXMuY29udGV4dC5wcm9ncmFtc1tpbmRleF0gPSBjb21waWxlci5jb21waWxlKGNoaWxkLCBvcHRpb25zLCB0aGlzLmNvbnRleHQsICF0aGlzLnByZWNvbXBpbGUpOwogICAgICAgICAgdGhpcy5jb250ZXh0LmVudmlyb25tZW50c1tpbmRleF0gPSBjaGlsZDsKCiAgICAgICAgICB0aGlzLnVzZURlcHRocyA9IHRoaXMudXNlRGVwdGhzIHx8IGNvbXBpbGVyLnVzZURlcHRoczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2hpbGQuaW5kZXggPSBpbmRleDsKICAgICAgICAgIGNoaWxkLm5hbWUgPSAncHJvZ3JhbScgKyBpbmRleDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBtYXRjaEV4aXN0aW5nUHJvZ3JhbTogZnVuY3Rpb24oY2hpbGQpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuY29udGV4dC5lbnZpcm9ubWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgZW52aXJvbm1lbnQgPSB0aGlzLmNvbnRleHQuZW52aXJvbm1lbnRzW2ldOwogICAgICAgIGlmIChlbnZpcm9ubWVudCAmJiBlbnZpcm9ubWVudC5lcXVhbHMoY2hpbGQpKSB7CiAgICAgICAgICByZXR1cm4gaTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgcHJvZ3JhbUV4cHJlc3Npb246IGZ1bmN0aW9uKGd1aWQpIHsKICAgICAgdmFyIGNoaWxkID0gdGhpcy5lbnZpcm9ubWVudC5jaGlsZHJlbltndWlkXSwKICAgICAgICAgIGRlcHRocyA9IGNoaWxkLmRlcHRocy5saXN0LAogICAgICAgICAgdXNlRGVwdGhzID0gdGhpcy51c2VEZXB0aHMsCiAgICAgICAgICBkZXB0aDsKCiAgICAgIHZhciBwcm9ncmFtUGFyYW1zID0gW2NoaWxkLmluZGV4LCAnZGF0YSddOwoKICAgICAgaWYgKHVzZURlcHRocykgewogICAgICAgIHByb2dyYW1QYXJhbXMucHVzaCgnZGVwdGhzJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiAndGhpcy5wcm9ncmFtKCcgKyBwcm9ncmFtUGFyYW1zLmpvaW4oJywgJykgKyAnKSc7CiAgICB9LAoKICAgIHVzZVJlZ2lzdGVyOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGlmKCF0aGlzLnJlZ2lzdGVyc1tuYW1lXSkgewogICAgICAgIHRoaXMucmVnaXN0ZXJzW25hbWVdID0gdHJ1ZTsKICAgICAgICB0aGlzLnJlZ2lzdGVycy5saXN0LnB1c2gobmFtZSk7CiAgICAgIH0KICAgIH0sCgogICAgcHVzaFN0YWNrTGl0ZXJhbDogZnVuY3Rpb24oaXRlbSkgewogICAgICByZXR1cm4gdGhpcy5wdXNoKG5ldyBMaXRlcmFsKGl0ZW0pKTsKICAgIH0sCgogICAgcHVzaFNvdXJjZTogZnVuY3Rpb24oc291cmNlKSB7CiAgICAgIGlmICh0aGlzLnBlbmRpbmdDb250ZW50KSB7CiAgICAgICAgdGhpcy5zb3VyY2UucHVzaCh0aGlzLmFwcGVuZFRvQnVmZmVyKHRoaXMucXVvdGVkU3RyaW5nKHRoaXMucGVuZGluZ0NvbnRlbnQpKSk7CiAgICAgICAgdGhpcy5wZW5kaW5nQ29udGVudCA9IHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgIHRoaXMuc291cmNlLnB1c2goc291cmNlKTsKICAgICAgfQogICAgfSwKCiAgICBwdXNoU3RhY2s6IGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5mbHVzaElubGluZSgpOwoKICAgICAgdmFyIHN0YWNrID0gdGhpcy5pbmNyU3RhY2soKTsKICAgICAgdGhpcy5wdXNoU291cmNlKHN0YWNrICsgIiA9ICIgKyBpdGVtICsgIjsiKTsKICAgICAgdGhpcy5jb21waWxlU3RhY2sucHVzaChzdGFjayk7CiAgICAgIHJldHVybiBzdGFjazsKICAgIH0sCgogICAgcmVwbGFjZVN0YWNrOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICB2YXIgcHJlZml4ID0gJycsCiAgICAgICAgICBpbmxpbmUgPSB0aGlzLmlzSW5saW5lKCksCiAgICAgICAgICBzdGFjaywKICAgICAgICAgIGNyZWF0ZWRTdGFjaywKICAgICAgICAgIHVzZWRMaXRlcmFsOwoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgaWYgKCF0aGlzLmlzSW5saW5lKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdyZXBsYWNlU3RhY2sgb24gbm9uLWlubGluZScpOwogICAgICB9CgogICAgICAvLyBXZSB3YW50IHRvIG1lcmdlIHRoZSBpbmxpbmUgc3RhdGVtZW50IGludG8gdGhlIHJlcGxhY2VtZW50IHN0YXRlbWVudCB2aWEgJywnCiAgICAgIHZhciB0b3AgPSB0aGlzLnBvcFN0YWNrKHRydWUpOwoKICAgICAgaWYgKHRvcCBpbnN0YW5jZW9mIExpdGVyYWwpIHsKICAgICAgICAvLyBMaXRlcmFscyBkbyBub3QgbmVlZCB0byBiZSBpbmxpbmVkCiAgICAgICAgcHJlZml4ID0gc3RhY2sgPSB0b3AudmFsdWU7CiAgICAgICAgdXNlZExpdGVyYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEdldCBvciBjcmVhdGUgdGhlIGN1cnJlbnQgc3RhY2sgbmFtZSBmb3IgdXNlIGJ5IHRoZSBpbmxpbmUKICAgICAgICBjcmVhdGVkU3RhY2sgPSAhdGhpcy5zdGFja1Nsb3Q7CiAgICAgICAgdmFyIG5hbWUgPSAhY3JlYXRlZFN0YWNrID8gdGhpcy50b3BTdGFja05hbWUoKSA6IHRoaXMuaW5jclN0YWNrKCk7CgogICAgICAgIHByZWZpeCA9ICcoJyArIHRoaXMucHVzaChuYW1lKSArICcgPSAnICsgdG9wICsgJyknOwogICAgICAgIHN0YWNrID0gdGhpcy50b3BTdGFjaygpOwogICAgICB9CgogICAgICB2YXIgaXRlbSA9IGNhbGxiYWNrLmNhbGwodGhpcywgc3RhY2spOwoKICAgICAgaWYgKCF1c2VkTGl0ZXJhbCkgewogICAgICAgIHRoaXMucG9wU3RhY2soKTsKICAgICAgfQogICAgICBpZiAoY3JlYXRlZFN0YWNrKSB7CiAgICAgICAgdGhpcy5zdGFja1Nsb3QtLTsKICAgICAgfQogICAgICB0aGlzLnB1c2goJygnICsgcHJlZml4ICsgaXRlbSArICcpJyk7CiAgICB9LAoKICAgIGluY3JTdGFjazogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuc3RhY2tTbG90Kys7CiAgICAgIGlmKHRoaXMuc3RhY2tTbG90ID4gdGhpcy5zdGFja1ZhcnMubGVuZ3RoKSB7IHRoaXMuc3RhY2tWYXJzLnB1c2goInN0YWNrIiArIHRoaXMuc3RhY2tTbG90KTsgfQogICAgICByZXR1cm4gdGhpcy50b3BTdGFja05hbWUoKTsKICAgIH0sCiAgICB0b3BTdGFja05hbWU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gInN0YWNrIiArIHRoaXMuc3RhY2tTbG90OwogICAgfSwKICAgIGZsdXNoSW5saW5lOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGlubGluZVN0YWNrID0gdGhpcy5pbmxpbmVTdGFjazsKICAgICAgaWYgKGlubGluZVN0YWNrLmxlbmd0aCkgewogICAgICAgIHRoaXMuaW5saW5lU3RhY2sgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaW5saW5lU3RhY2subGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBlbnRyeSA9IGlubGluZVN0YWNrW2ldOwogICAgICAgICAgaWYgKGVudHJ5IGluc3RhbmNlb2YgTGl0ZXJhbCkgewogICAgICAgICAgICB0aGlzLmNvbXBpbGVTdGFjay5wdXNoKGVudHJ5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucHVzaFN0YWNrKGVudHJ5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpc0lubGluZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmlubGluZVN0YWNrLmxlbmd0aDsKICAgIH0sCgogICAgcG9wU3RhY2s6IGZ1bmN0aW9uKHdyYXBwZWQpIHsKICAgICAgdmFyIGlubGluZSA9IHRoaXMuaXNJbmxpbmUoKSwKICAgICAgICAgIGl0ZW0gPSAoaW5saW5lID8gdGhpcy5pbmxpbmVTdGFjayA6IHRoaXMuY29tcGlsZVN0YWNrKS5wb3AoKTsKCiAgICAgIGlmICghd3JhcHBlZCAmJiAoaXRlbSBpbnN0YW5jZW9mIExpdGVyYWwpKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCFpbmxpbmUpIHsKICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgICBpZiAoIXRoaXMuc3RhY2tTbG90KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0ludmFsaWQgc3RhY2sgcG9wJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnN0YWNrU2xvdC0tOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgfQogICAgfSwKCiAgICB0b3BTdGFjazogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzdGFjayA9ICh0aGlzLmlzSW5saW5lKCkgPyB0aGlzLmlubGluZVN0YWNrIDogdGhpcy5jb21waWxlU3RhY2spLAogICAgICAgICAgaXRlbSA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwoKICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBMaXRlcmFsKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgIH0KICAgIH0sCgogICAgY29udGV4dE5hbWU6IGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgaWYgKHRoaXMudXNlRGVwdGhzICYmIGNvbnRleHQpIHsKICAgICAgICByZXR1cm4gJ2RlcHRoc1snICsgY29udGV4dCArICddJzsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJ2RlcHRoJyArIGNvbnRleHQ7CiAgICAgIH0KICAgIH0sCgogICAgcXVvdGVkU3RyaW5nOiBmdW5jdGlvbihzdHIpIHsKICAgICAgcmV0dXJuICciJyArIHN0cgogICAgICAgIC5yZXBsYWNlKC9cXC9nLCAnXFxcXCcpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJ1xcIicpCiAgICAgICAgLnJlcGxhY2UoL1xuL2csICdcXG4nKQogICAgICAgIC5yZXBsYWNlKC9cci9nLCAnXFxyJykKICAgICAgICAucmVwbGFjZSgvXHUyMDI4L2csICdcXHUyMDI4JykgICAvLyBQZXIgRWNtYS0yNjIgNy4zICsgNy44LjQKICAgICAgICAucmVwbGFjZSgvXHUyMDI5L2csICdcXHUyMDI5JykgKyAnIic7CiAgICB9LAoKICAgIG9iamVjdExpdGVyYWw6IGZ1bmN0aW9uKG9iaikgewogICAgICB2YXIgcGFpcnMgPSBbXTsKCiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgIHBhaXJzLnB1c2godGhpcy5xdW90ZWRTdHJpbmcoa2V5KSArICc6JyArIG9ialtrZXldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAneycgKyBwYWlycy5qb2luKCcsJykgKyAnfSc7CiAgICB9LAoKICAgIHNldHVwSGVscGVyOiBmdW5jdGlvbihwYXJhbVNpemUsIG5hbWUsIGJsb2NrSGVscGVyKSB7CiAgICAgIHZhciBwYXJhbXMgPSBbXSwKICAgICAgICAgIHBhcmFtc0luaXQgPSB0aGlzLnNldHVwUGFyYW1zKG5hbWUsIHBhcmFtU2l6ZSwgcGFyYW1zLCBibG9ja0hlbHBlcik7CiAgICAgIHZhciBmb3VuZEhlbHBlciA9IHRoaXMubmFtZUxvb2t1cCgnaGVscGVycycsIG5hbWUsICdoZWxwZXInKTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgcGFyYW1zSW5pdDogcGFyYW1zSW5pdCwKICAgICAgICBuYW1lOiBmb3VuZEhlbHBlciwKICAgICAgICBjYWxsUGFyYW1zOiBbdGhpcy5jb250ZXh0TmFtZSgwKV0uY29uY2F0KHBhcmFtcykuam9pbigiLCAiKQogICAgICB9OwogICAgfSwKCiAgICBzZXR1cE9wdGlvbnM6IGZ1bmN0aW9uKGhlbHBlciwgcGFyYW1TaXplLCBwYXJhbXMpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB7fSwgY29udGV4dHMgPSBbXSwgdHlwZXMgPSBbXSwgaWRzID0gW10sIHBhcmFtLCBpbnZlcnNlLCBwcm9ncmFtOwoKICAgICAgb3B0aW9ucy5uYW1lID0gdGhpcy5xdW90ZWRTdHJpbmcoaGVscGVyKTsKICAgICAgb3B0aW9ucy5oYXNoID0gdGhpcy5wb3BTdGFjaygpOwoKICAgICAgaWYgKHRoaXMudHJhY2tJZHMpIHsKICAgICAgICBvcHRpb25zLmhhc2hJZHMgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc3RyaW5nUGFyYW1zKSB7CiAgICAgICAgb3B0aW9ucy5oYXNoVHlwZXMgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgICAgb3B0aW9ucy5oYXNoQ29udGV4dHMgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIH0KCiAgICAgIGludmVyc2UgPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgIHByb2dyYW0gPSB0aGlzLnBvcFN0YWNrKCk7CgogICAgICAvLyBBdm9pZCBzZXR0aW5nIGZuIGFuZCBpbnZlcnNlIGlmIG5laXRoZXIgYXJlIHNldC4gVGhpcyBhbGxvd3MKICAgICAgLy8gaGVscGVycyB0byBkbyBhIGNoZWNrIGZvciBgaWYgKG9wdGlvbnMuZm4pYAogICAgICBpZiAocHJvZ3JhbSB8fCBpbnZlcnNlKSB7CiAgICAgICAgaWYgKCFwcm9ncmFtKSB7CiAgICAgICAgICBwcm9ncmFtID0gJ3RoaXMubm9vcCc7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWludmVyc2UpIHsKICAgICAgICAgIGludmVyc2UgPSAndGhpcy5ub29wJzsKICAgICAgICB9CgogICAgICAgIG9wdGlvbnMuZm4gPSBwcm9ncmFtOwogICAgICAgIG9wdGlvbnMuaW52ZXJzZSA9IGludmVyc2U7CiAgICAgIH0KCiAgICAgIC8vIFRoZSBwYXJhbWV0ZXJzIGdvIG9uIHRvIHRoZSBzdGFjayBpbiBvcmRlciAobWFraW5nIHN1cmUgdGhhdCB0aGV5IGFyZSBldmFsdWF0ZWQgaW4gb3JkZXIpCiAgICAgIC8vIHNvIHdlIG5lZWQgdG8gcG9wIHRoZW0gb2ZmIHRoZSBzdGFjayBpbiByZXZlcnNlIG9yZGVyCiAgICAgIHZhciBpID0gcGFyYW1TaXplOwogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgcGFyYW0gPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgICAgcGFyYW1zW2ldID0gcGFyYW07CgogICAgICAgIGlmICh0aGlzLnRyYWNrSWRzKSB7CiAgICAgICAgICBpZHNbaV0gPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewogICAgICAgICAgdHlwZXNbaV0gPSB0aGlzLnBvcFN0YWNrKCk7CiAgICAgICAgICBjb250ZXh0c1tpXSA9IHRoaXMucG9wU3RhY2soKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnRyYWNrSWRzKSB7CiAgICAgICAgb3B0aW9ucy5pZHMgPSAiWyIgKyBpZHMuam9pbigiLCIpICsgIl0iOwogICAgICB9CiAgICAgIGlmICh0aGlzLnN0cmluZ1BhcmFtcykgewogICAgICAgIG9wdGlvbnMudHlwZXMgPSAiWyIgKyB0eXBlcy5qb2luKCIsIikgKyAiXSI7CiAgICAgICAgb3B0aW9ucy5jb250ZXh0cyA9ICJbIiArIGNvbnRleHRzLmpvaW4oIiwiKSArICJdIjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5kYXRhKSB7CiAgICAgICAgb3B0aW9ucy5kYXRhID0gImRhdGEiOwogICAgICB9CgogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0sCgogICAgLy8gdGhlIHBhcmFtcyBhbmQgY29udGV4dHMgYXJndW1lbnRzIGFyZSBwYXNzZWQgaW4gYXJyYXlzCiAgICAvLyB0byBmaWxsIGluCiAgICBzZXR1cFBhcmFtczogZnVuY3Rpb24oaGVscGVyTmFtZSwgcGFyYW1TaXplLCBwYXJhbXMsIHVzZVJlZ2lzdGVyKSB7CiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vYmplY3RMaXRlcmFsKHRoaXMuc2V0dXBPcHRpb25zKGhlbHBlck5hbWUsIHBhcmFtU2l6ZSwgcGFyYW1zKSk7CgogICAgICBpZiAodXNlUmVnaXN0ZXIpIHsKICAgICAgICB0aGlzLnVzZVJlZ2lzdGVyKCdvcHRpb25zJyk7CiAgICAgICAgcGFyYW1zLnB1c2goJ29wdGlvbnMnKTsKICAgICAgICByZXR1cm4gJ29wdGlvbnM9JyArIG9wdGlvbnM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGFyYW1zLnB1c2gob3B0aW9ucyk7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIHJlc2VydmVkV29yZHMgPSAoCiAgICAiYnJlYWsgZWxzZSBuZXcgdmFyIiArCiAgICAiIGNhc2UgZmluYWxseSByZXR1cm4gdm9pZCIgKwogICAgIiBjYXRjaCBmb3Igc3dpdGNoIHdoaWxlIiArCiAgICAiIGNvbnRpbnVlIGZ1bmN0aW9uIHRoaXMgd2l0aCIgKwogICAgIiBkZWZhdWx0IGlmIHRocm93IiArCiAgICAiIGRlbGV0ZSBpbiB0cnkiICsKICAgICIgZG8gaW5zdGFuY2VvZiB0eXBlb2YiICsKICAgICIgYWJzdHJhY3QgZW51bSBpbnQgc2hvcnQiICsKICAgICIgYm9vbGVhbiBleHBvcnQgaW50ZXJmYWNlIHN0YXRpYyIgKwogICAgIiBieXRlIGV4dGVuZHMgbG9uZyBzdXBlciIgKwogICAgIiBjaGFyIGZpbmFsIG5hdGl2ZSBzeW5jaHJvbml6ZWQiICsKICAgICIgY2xhc3MgZmxvYXQgcGFja2FnZSB0aHJvd3MiICsKICAgICIgY29uc3QgZ290byBwcml2YXRlIHRyYW5zaWVudCIgKwogICAgIiBkZWJ1Z2dlciBpbXBsZW1lbnRzIHByb3RlY3RlZCB2b2xhdGlsZSIgKwogICAgIiBkb3VibGUgaW1wb3J0IHB1YmxpYyBsZXQgeWllbGQiCiAgKS5zcGxpdCgiICIpOwoKICB2YXIgY29tcGlsZXJXb3JkcyA9IEphdmFTY3JpcHRDb21waWxlci5SRVNFUlZFRF9XT1JEUyA9IHt9OwoKICBmb3IodmFyIGk9MCwgbD1yZXNlcnZlZFdvcmRzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgIGNvbXBpbGVyV29yZHNbcmVzZXJ2ZWRXb3Jkc1tpXV0gPSB0cnVlOwogIH0KCiAgSmF2YVNjcmlwdENvbXBpbGVyLmlzVmFsaWRKYXZhU2NyaXB0VmFyaWFibGVOYW1lID0gZnVuY3Rpb24obmFtZSkgewogICAgcmV0dXJuICFKYXZhU2NyaXB0Q29tcGlsZXIuUkVTRVJWRURfV09SRFNbbmFtZV0gJiYgL15bYS16QS1aXyRdWzAtOWEtekEtWl8kXSokLy50ZXN0KG5hbWUpOwogIH07CgogIF9fZXhwb3J0c19fID0gSmF2YVNjcmlwdENvbXBpbGVyOwogIHJldHVybiBfX2V4cG9ydHNfXzsKfSkoX19tb2R1bGUyX18sIF9fbW9kdWxlNV9fKTsKCi8vIGhhbmRsZWJhcnMuanMKdmFyIF9fbW9kdWxlMF9fID0gKGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZGVwZW5kZW5jeTRfXywgX19kZXBlbmRlbmN5NV9fKSB7CiAgInVzZSBzdHJpY3QiOwogIHZhciBfX2V4cG9ydHNfXzsKICAvKmdsb2JhbHMgSGFuZGxlYmFyczogdHJ1ZSAqLwogIHZhciBIYW5kbGViYXJzID0gX19kZXBlbmRlbmN5MV9fOwoKICAvLyBDb21waWxlciBpbXBvcnRzCiAgdmFyIEFTVCA9IF9fZGVwZW5kZW5jeTJfXzsKICB2YXIgUGFyc2VyID0gX19kZXBlbmRlbmN5M19fLnBhcnNlcjsKICB2YXIgcGFyc2UgPSBfX2RlcGVuZGVuY3kzX18ucGFyc2U7CiAgdmFyIENvbXBpbGVyID0gX19kZXBlbmRlbmN5NF9fLkNvbXBpbGVyOwogIHZhciBjb21waWxlID0gX19kZXBlbmRlbmN5NF9fLmNvbXBpbGU7CiAgdmFyIHByZWNvbXBpbGUgPSBfX2RlcGVuZGVuY3k0X18ucHJlY29tcGlsZTsKICB2YXIgSmF2YVNjcmlwdENvbXBpbGVyID0gX19kZXBlbmRlbmN5NV9fOwoKICB2YXIgX2NyZWF0ZSA9IEhhbmRsZWJhcnMuY3JlYXRlOwogIHZhciBjcmVhdGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoYiA9IF9jcmVhdGUoKTsKCiAgICBoYi5jb21waWxlID0gZnVuY3Rpb24oaW5wdXQsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIGNvbXBpbGUoaW5wdXQsIG9wdGlvbnMsIGhiKTsKICAgIH07CiAgICBoYi5wcmVjb21waWxlID0gZnVuY3Rpb24gKGlucHV0LCBvcHRpb25zKSB7CiAgICAgIHJldHVybiBwcmVjb21waWxlKGlucHV0LCBvcHRpb25zLCBoYik7CiAgICB9OwoKICAgIGhiLkFTVCA9IEFTVDsKICAgIGhiLkNvbXBpbGVyID0gQ29tcGlsZXI7CiAgICBoYi5KYXZhU2NyaXB0Q29tcGlsZXIgPSBKYXZhU2NyaXB0Q29tcGlsZXI7CiAgICBoYi5QYXJzZXIgPSBQYXJzZXI7CiAgICBoYi5wYXJzZSA9IHBhcnNlOwoKICAgIHJldHVybiBoYjsKICB9OwoKICBIYW5kbGViYXJzID0gY3JlYXRlKCk7CiAgSGFuZGxlYmFycy5jcmVhdGUgPSBjcmVhdGU7CgogIEhhbmRsZWJhcnNbJ2RlZmF1bHQnXSA9IEhhbmRsZWJhcnM7CgogIF9fZXhwb3J0c19fID0gSGFuZGxlYmFyczsKICByZXR1cm4gX19leHBvcnRzX187Cn0pKF9fbW9kdWxlMV9fLCBfX21vZHVsZTdfXywgX19tb2R1bGU4X18sIF9fbW9kdWxlMTFfXywgX19tb2R1bGUxMl9fKTsKCiAgcmV0dXJuIF9fbW9kdWxlMF9fOwp9KSk7Cg==", "base64"));
  res.end();

  return __filename;
};
